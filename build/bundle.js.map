{"version":3,"file":"bundle.js","sources":["../../node_modules/svelte/internal/index.mjs","../../node_modules/svelte/store/index.mjs","../../src/application/palettes/nespalette.js","../../src/application/project.js","../../src/bootstrap.js","../../node_modules/enums-manager/main.js","../../src/application/ActionsManager.js","../../node_modules/file-saver/dist/FileSaver.min.js","../../src/utils/file.js","../../src/nesbit.config.js","../../src/application/palettes/palettes.js","../../src/utils/store.js","../../src/utils/array.js","../../src/utils/chr.js","../../src/stores/palettes.store.js","../../src/modules/spritesheet_editor/CanvasLayer.js","../../src/stores/spritesheets.store.js","../../src/modules/spritesheet_editor/tools/tool.js","../../src/modules/spritesheet_editor/layers/layer.js","../../src/modules/spritesheet_editor/SpritesheetEditor.js","../../src/modules/spritesheet_editor/layers/grid.layer.js","../../src/modules/spritesheet_editor/layers/cursor.layer.js","../../src/application/spritesheets/animationloop.js","../../src/modules/spritesheet_editor/tools.js","../../src/modules/spritesheet_editor/tools/pointer.js","../../src/modules/spritesheet_editor/tools/pen.js","../../src/modules/spritesheet_editor/tools/eyedropper.js","../../src/modules/spritesheet_editor/tools/paintbucket.js","../../src/application/actions.js","../../node_modules/standalone-router/route.js","../../node_modules/standalone-router/utils.js","../../node_modules/svelte-standalone-router/SvelteStandaloneRouter.js","../../node_modules/standalone-router/main.js","../../node_modules/svelte-standalone-router/helpers.js","../../node_modules/svelte-standalone-router/router.js","../../node_modules/svelte-standalone-router/router.svelte","../../node_modules/svelte-standalone-router/link.js","../../node_modules/svelte-standalone-router/decorator.js","../../src/router/router.js","../../node_modules/hotkeys-manager/main.js","../../src/keyboard_shortcuts/manager.js","../../src/_components/graphics/SectionNavigation.svelte","../../src/_components/Artboard.svelte","../../src/_singles/buttons/ColorSelectButton.svelte","../../src/_components/graphics/ColorSelection.svelte","../../src/_singles/buttons/ToolButton.svelte","../../src/_components/graphics/ToolbarSelection.svelte","../../src/_singles/buttons/Button.svelte","../../src/utils/strings.js","../../src/_components/LabelHeading.svelte","../../src/_singles/buttons/ActionButton.svelte","../../src/actions/dragdrop.js","../../src/_components/Layer.svelte","../../src/_components/graphics/SpritesheetLayer.svelte","../../src/_components/graphics/CanvasPreview.svelte","../../src/_components/graphics/SpritesheetLayers.svelte","../../src/_components/graphics/PaletteLayer.svelte","../../src/_singles/Color.svelte","../../src/_components/graphics/PaletteLayers.svelte","../../src/actions/clickoutside.js","../../src/_components/SelectButton.svelte","../../src/_components/ArtboardOptions.svelte","../../src/_components/graphics/SpritesheetOptions.svelte","../../src/modules/spritesheet_editor/Canvas.svelte","../../src/modules/spritesheet_editor/SpritesheetEditor.svelte","../../src/_views/graphics/Spritesheets.svelte","../../src/components/general/labeledartboarditem.svelte","../../src/_components/graphics/PaletteOptions.svelte","../../src/_components/graphics/SwatchList.svelte","../../src/_views/graphics/Palettes.svelte","../../src/router/routes/graphics.route.js","../../src/router/routes/home.route.js","../../src/keyboard_shortcuts/application.shortcut.js","../../src/keyboard_shortcuts/palettes.shortcut.js","../../src/keyboard_shortcuts/spritesheets.shortcut.js","../../src/components/external.svelte","../../src/_components/header/Navigation.svelte","../../src/_singles/buttons/AreaButton.svelte","../../src/_components/header/SectionNavigation.svelte","../../src/_components/header/WindowButtons.svelte","../../src/_components/header/Header.svelte","../../src/_components/console.svelte","../../src/Init.svelte","../../src/main.js"],"sourcesContent":["function noop() { }\nconst identity = x => x;\nfunction assign(tar, src) {\n    // @ts-ignore\n    for (const k in src)\n        tar[k] = src[k];\n    return tar;\n}\nfunction is_promise(value) {\n    return value && typeof value === 'object' && typeof value.then === 'function';\n}\nfunction add_location(element, file, line, column, char) {\n    element.__svelte_meta = {\n        loc: { file, line, column, char }\n    };\n}\nfunction run(fn) {\n    return fn();\n}\nfunction blank_object() {\n    return Object.create(null);\n}\nfunction run_all(fns) {\n    fns.forEach(run);\n}\nfunction is_function(thing) {\n    return typeof thing === 'function';\n}\nfunction safe_not_equal(a, b) {\n    return a != a ? b == b : a !== b || ((a && typeof a === 'object') || typeof a === 'function');\n}\nfunction not_equal(a, b) {\n    return a != a ? b == b : a !== b;\n}\nfunction is_empty(obj) {\n    return Object.keys(obj).length === 0;\n}\nfunction validate_store(store, name) {\n    if (store != null && typeof store.subscribe !== 'function') {\n        throw new Error(`'${name}' is not a store with a 'subscribe' method`);\n    }\n}\nfunction subscribe(store, ...callbacks) {\n    if (store == null) {\n        return noop;\n    }\n    const unsub = store.subscribe(...callbacks);\n    return unsub.unsubscribe ? () => unsub.unsubscribe() : unsub;\n}\nfunction get_store_value(store) {\n    let value;\n    subscribe(store, _ => value = _)();\n    return value;\n}\nfunction component_subscribe(component, store, callback) {\n    component.$$.on_destroy.push(subscribe(store, callback));\n}\nfunction create_slot(definition, ctx, $$scope, fn) {\n    if (definition) {\n        const slot_ctx = get_slot_context(definition, ctx, $$scope, fn);\n        return definition[0](slot_ctx);\n    }\n}\nfunction get_slot_context(definition, ctx, $$scope, fn) {\n    return definition[1] && fn\n        ? assign($$scope.ctx.slice(), definition[1](fn(ctx)))\n        : $$scope.ctx;\n}\nfunction get_slot_changes(definition, $$scope, dirty, fn) {\n    if (definition[2] && fn) {\n        const lets = definition[2](fn(dirty));\n        if ($$scope.dirty === undefined) {\n            return lets;\n        }\n        if (typeof lets === 'object') {\n            const merged = [];\n            const len = Math.max($$scope.dirty.length, lets.length);\n            for (let i = 0; i < len; i += 1) {\n                merged[i] = $$scope.dirty[i] | lets[i];\n            }\n            return merged;\n        }\n        return $$scope.dirty | lets;\n    }\n    return $$scope.dirty;\n}\nfunction update_slot(slot, slot_definition, ctx, $$scope, dirty, get_slot_changes_fn, get_slot_context_fn) {\n    const slot_changes = get_slot_changes(slot_definition, $$scope, dirty, get_slot_changes_fn);\n    if (slot_changes) {\n        const slot_context = get_slot_context(slot_definition, ctx, $$scope, get_slot_context_fn);\n        slot.p(slot_context, slot_changes);\n    }\n}\nfunction update_slot_spread(slot, slot_definition, ctx, $$scope, dirty, get_slot_changes_fn, get_slot_spread_changes_fn, get_slot_context_fn) {\n    const slot_changes = get_slot_spread_changes_fn(dirty) | get_slot_changes(slot_definition, $$scope, dirty, get_slot_changes_fn);\n    if (slot_changes) {\n        const slot_context = get_slot_context(slot_definition, ctx, $$scope, get_slot_context_fn);\n        slot.p(slot_context, slot_changes);\n    }\n}\nfunction exclude_internal_props(props) {\n    const result = {};\n    for (const k in props)\n        if (k[0] !== '$')\n            result[k] = props[k];\n    return result;\n}\nfunction compute_rest_props(props, keys) {\n    const rest = {};\n    keys = new Set(keys);\n    for (const k in props)\n        if (!keys.has(k) && k[0] !== '$')\n            rest[k] = props[k];\n    return rest;\n}\nfunction compute_slots(slots) {\n    const result = {};\n    for (const key in slots) {\n        result[key] = true;\n    }\n    return result;\n}\nfunction once(fn) {\n    let ran = false;\n    return function (...args) {\n        if (ran)\n            return;\n        ran = true;\n        fn.call(this, ...args);\n    };\n}\nfunction null_to_empty(value) {\n    return value == null ? '' : value;\n}\nfunction set_store_value(store, ret, value = ret) {\n    store.set(value);\n    return ret;\n}\nconst has_prop = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop);\nfunction action_destroyer(action_result) {\n    return action_result && is_function(action_result.destroy) ? action_result.destroy : noop;\n}\n\nconst is_client = typeof window !== 'undefined';\nlet now = is_client\n    ? () => window.performance.now()\n    : () => Date.now();\nlet raf = is_client ? cb => requestAnimationFrame(cb) : noop;\n// used internally for testing\nfunction set_now(fn) {\n    now = fn;\n}\nfunction set_raf(fn) {\n    raf = fn;\n}\n\nconst tasks = new Set();\nfunction run_tasks(now) {\n    tasks.forEach(task => {\n        if (!task.c(now)) {\n            tasks.delete(task);\n            task.f();\n        }\n    });\n    if (tasks.size !== 0)\n        raf(run_tasks);\n}\n/**\n * For testing purposes only!\n */\nfunction clear_loops() {\n    tasks.clear();\n}\n/**\n * Creates a new task that runs on each raf frame\n * until it returns a falsy value or is aborted\n */\nfunction loop(callback) {\n    let task;\n    if (tasks.size === 0)\n        raf(run_tasks);\n    return {\n        promise: new Promise(fulfill => {\n            tasks.add(task = { c: callback, f: fulfill });\n        }),\n        abort() {\n            tasks.delete(task);\n        }\n    };\n}\n\nfunction append(target, node) {\n    target.appendChild(node);\n}\nfunction insert(target, node, anchor) {\n    target.insertBefore(node, anchor || null);\n}\nfunction detach(node) {\n    node.parentNode.removeChild(node);\n}\nfunction destroy_each(iterations, detaching) {\n    for (let i = 0; i < iterations.length; i += 1) {\n        if (iterations[i])\n            iterations[i].d(detaching);\n    }\n}\nfunction element(name) {\n    return document.createElement(name);\n}\nfunction element_is(name, is) {\n    return document.createElement(name, { is });\n}\nfunction object_without_properties(obj, exclude) {\n    const target = {};\n    for (const k in obj) {\n        if (has_prop(obj, k)\n            // @ts-ignore\n            && exclude.indexOf(k) === -1) {\n            // @ts-ignore\n            target[k] = obj[k];\n        }\n    }\n    return target;\n}\nfunction svg_element(name) {\n    return document.createElementNS('http://www.w3.org/2000/svg', name);\n}\nfunction text(data) {\n    return document.createTextNode(data);\n}\nfunction space() {\n    return text(' ');\n}\nfunction empty() {\n    return text('');\n}\nfunction listen(node, event, handler, options) {\n    node.addEventListener(event, handler, options);\n    return () => node.removeEventListener(event, handler, options);\n}\nfunction prevent_default(fn) {\n    return function (event) {\n        event.preventDefault();\n        // @ts-ignore\n        return fn.call(this, event);\n    };\n}\nfunction stop_propagation(fn) {\n    return function (event) {\n        event.stopPropagation();\n        // @ts-ignore\n        return fn.call(this, event);\n    };\n}\nfunction self(fn) {\n    return function (event) {\n        // @ts-ignore\n        if (event.target === this)\n            fn.call(this, event);\n    };\n}\nfunction attr(node, attribute, value) {\n    if (value == null)\n        node.removeAttribute(attribute);\n    else if (node.getAttribute(attribute) !== value)\n        node.setAttribute(attribute, value);\n}\nfunction set_attributes(node, attributes) {\n    // @ts-ignore\n    const descriptors = Object.getOwnPropertyDescriptors(node.__proto__);\n    for (const key in attributes) {\n        if (attributes[key] == null) {\n            node.removeAttribute(key);\n        }\n        else if (key === 'style') {\n            node.style.cssText = attributes[key];\n        }\n        else if (key === '__value') {\n            node.value = node[key] = attributes[key];\n        }\n        else if (descriptors[key] && descriptors[key].set) {\n            node[key] = attributes[key];\n        }\n        else {\n            attr(node, key, attributes[key]);\n        }\n    }\n}\nfunction set_svg_attributes(node, attributes) {\n    for (const key in attributes) {\n        attr(node, key, attributes[key]);\n    }\n}\nfunction set_custom_element_data(node, prop, value) {\n    if (prop in node) {\n        node[prop] = value;\n    }\n    else {\n        attr(node, prop, value);\n    }\n}\nfunction xlink_attr(node, attribute, value) {\n    node.setAttributeNS('http://www.w3.org/1999/xlink', attribute, value);\n}\nfunction get_binding_group_value(group, __value, checked) {\n    const value = new Set();\n    for (let i = 0; i < group.length; i += 1) {\n        if (group[i].checked)\n            value.add(group[i].__value);\n    }\n    if (!checked) {\n        value.delete(__value);\n    }\n    return Array.from(value);\n}\nfunction to_number(value) {\n    return value === '' ? null : +value;\n}\nfunction time_ranges_to_array(ranges) {\n    const array = [];\n    for (let i = 0; i < ranges.length; i += 1) {\n        array.push({ start: ranges.start(i), end: ranges.end(i) });\n    }\n    return array;\n}\nfunction children(element) {\n    return Array.from(element.childNodes);\n}\nfunction claim_element(nodes, name, attributes, svg) {\n    for (let i = 0; i < nodes.length; i += 1) {\n        const node = nodes[i];\n        if (node.nodeName === name) {\n            let j = 0;\n            const remove = [];\n            while (j < node.attributes.length) {\n                const attribute = node.attributes[j++];\n                if (!attributes[attribute.name]) {\n                    remove.push(attribute.name);\n                }\n            }\n            for (let k = 0; k < remove.length; k++) {\n                node.removeAttribute(remove[k]);\n            }\n            return nodes.splice(i, 1)[0];\n        }\n    }\n    return svg ? svg_element(name) : element(name);\n}\nfunction claim_text(nodes, data) {\n    for (let i = 0; i < nodes.length; i += 1) {\n        const node = nodes[i];\n        if (node.nodeType === 3) {\n            node.data = '' + data;\n            return nodes.splice(i, 1)[0];\n        }\n    }\n    return text(data);\n}\nfunction claim_space(nodes) {\n    return claim_text(nodes, ' ');\n}\nfunction set_data(text, data) {\n    data = '' + data;\n    if (text.wholeText !== data)\n        text.data = data;\n}\nfunction set_input_value(input, value) {\n    input.value = value == null ? '' : value;\n}\nfunction set_input_type(input, type) {\n    try {\n        input.type = type;\n    }\n    catch (e) {\n        // do nothing\n    }\n}\nfunction set_style(node, key, value, important) {\n    node.style.setProperty(key, value, important ? 'important' : '');\n}\nfunction select_option(select, value) {\n    for (let i = 0; i < select.options.length; i += 1) {\n        const option = select.options[i];\n        if (option.__value === value) {\n            option.selected = true;\n            return;\n        }\n    }\n}\nfunction select_options(select, value) {\n    for (let i = 0; i < select.options.length; i += 1) {\n        const option = select.options[i];\n        option.selected = ~value.indexOf(option.__value);\n    }\n}\nfunction select_value(select) {\n    const selected_option = select.querySelector(':checked') || select.options[0];\n    return selected_option && selected_option.__value;\n}\nfunction select_multiple_value(select) {\n    return [].map.call(select.querySelectorAll(':checked'), option => option.__value);\n}\n// unfortunately this can't be a constant as that wouldn't be tree-shakeable\n// so we cache the result instead\nlet crossorigin;\nfunction is_crossorigin() {\n    if (crossorigin === undefined) {\n        crossorigin = false;\n        try {\n            if (typeof window !== 'undefined' && window.parent) {\n                void window.parent.document;\n            }\n        }\n        catch (error) {\n            crossorigin = true;\n        }\n    }\n    return crossorigin;\n}\nfunction add_resize_listener(node, fn) {\n    const computed_style = getComputedStyle(node);\n    if (computed_style.position === 'static') {\n        node.style.position = 'relative';\n    }\n    const iframe = element('iframe');\n    iframe.setAttribute('style', 'display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; ' +\n        'overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: -1;');\n    iframe.setAttribute('aria-hidden', 'true');\n    iframe.tabIndex = -1;\n    const crossorigin = is_crossorigin();\n    let unsubscribe;\n    if (crossorigin) {\n        iframe.src = \"data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}</script>\";\n        unsubscribe = listen(window, 'message', (event) => {\n            if (event.source === iframe.contentWindow)\n                fn();\n        });\n    }\n    else {\n        iframe.src = 'about:blank';\n        iframe.onload = () => {\n            unsubscribe = listen(iframe.contentWindow, 'resize', fn);\n        };\n    }\n    append(node, iframe);\n    return () => {\n        if (crossorigin) {\n            unsubscribe();\n        }\n        else if (unsubscribe && iframe.contentWindow) {\n            unsubscribe();\n        }\n        detach(iframe);\n    };\n}\nfunction toggle_class(element, name, toggle) {\n    element.classList[toggle ? 'add' : 'remove'](name);\n}\nfunction custom_event(type, detail) {\n    const e = document.createEvent('CustomEvent');\n    e.initCustomEvent(type, false, false, detail);\n    return e;\n}\nfunction query_selector_all(selector, parent = document.body) {\n    return Array.from(parent.querySelectorAll(selector));\n}\nclass HtmlTag {\n    constructor(anchor = null) {\n        this.a = anchor;\n        this.e = this.n = null;\n    }\n    m(html, target, anchor = null) {\n        if (!this.e) {\n            this.e = element(target.nodeName);\n            this.t = target;\n            this.h(html);\n        }\n        this.i(anchor);\n    }\n    h(html) {\n        this.e.innerHTML = html;\n        this.n = Array.from(this.e.childNodes);\n    }\n    i(anchor) {\n        for (let i = 0; i < this.n.length; i += 1) {\n            insert(this.t, this.n[i], anchor);\n        }\n    }\n    p(html) {\n        this.d();\n        this.h(html);\n        this.i(this.a);\n    }\n    d() {\n        this.n.forEach(detach);\n    }\n}\nfunction attribute_to_object(attributes) {\n    const result = {};\n    for (const attribute of attributes) {\n        result[attribute.name] = attribute.value;\n    }\n    return result;\n}\nfunction get_custom_elements_slots(element) {\n    const result = {};\n    element.childNodes.forEach((node) => {\n        result[node.slot || 'default'] = true;\n    });\n    return result;\n}\n\nconst active_docs = new Set();\nlet active = 0;\n// https://github.com/darkskyapp/string-hash/blob/master/index.js\nfunction hash(str) {\n    let hash = 5381;\n    let i = str.length;\n    while (i--)\n        hash = ((hash << 5) - hash) ^ str.charCodeAt(i);\n    return hash >>> 0;\n}\nfunction create_rule(node, a, b, duration, delay, ease, fn, uid = 0) {\n    const step = 16.666 / duration;\n    let keyframes = '{\\n';\n    for (let p = 0; p <= 1; p += step) {\n        const t = a + (b - a) * ease(p);\n        keyframes += p * 100 + `%{${fn(t, 1 - t)}}\\n`;\n    }\n    const rule = keyframes + `100% {${fn(b, 1 - b)}}\\n}`;\n    const name = `__svelte_${hash(rule)}_${uid}`;\n    const doc = node.ownerDocument;\n    active_docs.add(doc);\n    const stylesheet = doc.__svelte_stylesheet || (doc.__svelte_stylesheet = doc.head.appendChild(element('style')).sheet);\n    const current_rules = doc.__svelte_rules || (doc.__svelte_rules = {});\n    if (!current_rules[name]) {\n        current_rules[name] = true;\n        stylesheet.insertRule(`@keyframes ${name} ${rule}`, stylesheet.cssRules.length);\n    }\n    const animation = node.style.animation || '';\n    node.style.animation = `${animation ? `${animation}, ` : ''}${name} ${duration}ms linear ${delay}ms 1 both`;\n    active += 1;\n    return name;\n}\nfunction delete_rule(node, name) {\n    const previous = (node.style.animation || '').split(', ');\n    const next = previous.filter(name\n        ? anim => anim.indexOf(name) < 0 // remove specific animation\n        : anim => anim.indexOf('__svelte') === -1 // remove all Svelte animations\n    );\n    const deleted = previous.length - next.length;\n    if (deleted) {\n        node.style.animation = next.join(', ');\n        active -= deleted;\n        if (!active)\n            clear_rules();\n    }\n}\nfunction clear_rules() {\n    raf(() => {\n        if (active)\n            return;\n        active_docs.forEach(doc => {\n            const stylesheet = doc.__svelte_stylesheet;\n            let i = stylesheet.cssRules.length;\n            while (i--)\n                stylesheet.deleteRule(i);\n            doc.__svelte_rules = {};\n        });\n        active_docs.clear();\n    });\n}\n\nfunction create_animation(node, from, fn, params) {\n    if (!from)\n        return noop;\n    const to = node.getBoundingClientRect();\n    if (from.left === to.left && from.right === to.right && from.top === to.top && from.bottom === to.bottom)\n        return noop;\n    const { delay = 0, duration = 300, easing = identity, \n    // @ts-ignore todo: should this be separated from destructuring? Or start/end added to public api and documentation?\n    start: start_time = now() + delay, \n    // @ts-ignore todo:\n    end = start_time + duration, tick = noop, css } = fn(node, { from, to }, params);\n    let running = true;\n    let started = false;\n    let name;\n    function start() {\n        if (css) {\n            name = create_rule(node, 0, 1, duration, delay, easing, css);\n        }\n        if (!delay) {\n            started = true;\n        }\n    }\n    function stop() {\n        if (css)\n            delete_rule(node, name);\n        running = false;\n    }\n    loop(now => {\n        if (!started && now >= start_time) {\n            started = true;\n        }\n        if (started && now >= end) {\n            tick(1, 0);\n            stop();\n        }\n        if (!running) {\n            return false;\n        }\n        if (started) {\n            const p = now - start_time;\n            const t = 0 + 1 * easing(p / duration);\n            tick(t, 1 - t);\n        }\n        return true;\n    });\n    start();\n    tick(0, 1);\n    return stop;\n}\nfunction fix_position(node) {\n    const style = getComputedStyle(node);\n    if (style.position !== 'absolute' && style.position !== 'fixed') {\n        const { width, height } = style;\n        const a = node.getBoundingClientRect();\n        node.style.position = 'absolute';\n        node.style.width = width;\n        node.style.height = height;\n        add_transform(node, a);\n    }\n}\nfunction add_transform(node, a) {\n    const b = node.getBoundingClientRect();\n    if (a.left !== b.left || a.top !== b.top) {\n        const style = getComputedStyle(node);\n        const transform = style.transform === 'none' ? '' : style.transform;\n        node.style.transform = `${transform} translate(${a.left - b.left}px, ${a.top - b.top}px)`;\n    }\n}\n\nlet current_component;\nfunction set_current_component(component) {\n    current_component = component;\n}\nfunction get_current_component() {\n    if (!current_component)\n        throw new Error('Function called outside component initialization');\n    return current_component;\n}\nfunction beforeUpdate(fn) {\n    get_current_component().$$.before_update.push(fn);\n}\nfunction onMount(fn) {\n    get_current_component().$$.on_mount.push(fn);\n}\nfunction afterUpdate(fn) {\n    get_current_component().$$.after_update.push(fn);\n}\nfunction onDestroy(fn) {\n    get_current_component().$$.on_destroy.push(fn);\n}\nfunction createEventDispatcher() {\n    const component = get_current_component();\n    return (type, detail) => {\n        const callbacks = component.$$.callbacks[type];\n        if (callbacks) {\n            // TODO are there situations where events could be dispatched\n            // in a server (non-DOM) environment?\n            const event = custom_event(type, detail);\n            callbacks.slice().forEach(fn => {\n                fn.call(component, event);\n            });\n        }\n    };\n}\nfunction setContext(key, context) {\n    get_current_component().$$.context.set(key, context);\n}\nfunction getContext(key) {\n    return get_current_component().$$.context.get(key);\n}\nfunction hasContext(key) {\n    return get_current_component().$$.context.has(key);\n}\n// TODO figure out if we still want to support\n// shorthand events, or if we want to implement\n// a real bubbling mechanism\nfunction bubble(component, event) {\n    const callbacks = component.$$.callbacks[event.type];\n    if (callbacks) {\n        callbacks.slice().forEach(fn => fn(event));\n    }\n}\n\nconst dirty_components = [];\nconst intros = { enabled: false };\nconst binding_callbacks = [];\nconst render_callbacks = [];\nconst flush_callbacks = [];\nconst resolved_promise = Promise.resolve();\nlet update_scheduled = false;\nfunction schedule_update() {\n    if (!update_scheduled) {\n        update_scheduled = true;\n        resolved_promise.then(flush);\n    }\n}\nfunction tick() {\n    schedule_update();\n    return resolved_promise;\n}\nfunction add_render_callback(fn) {\n    render_callbacks.push(fn);\n}\nfunction add_flush_callback(fn) {\n    flush_callbacks.push(fn);\n}\nlet flushing = false;\nconst seen_callbacks = new Set();\nfunction flush() {\n    if (flushing)\n        return;\n    flushing = true;\n    do {\n        // first, call beforeUpdate functions\n        // and update components\n        for (let i = 0; i < dirty_components.length; i += 1) {\n            const component = dirty_components[i];\n            set_current_component(component);\n            update(component.$$);\n        }\n        set_current_component(null);\n        dirty_components.length = 0;\n        while (binding_callbacks.length)\n            binding_callbacks.pop()();\n        // then, once components are updated, call\n        // afterUpdate functions. This may cause\n        // subsequent updates...\n        for (let i = 0; i < render_callbacks.length; i += 1) {\n            const callback = render_callbacks[i];\n            if (!seen_callbacks.has(callback)) {\n                // ...so guard against infinite loops\n                seen_callbacks.add(callback);\n                callback();\n            }\n        }\n        render_callbacks.length = 0;\n    } while (dirty_components.length);\n    while (flush_callbacks.length) {\n        flush_callbacks.pop()();\n    }\n    update_scheduled = false;\n    flushing = false;\n    seen_callbacks.clear();\n}\nfunction update($$) {\n    if ($$.fragment !== null) {\n        $$.update();\n        run_all($$.before_update);\n        const dirty = $$.dirty;\n        $$.dirty = [-1];\n        $$.fragment && $$.fragment.p($$.ctx, dirty);\n        $$.after_update.forEach(add_render_callback);\n    }\n}\n\nlet promise;\nfunction wait() {\n    if (!promise) {\n        promise = Promise.resolve();\n        promise.then(() => {\n            promise = null;\n        });\n    }\n    return promise;\n}\nfunction dispatch(node, direction, kind) {\n    node.dispatchEvent(custom_event(`${direction ? 'intro' : 'outro'}${kind}`));\n}\nconst outroing = new Set();\nlet outros;\nfunction group_outros() {\n    outros = {\n        r: 0,\n        c: [],\n        p: outros // parent group\n    };\n}\nfunction check_outros() {\n    if (!outros.r) {\n        run_all(outros.c);\n    }\n    outros = outros.p;\n}\nfunction transition_in(block, local) {\n    if (block && block.i) {\n        outroing.delete(block);\n        block.i(local);\n    }\n}\nfunction transition_out(block, local, detach, callback) {\n    if (block && block.o) {\n        if (outroing.has(block))\n            return;\n        outroing.add(block);\n        outros.c.push(() => {\n            outroing.delete(block);\n            if (callback) {\n                if (detach)\n                    block.d(1);\n                callback();\n            }\n        });\n        block.o(local);\n    }\n}\nconst null_transition = { duration: 0 };\nfunction create_in_transition(node, fn, params) {\n    let config = fn(node, params);\n    let running = false;\n    let animation_name;\n    let task;\n    let uid = 0;\n    function cleanup() {\n        if (animation_name)\n            delete_rule(node, animation_name);\n    }\n    function go() {\n        const { delay = 0, duration = 300, easing = identity, tick = noop, css } = config || null_transition;\n        if (css)\n            animation_name = create_rule(node, 0, 1, duration, delay, easing, css, uid++);\n        tick(0, 1);\n        const start_time = now() + delay;\n        const end_time = start_time + duration;\n        if (task)\n            task.abort();\n        running = true;\n        add_render_callback(() => dispatch(node, true, 'start'));\n        task = loop(now => {\n            if (running) {\n                if (now >= end_time) {\n                    tick(1, 0);\n                    dispatch(node, true, 'end');\n                    cleanup();\n                    return running = false;\n                }\n                if (now >= start_time) {\n                    const t = easing((now - start_time) / duration);\n                    tick(t, 1 - t);\n                }\n            }\n            return running;\n        });\n    }\n    let started = false;\n    return {\n        start() {\n            if (started)\n                return;\n            delete_rule(node);\n            if (is_function(config)) {\n                config = config();\n                wait().then(go);\n            }\n            else {\n                go();\n            }\n        },\n        invalidate() {\n            started = false;\n        },\n        end() {\n            if (running) {\n                cleanup();\n                running = false;\n            }\n        }\n    };\n}\nfunction create_out_transition(node, fn, params) {\n    let config = fn(node, params);\n    let running = true;\n    let animation_name;\n    const group = outros;\n    group.r += 1;\n    function go() {\n        const { delay = 0, duration = 300, easing = identity, tick = noop, css } = config || null_transition;\n        if (css)\n            animation_name = create_rule(node, 1, 0, duration, delay, easing, css);\n        const start_time = now() + delay;\n        const end_time = start_time + duration;\n        add_render_callback(() => dispatch(node, false, 'start'));\n        loop(now => {\n            if (running) {\n                if (now >= end_time) {\n                    tick(0, 1);\n                    dispatch(node, false, 'end');\n                    if (!--group.r) {\n                        // this will result in `end()` being called,\n                        // so we don't need to clean up here\n                        run_all(group.c);\n                    }\n                    return false;\n                }\n                if (now >= start_time) {\n                    const t = easing((now - start_time) / duration);\n                    tick(1 - t, t);\n                }\n            }\n            return running;\n        });\n    }\n    if (is_function(config)) {\n        wait().then(() => {\n            // @ts-ignore\n            config = config();\n            go();\n        });\n    }\n    else {\n        go();\n    }\n    return {\n        end(reset) {\n            if (reset && config.tick) {\n                config.tick(1, 0);\n            }\n            if (running) {\n                if (animation_name)\n                    delete_rule(node, animation_name);\n                running = false;\n            }\n        }\n    };\n}\nfunction create_bidirectional_transition(node, fn, params, intro) {\n    let config = fn(node, params);\n    let t = intro ? 0 : 1;\n    let running_program = null;\n    let pending_program = null;\n    let animation_name = null;\n    function clear_animation() {\n        if (animation_name)\n            delete_rule(node, animation_name);\n    }\n    function init(program, duration) {\n        const d = program.b - t;\n        duration *= Math.abs(d);\n        return {\n            a: t,\n            b: program.b,\n            d,\n            duration,\n            start: program.start,\n            end: program.start + duration,\n            group: program.group\n        };\n    }\n    function go(b) {\n        const { delay = 0, duration = 300, easing = identity, tick = noop, css } = config || null_transition;\n        const program = {\n            start: now() + delay,\n            b\n        };\n        if (!b) {\n            // @ts-ignore todo: improve typings\n            program.group = outros;\n            outros.r += 1;\n        }\n        if (running_program || pending_program) {\n            pending_program = program;\n        }\n        else {\n            // if this is an intro, and there's a delay, we need to do\n            // an initial tick and/or apply CSS animation immediately\n            if (css) {\n                clear_animation();\n                animation_name = create_rule(node, t, b, duration, delay, easing, css);\n            }\n            if (b)\n                tick(0, 1);\n            running_program = init(program, duration);\n            add_render_callback(() => dispatch(node, b, 'start'));\n            loop(now => {\n                if (pending_program && now > pending_program.start) {\n                    running_program = init(pending_program, duration);\n                    pending_program = null;\n                    dispatch(node, running_program.b, 'start');\n                    if (css) {\n                        clear_animation();\n                        animation_name = create_rule(node, t, running_program.b, running_program.duration, 0, easing, config.css);\n                    }\n                }\n                if (running_program) {\n                    if (now >= running_program.end) {\n                        tick(t = running_program.b, 1 - t);\n                        dispatch(node, running_program.b, 'end');\n                        if (!pending_program) {\n                            // we're done\n                            if (running_program.b) {\n                                // intro — we can tidy up immediately\n                                clear_animation();\n                            }\n                            else {\n                                // outro — needs to be coordinated\n                                if (!--running_program.group.r)\n                                    run_all(running_program.group.c);\n                            }\n                        }\n                        running_program = null;\n                    }\n                    else if (now >= running_program.start) {\n                        const p = now - running_program.start;\n                        t = running_program.a + running_program.d * easing(p / running_program.duration);\n                        tick(t, 1 - t);\n                    }\n                }\n                return !!(running_program || pending_program);\n            });\n        }\n    }\n    return {\n        run(b) {\n            if (is_function(config)) {\n                wait().then(() => {\n                    // @ts-ignore\n                    config = config();\n                    go(b);\n                });\n            }\n            else {\n                go(b);\n            }\n        },\n        end() {\n            clear_animation();\n            running_program = pending_program = null;\n        }\n    };\n}\n\nfunction handle_promise(promise, info) {\n    const token = info.token = {};\n    function update(type, index, key, value) {\n        if (info.token !== token)\n            return;\n        info.resolved = value;\n        let child_ctx = info.ctx;\n        if (key !== undefined) {\n            child_ctx = child_ctx.slice();\n            child_ctx[key] = value;\n        }\n        const block = type && (info.current = type)(child_ctx);\n        let needs_flush = false;\n        if (info.block) {\n            if (info.blocks) {\n                info.blocks.forEach((block, i) => {\n                    if (i !== index && block) {\n                        group_outros();\n                        transition_out(block, 1, 1, () => {\n                            if (info.blocks[i] === block) {\n                                info.blocks[i] = null;\n                            }\n                        });\n                        check_outros();\n                    }\n                });\n            }\n            else {\n                info.block.d(1);\n            }\n            block.c();\n            transition_in(block, 1);\n            block.m(info.mount(), info.anchor);\n            needs_flush = true;\n        }\n        info.block = block;\n        if (info.blocks)\n            info.blocks[index] = block;\n        if (needs_flush) {\n            flush();\n        }\n    }\n    if (is_promise(promise)) {\n        const current_component = get_current_component();\n        promise.then(value => {\n            set_current_component(current_component);\n            update(info.then, 1, info.value, value);\n            set_current_component(null);\n        }, error => {\n            set_current_component(current_component);\n            update(info.catch, 2, info.error, error);\n            set_current_component(null);\n            if (!info.hasCatch) {\n                throw error;\n            }\n        });\n        // if we previously had a then/catch block, destroy it\n        if (info.current !== info.pending) {\n            update(info.pending, 0);\n            return true;\n        }\n    }\n    else {\n        if (info.current !== info.then) {\n            update(info.then, 1, info.value, promise);\n            return true;\n        }\n        info.resolved = promise;\n    }\n}\n\nconst globals = (typeof window !== 'undefined'\n    ? window\n    : typeof globalThis !== 'undefined'\n        ? globalThis\n        : global);\n\nfunction destroy_block(block, lookup) {\n    block.d(1);\n    lookup.delete(block.key);\n}\nfunction outro_and_destroy_block(block, lookup) {\n    transition_out(block, 1, 1, () => {\n        lookup.delete(block.key);\n    });\n}\nfunction fix_and_destroy_block(block, lookup) {\n    block.f();\n    destroy_block(block, lookup);\n}\nfunction fix_and_outro_and_destroy_block(block, lookup) {\n    block.f();\n    outro_and_destroy_block(block, lookup);\n}\nfunction update_keyed_each(old_blocks, dirty, get_key, dynamic, ctx, list, lookup, node, destroy, create_each_block, next, get_context) {\n    let o = old_blocks.length;\n    let n = list.length;\n    let i = o;\n    const old_indexes = {};\n    while (i--)\n        old_indexes[old_blocks[i].key] = i;\n    const new_blocks = [];\n    const new_lookup = new Map();\n    const deltas = new Map();\n    i = n;\n    while (i--) {\n        const child_ctx = get_context(ctx, list, i);\n        const key = get_key(child_ctx);\n        let block = lookup.get(key);\n        if (!block) {\n            block = create_each_block(key, child_ctx);\n            block.c();\n        }\n        else if (dynamic) {\n            block.p(child_ctx, dirty);\n        }\n        new_lookup.set(key, new_blocks[i] = block);\n        if (key in old_indexes)\n            deltas.set(key, Math.abs(i - old_indexes[key]));\n    }\n    const will_move = new Set();\n    const did_move = new Set();\n    function insert(block) {\n        transition_in(block, 1);\n        block.m(node, next);\n        lookup.set(block.key, block);\n        next = block.first;\n        n--;\n    }\n    while (o && n) {\n        const new_block = new_blocks[n - 1];\n        const old_block = old_blocks[o - 1];\n        const new_key = new_block.key;\n        const old_key = old_block.key;\n        if (new_block === old_block) {\n            // do nothing\n            next = new_block.first;\n            o--;\n            n--;\n        }\n        else if (!new_lookup.has(old_key)) {\n            // remove old block\n            destroy(old_block, lookup);\n            o--;\n        }\n        else if (!lookup.has(new_key) || will_move.has(new_key)) {\n            insert(new_block);\n        }\n        else if (did_move.has(old_key)) {\n            o--;\n        }\n        else if (deltas.get(new_key) > deltas.get(old_key)) {\n            did_move.add(new_key);\n            insert(new_block);\n        }\n        else {\n            will_move.add(old_key);\n            o--;\n        }\n    }\n    while (o--) {\n        const old_block = old_blocks[o];\n        if (!new_lookup.has(old_block.key))\n            destroy(old_block, lookup);\n    }\n    while (n)\n        insert(new_blocks[n - 1]);\n    return new_blocks;\n}\nfunction validate_each_keys(ctx, list, get_context, get_key) {\n    const keys = new Set();\n    for (let i = 0; i < list.length; i++) {\n        const key = get_key(get_context(ctx, list, i));\n        if (keys.has(key)) {\n            throw new Error('Cannot have duplicate keys in a keyed each');\n        }\n        keys.add(key);\n    }\n}\n\nfunction get_spread_update(levels, updates) {\n    const update = {};\n    const to_null_out = {};\n    const accounted_for = { $$scope: 1 };\n    let i = levels.length;\n    while (i--) {\n        const o = levels[i];\n        const n = updates[i];\n        if (n) {\n            for (const key in o) {\n                if (!(key in n))\n                    to_null_out[key] = 1;\n            }\n            for (const key in n) {\n                if (!accounted_for[key]) {\n                    update[key] = n[key];\n                    accounted_for[key] = 1;\n                }\n            }\n            levels[i] = n;\n        }\n        else {\n            for (const key in o) {\n                accounted_for[key] = 1;\n            }\n        }\n    }\n    for (const key in to_null_out) {\n        if (!(key in update))\n            update[key] = undefined;\n    }\n    return update;\n}\nfunction get_spread_object(spread_props) {\n    return typeof spread_props === 'object' && spread_props !== null ? spread_props : {};\n}\n\n// source: https://html.spec.whatwg.org/multipage/indices.html\nconst boolean_attributes = new Set([\n    'allowfullscreen',\n    'allowpaymentrequest',\n    'async',\n    'autofocus',\n    'autoplay',\n    'checked',\n    'controls',\n    'default',\n    'defer',\n    'disabled',\n    'formnovalidate',\n    'hidden',\n    'ismap',\n    'loop',\n    'multiple',\n    'muted',\n    'nomodule',\n    'novalidate',\n    'open',\n    'playsinline',\n    'readonly',\n    'required',\n    'reversed',\n    'selected'\n]);\n\nconst invalid_attribute_name_character = /[\\s'\">/=\\u{FDD0}-\\u{FDEF}\\u{FFFE}\\u{FFFF}\\u{1FFFE}\\u{1FFFF}\\u{2FFFE}\\u{2FFFF}\\u{3FFFE}\\u{3FFFF}\\u{4FFFE}\\u{4FFFF}\\u{5FFFE}\\u{5FFFF}\\u{6FFFE}\\u{6FFFF}\\u{7FFFE}\\u{7FFFF}\\u{8FFFE}\\u{8FFFF}\\u{9FFFE}\\u{9FFFF}\\u{AFFFE}\\u{AFFFF}\\u{BFFFE}\\u{BFFFF}\\u{CFFFE}\\u{CFFFF}\\u{DFFFE}\\u{DFFFF}\\u{EFFFE}\\u{EFFFF}\\u{FFFFE}\\u{FFFFF}\\u{10FFFE}\\u{10FFFF}]/u;\n// https://html.spec.whatwg.org/multipage/syntax.html#attributes-2\n// https://infra.spec.whatwg.org/#noncharacter\nfunction spread(args, classes_to_add) {\n    const attributes = Object.assign({}, ...args);\n    if (classes_to_add) {\n        if (attributes.class == null) {\n            attributes.class = classes_to_add;\n        }\n        else {\n            attributes.class += ' ' + classes_to_add;\n        }\n    }\n    let str = '';\n    Object.keys(attributes).forEach(name => {\n        if (invalid_attribute_name_character.test(name))\n            return;\n        const value = attributes[name];\n        if (value === true)\n            str += ' ' + name;\n        else if (boolean_attributes.has(name.toLowerCase())) {\n            if (value)\n                str += ' ' + name;\n        }\n        else if (value != null) {\n            str += ` ${name}=\"${String(value).replace(/\"/g, '&#34;').replace(/'/g, '&#39;')}\"`;\n        }\n    });\n    return str;\n}\nconst escaped = {\n    '\"': '&quot;',\n    \"'\": '&#39;',\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;'\n};\nfunction escape(html) {\n    return String(html).replace(/[\"'&<>]/g, match => escaped[match]);\n}\nfunction each(items, fn) {\n    let str = '';\n    for (let i = 0; i < items.length; i += 1) {\n        str += fn(items[i], i);\n    }\n    return str;\n}\nconst missing_component = {\n    $$render: () => ''\n};\nfunction validate_component(component, name) {\n    if (!component || !component.$$render) {\n        if (name === 'svelte:component')\n            name += ' this={...}';\n        throw new Error(`<${name}> is not a valid SSR component. You may need to review your build config to ensure that dependencies are compiled, rather than imported as pre-compiled modules`);\n    }\n    return component;\n}\nfunction debug(file, line, column, values) {\n    console.log(`{@debug} ${file ? file + ' ' : ''}(${line}:${column})`); // eslint-disable-line no-console\n    console.log(values); // eslint-disable-line no-console\n    return '';\n}\nlet on_destroy;\nfunction create_ssr_component(fn) {\n    function $$render(result, props, bindings, slots) {\n        const parent_component = current_component;\n        const $$ = {\n            on_destroy,\n            context: new Map(parent_component ? parent_component.$$.context : []),\n            // these will be immediately discarded\n            on_mount: [],\n            before_update: [],\n            after_update: [],\n            callbacks: blank_object()\n        };\n        set_current_component({ $$ });\n        const html = fn(result, props, bindings, slots);\n        set_current_component(parent_component);\n        return html;\n    }\n    return {\n        render: (props = {}, options = {}) => {\n            on_destroy = [];\n            const result = { title: '', head: '', css: new Set() };\n            const html = $$render(result, props, {}, options);\n            run_all(on_destroy);\n            return {\n                html,\n                css: {\n                    code: Array.from(result.css).map(css => css.code).join('\\n'),\n                    map: null // TODO\n                },\n                head: result.title + result.head\n            };\n        },\n        $$render\n    };\n}\nfunction add_attribute(name, value, boolean) {\n    if (value == null || (boolean && !value))\n        return '';\n    return ` ${name}${value === true ? '' : `=${typeof value === 'string' ? JSON.stringify(escape(value)) : `\"${value}\"`}`}`;\n}\nfunction add_classes(classes) {\n    return classes ? ` class=\"${classes}\"` : '';\n}\n\nfunction bind(component, name, callback) {\n    const index = component.$$.props[name];\n    if (index !== undefined) {\n        component.$$.bound[index] = callback;\n        callback(component.$$.ctx[index]);\n    }\n}\nfunction create_component(block) {\n    block && block.c();\n}\nfunction claim_component(block, parent_nodes) {\n    block && block.l(parent_nodes);\n}\nfunction mount_component(component, target, anchor) {\n    const { fragment, on_mount, on_destroy, after_update } = component.$$;\n    fragment && fragment.m(target, anchor);\n    // onMount happens before the initial afterUpdate\n    add_render_callback(() => {\n        const new_on_destroy = on_mount.map(run).filter(is_function);\n        if (on_destroy) {\n            on_destroy.push(...new_on_destroy);\n        }\n        else {\n            // Edge case - component was destroyed immediately,\n            // most likely as a result of a binding initialising\n            run_all(new_on_destroy);\n        }\n        component.$$.on_mount = [];\n    });\n    after_update.forEach(add_render_callback);\n}\nfunction destroy_component(component, detaching) {\n    const $$ = component.$$;\n    if ($$.fragment !== null) {\n        run_all($$.on_destroy);\n        $$.fragment && $$.fragment.d(detaching);\n        // TODO null out other refs, including component.$$ (but need to\n        // preserve final state?)\n        $$.on_destroy = $$.fragment = null;\n        $$.ctx = [];\n    }\n}\nfunction make_dirty(component, i) {\n    if (component.$$.dirty[0] === -1) {\n        dirty_components.push(component);\n        schedule_update();\n        component.$$.dirty.fill(0);\n    }\n    component.$$.dirty[(i / 31) | 0] |= (1 << (i % 31));\n}\nfunction init(component, options, instance, create_fragment, not_equal, props, dirty = [-1]) {\n    const parent_component = current_component;\n    set_current_component(component);\n    const prop_values = options.props || {};\n    const $$ = component.$$ = {\n        fragment: null,\n        ctx: null,\n        // state\n        props,\n        update: noop,\n        not_equal,\n        bound: blank_object(),\n        // lifecycle\n        on_mount: [],\n        on_destroy: [],\n        before_update: [],\n        after_update: [],\n        context: new Map(parent_component ? parent_component.$$.context : []),\n        // everything else\n        callbacks: blank_object(),\n        dirty,\n        skip_bound: false\n    };\n    let ready = false;\n    $$.ctx = instance\n        ? instance(component, prop_values, (i, ret, ...rest) => {\n            const value = rest.length ? rest[0] : ret;\n            if ($$.ctx && not_equal($$.ctx[i], $$.ctx[i] = value)) {\n                if (!$$.skip_bound && $$.bound[i])\n                    $$.bound[i](value);\n                if (ready)\n                    make_dirty(component, i);\n            }\n            return ret;\n        })\n        : [];\n    $$.update();\n    ready = true;\n    run_all($$.before_update);\n    // `false` as a special case of no DOM component\n    $$.fragment = create_fragment ? create_fragment($$.ctx) : false;\n    if (options.target) {\n        if (options.hydrate) {\n            const nodes = children(options.target);\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            $$.fragment && $$.fragment.l(nodes);\n            nodes.forEach(detach);\n        }\n        else {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            $$.fragment && $$.fragment.c();\n        }\n        if (options.intro)\n            transition_in(component.$$.fragment);\n        mount_component(component, options.target, options.anchor);\n        flush();\n    }\n    set_current_component(parent_component);\n}\nlet SvelteElement;\nif (typeof HTMLElement === 'function') {\n    SvelteElement = class extends HTMLElement {\n        constructor() {\n            super();\n            this.attachShadow({ mode: 'open' });\n        }\n        connectedCallback() {\n            // @ts-ignore todo: improve typings\n            for (const key in this.$$.slotted) {\n                // @ts-ignore todo: improve typings\n                this.appendChild(this.$$.slotted[key]);\n            }\n        }\n        attributeChangedCallback(attr, _oldValue, newValue) {\n            this[attr] = newValue;\n        }\n        $destroy() {\n            destroy_component(this, 1);\n            this.$destroy = noop;\n        }\n        $on(type, callback) {\n            // TODO should this delegate to addEventListener?\n            const callbacks = (this.$$.callbacks[type] || (this.$$.callbacks[type] = []));\n            callbacks.push(callback);\n            return () => {\n                const index = callbacks.indexOf(callback);\n                if (index !== -1)\n                    callbacks.splice(index, 1);\n            };\n        }\n        $set($$props) {\n            if (this.$$set && !is_empty($$props)) {\n                this.$$.skip_bound = true;\n                this.$$set($$props);\n                this.$$.skip_bound = false;\n            }\n        }\n    };\n}\n/**\n * Base class for Svelte components. Used when dev=false.\n */\nclass SvelteComponent {\n    $destroy() {\n        destroy_component(this, 1);\n        this.$destroy = noop;\n    }\n    $on(type, callback) {\n        const callbacks = (this.$$.callbacks[type] || (this.$$.callbacks[type] = []));\n        callbacks.push(callback);\n        return () => {\n            const index = callbacks.indexOf(callback);\n            if (index !== -1)\n                callbacks.splice(index, 1);\n        };\n    }\n    $set($$props) {\n        if (this.$$set && !is_empty($$props)) {\n            this.$$.skip_bound = true;\n            this.$$set($$props);\n            this.$$.skip_bound = false;\n        }\n    }\n}\n\nfunction dispatch_dev(type, detail) {\n    document.dispatchEvent(custom_event(type, Object.assign({ version: '3.31.2' }, detail)));\n}\nfunction append_dev(target, node) {\n    dispatch_dev('SvelteDOMInsert', { target, node });\n    append(target, node);\n}\nfunction insert_dev(target, node, anchor) {\n    dispatch_dev('SvelteDOMInsert', { target, node, anchor });\n    insert(target, node, anchor);\n}\nfunction detach_dev(node) {\n    dispatch_dev('SvelteDOMRemove', { node });\n    detach(node);\n}\nfunction detach_between_dev(before, after) {\n    while (before.nextSibling && before.nextSibling !== after) {\n        detach_dev(before.nextSibling);\n    }\n}\nfunction detach_before_dev(after) {\n    while (after.previousSibling) {\n        detach_dev(after.previousSibling);\n    }\n}\nfunction detach_after_dev(before) {\n    while (before.nextSibling) {\n        detach_dev(before.nextSibling);\n    }\n}\nfunction listen_dev(node, event, handler, options, has_prevent_default, has_stop_propagation) {\n    const modifiers = options === true ? ['capture'] : options ? Array.from(Object.keys(options)) : [];\n    if (has_prevent_default)\n        modifiers.push('preventDefault');\n    if (has_stop_propagation)\n        modifiers.push('stopPropagation');\n    dispatch_dev('SvelteDOMAddEventListener', { node, event, handler, modifiers });\n    const dispose = listen(node, event, handler, options);\n    return () => {\n        dispatch_dev('SvelteDOMRemoveEventListener', { node, event, handler, modifiers });\n        dispose();\n    };\n}\nfunction attr_dev(node, attribute, value) {\n    attr(node, attribute, value);\n    if (value == null)\n        dispatch_dev('SvelteDOMRemoveAttribute', { node, attribute });\n    else\n        dispatch_dev('SvelteDOMSetAttribute', { node, attribute, value });\n}\nfunction prop_dev(node, property, value) {\n    node[property] = value;\n    dispatch_dev('SvelteDOMSetProperty', { node, property, value });\n}\nfunction dataset_dev(node, property, value) {\n    node.dataset[property] = value;\n    dispatch_dev('SvelteDOMSetDataset', { node, property, value });\n}\nfunction set_data_dev(text, data) {\n    data = '' + data;\n    if (text.wholeText === data)\n        return;\n    dispatch_dev('SvelteDOMSetData', { node: text, data });\n    text.data = data;\n}\nfunction validate_each_argument(arg) {\n    if (typeof arg !== 'string' && !(arg && typeof arg === 'object' && 'length' in arg)) {\n        let msg = '{#each} only iterates over array-like objects.';\n        if (typeof Symbol === 'function' && arg && Symbol.iterator in arg) {\n            msg += ' You can use a spread to convert this iterable into an array.';\n        }\n        throw new Error(msg);\n    }\n}\nfunction validate_slots(name, slot, keys) {\n    for (const slot_key of Object.keys(slot)) {\n        if (!~keys.indexOf(slot_key)) {\n            console.warn(`<${name}> received an unexpected slot \"${slot_key}\".`);\n        }\n    }\n}\n/**\n * Base class for Svelte components with some minor dev-enhancements. Used when dev=true.\n */\nclass SvelteComponentDev extends SvelteComponent {\n    constructor(options) {\n        if (!options || (!options.target && !options.$$inline)) {\n            throw new Error(\"'target' is a required option\");\n        }\n        super();\n    }\n    $destroy() {\n        super.$destroy();\n        this.$destroy = () => {\n            console.warn('Component was already destroyed'); // eslint-disable-line no-console\n        };\n    }\n    $capture_state() { }\n    $inject_state() { }\n}\n/**\n * Base class to create strongly typed Svelte components.\n * This only exists for typing purposes and should be used in `.d.ts` files.\n *\n * ### Example:\n *\n * You have component library on npm called `component-library`, from which\n * you export a component called `MyComponent`. For Svelte+TypeScript users,\n * you want to provide typings. Therefore you create a `index.d.ts`:\n * ```ts\n * import { SvelteComponentTyped } from \"svelte\";\n * export class MyComponent extends SvelteComponentTyped<{foo: string}> {}\n * ```\n * Typing this makes it possible for IDEs like VS Code with the Svelte extension\n * to provide intellisense and to use the component like this in a Svelte file\n * with TypeScript:\n * ```svelte\n * <script lang=\"ts\">\n * \timport { MyComponent } from \"component-library\";\n * </script>\n * <MyComponent foo={'bar'} />\n * ```\n *\n * #### Why not make this part of `SvelteComponent(Dev)`?\n * Because\n * ```ts\n * class ASubclassOfSvelteComponent extends SvelteComponent<{foo: string}> {}\n * const component: typeof SvelteComponent = ASubclassOfSvelteComponent;\n * ```\n * will throw a type error, so we need to seperate the more strictly typed class.\n */\nclass SvelteComponentTyped extends SvelteComponentDev {\n    constructor(options) {\n        super(options);\n    }\n}\nfunction loop_guard(timeout) {\n    const start = Date.now();\n    return () => {\n        if (Date.now() - start > timeout) {\n            throw new Error('Infinite loop detected');\n        }\n    };\n}\n\nexport { HtmlTag, SvelteComponent, SvelteComponentDev, SvelteComponentTyped, SvelteElement, action_destroyer, add_attribute, add_classes, add_flush_callback, add_location, add_render_callback, add_resize_listener, add_transform, afterUpdate, append, append_dev, assign, attr, attr_dev, attribute_to_object, beforeUpdate, bind, binding_callbacks, blank_object, bubble, check_outros, children, claim_component, claim_element, claim_space, claim_text, clear_loops, component_subscribe, compute_rest_props, compute_slots, createEventDispatcher, create_animation, create_bidirectional_transition, create_component, create_in_transition, create_out_transition, create_slot, create_ssr_component, current_component, custom_event, dataset_dev, debug, destroy_block, destroy_component, destroy_each, detach, detach_after_dev, detach_before_dev, detach_between_dev, detach_dev, dirty_components, dispatch_dev, each, element, element_is, empty, escape, escaped, exclude_internal_props, fix_and_destroy_block, fix_and_outro_and_destroy_block, fix_position, flush, getContext, get_binding_group_value, get_current_component, get_custom_elements_slots, get_slot_changes, get_slot_context, get_spread_object, get_spread_update, get_store_value, globals, group_outros, handle_promise, hasContext, has_prop, identity, init, insert, insert_dev, intros, invalid_attribute_name_character, is_client, is_crossorigin, is_empty, is_function, is_promise, listen, listen_dev, loop, loop_guard, missing_component, mount_component, noop, not_equal, now, null_to_empty, object_without_properties, onDestroy, onMount, once, outro_and_destroy_block, prevent_default, prop_dev, query_selector_all, raf, run, run_all, safe_not_equal, schedule_update, select_multiple_value, select_option, select_options, select_value, self, setContext, set_attributes, set_current_component, set_custom_element_data, set_data, set_data_dev, set_input_type, set_input_value, set_now, set_raf, set_store_value, set_style, set_svg_attributes, space, spread, stop_propagation, subscribe, svg_element, text, tick, time_ranges_to_array, to_number, toggle_class, transition_in, transition_out, update_keyed_each, update_slot, update_slot_spread, validate_component, validate_each_argument, validate_each_keys, validate_slots, validate_store, xlink_attr };\n","import { noop, safe_not_equal, subscribe, run_all, is_function } from '../internal/index.mjs';\nexport { get_store_value as get } from '../internal/index.mjs';\n\nconst subscriber_queue = [];\n/**\n * Creates a `Readable` store that allows reading by subscription.\n * @param value initial value\n * @param {StartStopNotifier}start start and stop notifications for subscriptions\n */\nfunction readable(value, start) {\n    return {\n        subscribe: writable(value, start).subscribe\n    };\n}\n/**\n * Create a `Writable` store that allows both updating and reading by subscription.\n * @param {*=}value initial value\n * @param {StartStopNotifier=}start start and stop notifications for subscriptions\n */\nfunction writable(value, start = noop) {\n    let stop;\n    const subscribers = [];\n    function set(new_value) {\n        if (safe_not_equal(value, new_value)) {\n            value = new_value;\n            if (stop) { // store is ready\n                const run_queue = !subscriber_queue.length;\n                for (let i = 0; i < subscribers.length; i += 1) {\n                    const s = subscribers[i];\n                    s[1]();\n                    subscriber_queue.push(s, value);\n                }\n                if (run_queue) {\n                    for (let i = 0; i < subscriber_queue.length; i += 2) {\n                        subscriber_queue[i][0](subscriber_queue[i + 1]);\n                    }\n                    subscriber_queue.length = 0;\n                }\n            }\n        }\n    }\n    function update(fn) {\n        set(fn(value));\n    }\n    function subscribe(run, invalidate = noop) {\n        const subscriber = [run, invalidate];\n        subscribers.push(subscriber);\n        if (subscribers.length === 1) {\n            stop = start(set) || noop;\n        }\n        run(value);\n        return () => {\n            const index = subscribers.indexOf(subscriber);\n            if (index !== -1) {\n                subscribers.splice(index, 1);\n            }\n            if (subscribers.length === 0) {\n                stop();\n                stop = null;\n            }\n        };\n    }\n    return { set, update, subscribe };\n}\nfunction derived(stores, fn, initial_value) {\n    const single = !Array.isArray(stores);\n    const stores_array = single\n        ? [stores]\n        : stores;\n    const auto = fn.length < 2;\n    return readable(initial_value, (set) => {\n        let inited = false;\n        const values = [];\n        let pending = 0;\n        let cleanup = noop;\n        const sync = () => {\n            if (pending) {\n                return;\n            }\n            cleanup();\n            const result = fn(single ? values[0] : values, set);\n            if (auto) {\n                set(result);\n            }\n            else {\n                cleanup = is_function(result) ? result : noop;\n            }\n        };\n        const unsubscribers = stores_array.map((store, i) => subscribe(store, (value) => {\n            values[i] = value;\n            pending &= ~(1 << i);\n            if (inited) {\n                sync();\n            }\n        }, () => {\n            pending |= (1 << i);\n        }));\n        inited = true;\n        sync();\n        return function stop() {\n            run_all(unsubscribers);\n            cleanup();\n        };\n    });\n}\n\nexport { derived, readable, writable };\n","// convert rgb to hsl\r\nexport const rgbToHsl = (c) => {\r\n  var r = c[0]/255, g = c[1]/255, b = c[2]/255;\r\n  var max = Math.max(r, g, b), min = Math.min(r, g, b);\r\n  var h, s, l = (max + min) / 2;\r\n\r\n  if(max == min) {\r\n    h = s = 0; // achromatic\r\n  } else {\r\n    var d = max - min;\r\n    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n    switch(max){\r\n      case r: h = (g - b) / d + (g < b ? 6 : 0); break;\r\n      case g: h = (b - r) / d + 2; break;\r\n      case b: h = (r - g) / d + 4; break;\r\n    }\r\n    h /= 6;\r\n  }\r\n  return new Array(h * 360, s * 100, l * 100);\r\n}\r\n\r\n// nes color palette\r\nconst nespalette = [\r\n  {hex: '00', rgb: [124,124,124]},\r\n  {hex: '01', rgb: [0,0,252]},\r\n  {hex: '02', rgb: [0,0,188]},\r\n  {hex: '03', rgb: [68,40,188]},\r\n  {hex: '04', rgb: [148,0,132]},\r\n  {hex: '05', rgb: [168,0,32]},\r\n  {hex: '06', rgb: [168,16,0]},\r\n  {hex: '07', rgb: [136,20,0]},\r\n  {hex: '08', rgb: [80,48,0]},\r\n  {hex: '09', rgb: [0,120,0]},\r\n  {hex: '0A', rgb: [0,104,0]},\r\n  {hex: '0B', rgb: [0,88,0]},\r\n  {hex: '0C', rgb: [0,64,88]},\r\n  {hex: '0D', rgb: [0,0,0]},\r\n  {hex: '0E', rgb: [0,0,0]},\r\n  {hex: '0F', rgb: [0,0,0]},\r\n  {hex: '10', rgb: [188,188,188]},\r\n  {hex: '11', rgb: [0,120,248]},\r\n  {hex: '12', rgb: [0,88,248]},\r\n  {hex: '13', rgb: [104,68,252]},\r\n  {hex: '14', rgb: [216,0,204]},\r\n  {hex: '15', rgb: [228,0,88]},\r\n  {hex: '16', rgb: [248,56,0]},\r\n  {hex: '17', rgb: [228,92,16]},\r\n  {hex: '18', rgb: [172,124,0]},\r\n  {hex: '19', rgb: [0,184,0]},\r\n  {hex: '1A', rgb: [0,168,0]},\r\n  {hex: '1B', rgb: [0,168,68]},\r\n  {hex: '1C', rgb: [0,136,136]},\r\n  {hex: '1D', rgb: [0,0,0]},\r\n  {hex: '1E', rgb: [0,0,0]},\r\n  {hex: '1F', rgb: [0,0,0]},\r\n  {hex: '20', rgb: [248,248,248]},\r\n  {hex: '21', rgb: [60,188,252]},\r\n  {hex: '22', rgb: [104,136,252]},\r\n  {hex: '23', rgb: [152,120,248]},\r\n  {hex: '24', rgb: [248,120,248]},\r\n  {hex: '25', rgb: [248,88,152]},\r\n  {hex: '26', rgb: [248,120,88]},\r\n  {hex: '27', rgb: [252,160,68]},\r\n  {hex: '28', rgb: [248,184,0]},\r\n  {hex: '29', rgb: [184,248,24]},\r\n  {hex: '2A', rgb: [88,216,84]},\r\n  {hex: '2B', rgb: [88,248,152]},\r\n  {hex: '2C', rgb: [0,232,216]},\r\n  {hex: '2D', rgb: [120,120,120]},\r\n  {hex: '2E', rgb: [0,0,0]},\r\n  {hex: '2F', rgb: [0,0,0]},\r\n  {hex: '30', rgb: [252,252,252]},\r\n  {hex: '31', rgb: [164,228,252]},\r\n  {hex: '32', rgb: [184,184,248]},\r\n  {hex: '33', rgb: [216,184,248]},\r\n  {hex: '34', rgb: [248,184,248]},\r\n  {hex: '35', rgb: [248,164,192]},\r\n  {hex: '36', rgb: [240,208,176]},\r\n  {hex: '37', rgb: [252,224,168]},\r\n  {hex: '38', rgb: [248,216,120]},\r\n  {hex: '39', rgb: [216,248,120]},\r\n  {hex: '3A', rgb: [184,248,184]},\r\n  {hex: '3B', rgb: [184,248,216]},\r\n  {hex: '3C', rgb: [0,252,252]},\r\n  {hex: '3D', rgb: [216,216,216]},\r\n  {hex: '3E', rgb: [0,0,0]},\r\n  {hex: '3F', rgb: [0,0,0]},\r\n];\r\n\r\n// sort after hue\r\nconst sorted = nespalette.map((c, i) => ({rgb: rgbToHsl(c.rgb), index: i}))\r\n  .sort((a, b) => b.rgb[0] - a.rgb[0] || a.rgb[2] - b.rgb[2])\r\n  .map((data) => nespalette[data.index]);\r\n\r\n\r\nclass NESColor{\r\n  constructor(hex, rgb){\r\n    this.hex = hex;\r\n    this.rgb = rgb;\r\n    Object.freeze(this);\r\n  }\r\n}\r\n\r\n// create color objects to be easier to deal with throughout the application\r\nconst mappedColorList = sorted.map(color => new NESColor(color.hex, color.rgb));\r\n\r\nexport default mappedColorList;","import { writable } from 'svelte/store';\r\nimport NESPalette from '~/application/palettes/nespalette';\r\n\r\n// export the nespalette\r\nexport { NESPalette };\r\n\r\n\r\n// meta config\r\nexport const meta = {\r\n  startPage: '/graphics'\r\n};\r\n\r\n// console store\r\nexport const log = (() => {\r\n  const store = writable([]);\r\n  const { subscribe, update } = store;\r\n  return {\r\n    subscribe,\r\n    push(e){\r\n      if(e instanceof ErrorEvent){\r\n        const d = new Date();\r\n        const date = `${String(d.getHours()).padStart(2, '0')}:${String(d.getMinutes()).padStart(2, '0')}:${String(d.getSeconds()).padStart(2, '0')}`;\r\n        e.date = date;\r\n        update((store) => {\r\n          // don't let the array get to big so let's reset it  \r\n          // when it reaches a size of 20\r\n          if(store.length > 20){\r\n            store = [];\r\n          }\r\n          store.push(e);\r\n          return store;\r\n        });\r\n      }\r\n    }\r\n  }\r\n})();\r\n\r\n// project store\r\nexport const projectStore = (() => {\r\n  const { subscribe, set, update } = writable({\r\n    name: undefined,\r\n    saved: null,\r\n  });\r\n  return {\r\n    subscribe,\r\n    name: (name) => {\r\n      if(typeof name != 'string'){\r\n        throw new Error(`Invalid project name.`);\r\n      }\r\n      update(obj => ({...obj, name}));\r\n    },\r\n    save: (location) => {\r\n      console.log('saving to location:', location);\r\n    }\r\n  }\r\n})();","import { log } from '~/application/project';\r\n\r\n// disable context menu \r\nwindow.addEventListener('contextmenu', _ => _.preventDefault());\r\n\r\nwindow.addEventListener(\"error\", function (e) {\r\n  // e.preventDefault();\r\n  log.push(e);\r\n});\r\n\r\n// for debugging. remove in production\r\nwindow.addEventListener('keydown', (e) => {\r\n  // console.log('keydown debugging. remove in production.')\r\n  // console.log(e.code);\r\n});","/*\r\n  Enum\r\n*/\r\nexport class Enum extends Number{\r\n  constructor(value, key){\r\n    if(typeof value != 'number' || typeof key != 'string'){\r\n      throw new Error(`Invalid Enumerable arguments`);\r\n    }\r\n    super(value);\r\n    this.key = key;\r\n    this.value = value;\r\n    Object.freeze(this);\r\n  }\r\n}\r\n\r\n/*\r\n  EnumerableList\r\n\r\n  Usage:\r\n  const types = new EnumerableList('designer', 'programmer', 'webdeveloper');\r\n  console.log(types.get('programmer'));\r\n*/\r\nexport class EnumerableList extends Map{\r\n  constructor(...props){\r\n    super();\r\n    props.forEach((key, i) => {\r\n      if(this.has(key)){\r\n        throw new Error(`enum key : '${key}' already exists`);\r\n      }\r\n      if(typeof key !== 'string'){\r\n        throw new Error(`Invalid key. Expecting string, got : [${typeof key}](${key})`);\r\n      }\r\n      const EnumerableItem = new Enum(i+1, key);\r\n      this.set(key, EnumerableItem);\r\n    });\r\n    Object.freeze(this);\r\n  }\r\n}","import { EnumerableList, Enum } from 'enums-manager';\n\nexport class ActionsManager{\n  constructor(...actions){\n    // define\n    this.__actions = this.define(...actions);\n    this.__binds = new Map();\n  }\n  define(...args){\n    const list = new EnumerableList(...args);\n    this.__actions = list; \n    return list;\n  }\n  action(key){\n    if(!this.__actions.has(key)){\n      throw new Error(`Action is not defined for key '${key}'`);\n    } \n    return this.__actions.get(key);\n  }\n  register(k, f){\n    if(typeof k === 'string'){\n      this.register(this.action(k), f);\n      return;\n    }\n    if(!(k instanceof Enum)){\n      throw new Error(`Invalid key value '${k}'. Expecting instance of 'Enum'`);\n    }\n    if(this.__binds.has(k)){\n      throw new Error(`Action already defined : [${k.key}]`);\n    }\n    if(typeof f !== 'function'){\n      throw new Error(`Invalid callback function`);\n    }\n    this.__binds.set(k, f);\n  }\n  exist(value){\n    return this.__binds.has(value);\n  }\n  call(k, ...args){\n    if(typeof k === 'string'){\n      this.call(this.action(k), ...args);\n      return;\n    }\n    if(!(k instanceof Enum)){\n      throw new Error(`Invalid key '${k}'. Expecting 'Enum'`);\n    }\n    \n    if(!this.__binds.has(k)){\n      throw new Error(`Action for '${k}' does not exist`);\n    }\n    // handle promises to allow for chaining\n    return new Promise((resolve, reject) => {\n      try{\n        resolve(this.__binds.get(k).call(null, ...args));\n      }catch(error){\n        reject(error.message);\n      }\n    });\n  }\n  execute(...args){\n    return this.call(...args);\n  }\n}\n\n// create actions\nconst actions = new ActionsManager(\n  'noop', // a blank command\n  // application\n  'application_log',\n\n  // window\n  'window_close',\n  'window_minimize',\n  'window_maximize',\n  'window_toggle_fullscreen',\n  'external_link',\n  \n  \n  // palettes\n  'palette_clear',\n  'palette_create',\n  'palette_remove',\n  'palette_clone_layer',\n  'palette_clone_active_layer',\n  'palette_make_layer_active',\n  'palette_swap_layers',\n  'palette_update_layer_label',\n  'palette_focus_rename_active_layer',\n  'palette_export',\n  'palette_import',\n  'palette_active_color',\n  \n  // spritesheets\n  'spritesheet_create',\n  'spritesheet_remove',\n  'spritesheet_clone_layer',\n  'spritesheet_clone_active_layer',\n  'spritesheet_update_layer_label',\n  'spritesheet_make_layer_active',\n  'spritesheet_swap_layers',\n  'spritesheet_focus_rename_active_layer',\n  'spritesheet_zoom',\n  'spritesheet_zoom_in',\n  'spritesheet_zoom_out',\n  'spritesheet_zoom_reset',\n  'spritesheet_set_active_tool',\n  'spritesheet_import',\n  'spritesheet_export',\n  'spritesheet_import_chr',\n  'spritesheet_export_chr',\n  'spritesheet_export_png',\n\n  // themes\n  'toggle_theme',\n  'light_theme',\n  'dark_theme',\n);\n\nexport default actions;","(function(a,b){if(\"function\"==typeof define&&define.amd)define([],b);else if(\"undefined\"!=typeof exports)b();else{b(),a.FileSaver={exports:{}}.exports}})(this,function(){\"use strict\";function b(a,b){return\"undefined\"==typeof b?b={autoBom:!1}:\"object\"!=typeof b&&(console.warn(\"Deprecated: Expected third argument to be a object\"),b={autoBom:!b}),b.autoBom&&/^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(a.type)?new Blob([\"\\uFEFF\",a],{type:a.type}):a}function c(a,b,c){var d=new XMLHttpRequest;d.open(\"GET\",a),d.responseType=\"blob\",d.onload=function(){g(d.response,b,c)},d.onerror=function(){console.error(\"could not download file\")},d.send()}function d(a){var b=new XMLHttpRequest;b.open(\"HEAD\",a,!1);try{b.send()}catch(a){}return 200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent(\"click\"))}catch(c){var b=document.createEvent(\"MouseEvents\");b.initMouseEvent(\"click\",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f=\"object\"==typeof window&&window.window===window?window:\"object\"==typeof self&&self.self===self?self:\"object\"==typeof global&&global.global===global?global:void 0,a=f.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=f.saveAs||(\"object\"!=typeof window||window!==f?function(){}:\"download\"in HTMLAnchorElement.prototype&&!a?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement(\"a\");g=g||b.name||\"download\",j.download=g,j.rel=\"noopener\",\"string\"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target=\"_blank\")):(j.href=i.createObjectURL(b),setTimeout(function(){i.revokeObjectURL(j.href)},4E4),setTimeout(function(){e(j)},0))}:\"msSaveOrOpenBlob\"in navigator?function(f,g,h){if(g=g||f.name||\"download\",\"string\"!=typeof f)navigator.msSaveOrOpenBlob(b(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement(\"a\");i.href=f,i.target=\"_blank\",setTimeout(function(){e(i)})}}:function(b,d,e,g){if(g=g||open(\"\",\"_blank\"),g&&(g.document.title=g.document.body.innerText=\"downloading...\"),\"string\"==typeof b)return c(b,d,e);var h=\"application/octet-stream\"===b.type,i=/constructor/i.test(f.HTMLElement)||f.safari,j=/CriOS\\/[\\d]+/.test(navigator.userAgent);if((j||h&&i||a)&&\"undefined\"!=typeof FileReader){var k=new FileReader;k.onloadend=function(){var a=k.result;a=j?a:a.replace(/^data:[^;]*;/,\"data:attachment/file;\"),g?g.location.href=a:location=a,g=null},k.readAsDataURL(b)}else{var l=f.URL||f.webkitURL,m=l.createObjectURL(b);g?g.location=m:location.href=m,g=null,setTimeout(function(){l.revokeObjectURL(m)},4E4)}});f.saveAs=g.saveAs=g,\"undefined\"!=typeof module&&(module.exports=g)});\n\n//# sourceMappingURL=FileSaver.min.js.map","import { saveAs } from 'file-saver';\r\n\r\nexport const filename = (filename, extension) => {\r\n  const d = new Date();\r\n  const date = `${String(d.getFullYear())}_${String(d.getMonth()).padStart(2, '0')}_${String(d.getDay()).padStart(2, '0')}`;\r\n  return `${date}_${filename}.${extension}`;\r\n}\r\n\r\nexport const fileDialog = (accept = [], callback = _ => _, options = { readAs: 'text'}) => {\r\n  if(!Array.isArray(accept)){\r\n    throw new Error(`Invalid 'fileDialog' accept. Expecting array of file extentions`);\r\n  }\r\n  if(typeof callback !== 'function'){\r\n    throw new Error(`Invalid 'fileDialog' callback function`);\r\n  }\r\n  const  input = document.createElement('input');\r\n  input.type = 'file';\r\n  input.accept = accept.map(ext => ext.startsWith('.') ? ext : '.' + ext).join(',');\r\n  \r\n  input.addEventListener('change', e => { \r\n    // getting a hold of the file reference\r\n    const file = e.target.files[0]; \r\n\r\n    // setting up the reader\r\n    const reader = new FileReader();\r\n\r\n    switch(options.readAs){\r\n      case 'binary':\r\n        reader.readAsBinaryString(file);\r\n      break;\r\n      case 'arraybuffer':\r\n        reader.readAsArrayBuffer(file);\r\n      break;\r\n      case 'text':\r\n      default:\r\n        reader.readAsText(file, options.encoding || 'utf-8');\r\n      break;\r\n    }\r\n\r\n    // here we tell the reader what to do when it's done reading...\r\n    reader.addEventListener('load', (e) => {\r\n      // call the palette import\r\n      callback.call(null, e.target.result);\r\n    });\r\n  });\r\n  \r\n  // execute it\r\n  input.click();\r\n}\r\n\r\nexport const saveDialog = (filename, data, options = {}) => {\r\n  const blob = new Blob([data], { type: options.type || \"application/json;charset=utf-8\" });\r\n  saveAs(blob, filename);\r\n}","export const application = {\r\n  startPage: '/graphics/spritesheets'\r\n}\r\n\r\nexport const filetypes = {\r\n  // project \r\n  project: {\r\n    save: {\r\n      mimetype: \"nesbit/project\",\r\n      extension: \"nesbitproject\",\r\n      version: 2\r\n    }\r\n  },\r\n  // palettes \r\n  palettes: {\r\n    save: {\r\n      mimetype: \"nesbit/palette\",\r\n      extension: \"nesbitpalette\",\r\n      version: 2,\r\n    },\r\n    export: {\r\n      mimetype: \"text/plain\",\r\n      extension: \"\",\r\n      version: 1\r\n    }\r\n  },\r\n  // spritesheets \r\n  spritesheets: {\r\n    save: {\r\n      mimetype: \"nesbit/spritesheet\",\r\n      extension: \"nesbitspritesheet\",\r\n      version: 1\r\n    },\r\n    export: {\r\n      mimetype: \"text/plain\",\r\n      extension: \"\",\r\n      version: 1\r\n    }\r\n  },\r\n\r\n  // settings\r\n  settings: {\r\n    save: {\r\n      mimetype: \"nesbit/settings\",\r\n      extension: \"nesbitsettings\",\r\n      version: 2\r\n    }\r\n  }\r\n}\r\n\r\nexport default { \r\n  application,\r\n  filetypes\r\n};","import { get, writable } from \"svelte/store\";\r\nimport NESPalette from '~/application/palettes/nespalette';\r\nimport Config from '~/nesbit.config';\r\n\r\nimport { uuid } from '~/utils/numbers';\r\n\r\n// get the default color\r\n// weird but wtf is it a reference or not? i'm just making sure we doesn't mutate the nespalette so we seralize and unserialize it here.\r\nconst findPalette = (hex) => JSON.parse(JSON.stringify(NESPalette.find(o => o.hex == hex)));\r\nconst colorPlaceholder = findPalette('0F');\r\n\r\n// store global id count\r\nlet id = 1;\r\n// colorpalette \r\nclass ColorPaletteGroup{\r\n  constructor(label, colors){\r\n    this.label = label || '';\r\n    this.colors = [];\r\n    this.uuid = ++id;\r\n    if(Array.isArray(colors) && colors.length == 4){\r\n      for(const color of colors){\r\n        this.addColor(color.hex);\r\n      }\r\n    }else{\r\n      this.colors = [...Array(4).fill('').map(item => ({ ...colorPlaceholder }))];\r\n    }\r\n  }\r\n  addColor(hex){\r\n    if(!(this.colors.length < 4)){\r\n      throw new Error(`Max 4 colors per 'ColorPaletteGroup'`);\r\n    }\r\n    const palette = findPalette(hex);\r\n    if(palette){\r\n      this.colors.push({...palette});\r\n    }\r\n  }\r\n}\r\n\r\n// store\r\nexport const palettesStore = (() => {\r\n  const reset = _ => ({\r\n    activeLayer: undefined, \r\n    layers: [],\r\n    selectedColor: 0,\r\n  });\r\n  const store = writable(reset());\r\n  const { subscribe, set, update } = store;\r\n  const storeFunctions = {\r\n    subscribe,\r\n    getActiveLayer(){\r\n      return get(store).activeLayer;\r\n    },\r\n    setSelectedColor(n){\r\n      if(!Number.isInteger(n)){\r\n        throw new Error(`Invalid 'setSelectedColor' value. Expecting 'Integer'`);\r\n      }\r\n      if(!(n >= 0 && n <= 4)){\r\n        throw new Error(`Invalid 'setSelectedColor' number range. Expecting number between '0-4'`);\r\n      }\r\n      update(store => {\r\n        store.selectedColor = n;\r\n        return store;\r\n      });\r\n    },\r\n    create({ label, colors } = {}){\r\n      update(store => {\r\n        label = label || 'palette_' + (store.layers.length+1);\r\n        const paletteGroup = new ColorPaletteGroup(label, colors);\r\n        store.layers.push(paletteGroup);\r\n        // make active \r\n        if(!store.activeLayer){\r\n          storeFunctions.makeActive(paletteGroup);\r\n        }\r\n\r\n        return store;\r\n      });\r\n    },\r\n    clear(){\r\n      // clear store\r\n      set(reset());\r\n    },\r\n    layerIndexFromSource(source){\r\n      const index = get(palettesStore).layers.indexOf(source);\r\n      return index;\r\n    },\r\n    getActiveColorIndex(){\r\n      return get(palettesStore).selectedColor;\r\n    },\r\n    getActiveColor(i){\r\n      const store = get(palettesStore); \r\n      return store.activeLayer.colors[(i >= 0 && i<= 4 ? i : store.selectedColor)];\r\n    },\r\n    makeActive(source){\r\n      // check to see if the source already is active so it doesn't gets called again \r\n      // if that would be the case \r\n      if(source == get(store).activeLayer){\r\n        return;\r\n      }\r\n      update(store => {\r\n        const index = store.layers.indexOf(source);\r\n        store.activeLayer = store.layers[index];\r\n        return store;\r\n      });\r\n    },\r\n    remove(source){\r\n      update((store) => {\r\n        const index = store.layers.indexOf(source);\r\n        if(store.layers[index] == store.activeLayer){\r\n          // if there is a palette/layer after the currently removed, make that one the active one \r\n          if(store.layers[index+1]){\r\n            storeFunctions.makeActive(store.layers[index+1]);\r\n          }else if(store.layers[index-1]){\r\n            storeFunctions.makeActive(store.layers[index-1]);\r\n          }else{\r\n            store.activeLayer = undefined;\r\n          }\r\n        }\r\n        // remove object\r\n        store.layers.splice(index, 1);\r\n        return store;\r\n      });\r\n    },\r\n    swapLayers(i, j){\r\n      update(store => {\r\n        const arr = [...store.layers];\r\n        [arr[i], arr[j]] = [arr[j], arr[i]]; \r\n        store.layers = [...arr]; \r\n        return store;  \r\n      });\r\n    },\r\n    clone(source){\r\n      if(!source) return;\r\n      const _store = get(store);\r\n      const index = _store.layers.indexOf(source);\r\n      if(_store.layers[index] == source){\r\n        update(store => {\r\n          let heading = source.label + ' copy';\r\n          const paletteGroup = new ColorPaletteGroup(heading);\r\n          for(const color in source.colors){\r\n            paletteGroup.colors[color] = {...findPalette(source.colors[color].hex)};\r\n          }\r\n          store.layers.push(paletteGroup);\r\n          storeFunctions.makeActive(paletteGroup);\r\n          return store;\r\n        });\r\n      }\r\n    },\r\n    updateHeading(source, string){\r\n      update(store => {\r\n        const index = store.layers.indexOf(source);\r\n        store.layers[index].label = string;\r\n        return store;\r\n      });\r\n    },\r\n    swapColors(data){\r\n      update((store) => {\r\n        const ref = store.layers[data.layerIndex].colors;\r\n        const ref2 = store.layers[data.to.layerIndex].colors;\r\n        // this is all redundant but in place if things change in the future        \r\n        let from = ref[data.colorIndex];\r\n        let to = ref2[data.to.colorIndex];\r\n        \r\n        // swap the colors\r\n        ref[data.colorIndex] = { ...findPalette(to.hex) };\r\n        ref2[data.to.colorIndex] = { ...findPalette(from.hex) };\r\n\r\n        // make active \r\n        if(data.layerIndex != data.to.layerIndex){\r\n          storeFunctions.makeActive(store.layers[data.to.layerIndex]);\r\n        }\r\n\r\n        return store;\r\n      });\r\n    },\r\n    replaceColor(data){\r\n      update((store) => {\r\n        const layer = store.layers[data.layerIndex];\r\n\r\n        // not really required but might be easier to manage in the future\r\n        const palette = findPalette(data.hex);\r\n\r\n        layer.colors[data.colorIndex] = {\r\n          hex: palette.hex,\r\n          rgb: palette.rgb\r\n        }\r\n\r\n        storeFunctions.makeActive(store.layers[data.layerIndex]);\r\n\r\n        return store;\r\n      });\r\n    },\r\n    export(serialize){\r\n      let data = {version: Config.filetypes.palettes.save.version, data: [...get(palettesStore).layers]};\r\n      if(serialize){\r\n        data = JSON.stringify(data);\r\n      }\r\n      return data;\r\n    },\r\n    import(serializedData){\r\n      const unserializedData = JSON.parse(serializedData);\r\n      if(unserializedData.version == Config.filetypes.palettes.save.version){\r\n        for(const palette of unserializedData.data){\r\n          storeFunctions.create({...palette})\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return storeFunctions;\r\n})();\r\n\r\n\r\n// NOTE: temp import during development \r\nconst json = `{\"version\":2,\"data\":[{\"label\":\"fire\",\"colors\":[{\"hex\":\"0F\",\"rgb\":[0,0,0]},{\"hex\":\"27\",\"rgb\":[252,160,68]},{\"hex\":\"06\",\"rgb\":[168,16,0]},{\"hex\":\"07\",\"rgb\":[136,20,0]}]},{\"label\":\"purple\",\"colors\":[{\"hex\":\"0F\",\"rgb\":[0,0,0]},{\"hex\":\"16\",\"rgb\":[248,56,0]},{\"hex\":\"13\",\"rgb\":[104,68,252]},{\"hex\":\"03\",\"rgb\":[68,40,188]}]},{\"label\":\"teal\",\"colors\":[{\"hex\":\"0F\",\"rgb\":[0,0,0]},{\"hex\":\"31\",\"rgb\":[164,228,252]},{\"hex\":\"1C\",\"rgb\":[0,136,136]},{\"hex\":\"0C\",\"rgb\":[0,64,88]}]},{\"label\":\"blue steele\",\"colors\":[{\"hex\":\"0F\",\"rgb\":[0,0,0]},{\"hex\":\"12\",\"rgb\":[0,88,248]},{\"hex\":\"01\",\"rgb\":[0,0,252]},{\"hex\":\"02\",\"rgb\":[0,0,188]}]}]}`;\r\npalettesStore.import(json);\r\n","import { writable as _writable, get } from \"svelte/store\"\r\n\r\nexport const writable = (value, fn) => {\r\n  const store = _writable(value);\r\n  let ret = { ...store, get: _ => get(store) };\r\n  if(fn){\r\n    ret = { ...ret, ...(fn.call(null, { value, store, get: ret.get } || { ...ret })) };\r\n  }\r\n  return Object.freeze(ret);\r\n}","// shuffel an array\r\n// https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle\r\nexport const shuffle = (array) => {\r\n  for(let i = array.length - 1; i > 0; i--){\r\n    let j = Math.floor(Math.random() * (i + 1));\r\n    [array[i], array[j]] = [array[j], array[i]];\r\n  }\r\n  return array;\r\n}\r\n\r\n// split array into chunks\r\nexport const chunk = (array, size) => {\r\n  const length = array ? array.length : 0;\r\n  if(length < 1){\r\n    return [];\r\n  }\r\n  const result = new Array(Math.ceil(length / size));\r\n  let index = 0, resIndex = 0;\r\n  while(index < length){\r\n    result[resIndex++] = array.slice(index, (index += size));\r\n  }\r\n  return result;\r\n}","import * as array from './array.js';\r\n\r\n// convert the number to a binary string\r\nconst getBinaryStringFromNumber = (n) => {\r\n  // convert to binary\r\n  n = Number(n >>> 0).toString(2);\r\n  // force it's length to be 8 by padding 0's\r\n  return '00000000'.substring(n.length)+n;\r\n}\r\n\r\n/*\r\n  Get color definition from high low\r\n\r\n  the chr can have 4 values. 0-3. \r\n  'a' has a weight of 1 and 'b' has a weight of 2. \r\n  a, b, result\r\n  0, 0, 0, // both a and b are 0 so the result is 0\r\n  1, 0, 1, // a is set to 1 so it becomes one\r\n  0, 1, 2, // a is set to 0 and b is 1 so it becomes 2. (because b has a weight of 2)\r\n  1, 1, 3, // a and b is set to 1 so the result becomes 3. a(1) + b(2) = 3\r\n\r\n  @param String (binary string)\r\n  @param String (binary string)\r\n\r\n  @return Array\r\n*/\r\nfunction getColorDefinitionFromHighLow(low, high){\r\n  // this will be 0 or 1 if it does not get \r\n  // replaced in the following if statements\r\n  let n = Number(low);\r\n  // if high != 0. it's 2. since thats either 0 or 1. \r\n  // and if its not 0(which would be false) its 1. meaning it's 2\r\n  if(Number(high)){\r\n    n = 2;\r\n  }\r\n  // if low + high > 1(if both a and b is set. it's larger than 1. then we know it has to be 3. 1 + 2 = 3)\r\n  if((Number(low) + Number(high)) > 1){\r\n    n = 3;\r\n  }\r\n  return n;\r\n}\r\n\r\n/* \r\n  parse contents of a NES chr file \r\n\r\n  @param ArrayBuffer\r\n  @return Array\r\n\r\n  This function will return a 16x16 2d array of 8x8 2d array representing each tile \r\n*/\r\nexport const parse = (data) => {\r\n  // split the byte array in chunks of 16. 1 row = 16 tiles.\r\n  // a tile is 8x8. which means you have 64 pixels in each tile. \r\n  // each pixel has 4 available color values which ends up to (8x8) x 4(color value from 0-3) = 256.\r\n  const chunks = array.chunk(new Uint8Array(data), 16);\r\n  let tiles = [];\r\n  for(let chunk of chunks){\r\n    let low, high, tile = [];\r\n    // handle all 16 bits. \r\n    // the first 8 bits is the low \r\n    // and the second 8 bits is the high\r\n    for(let i = 8; i < 16; i++){\r\n      low = getBinaryStringFromNumber(chunk[i-8]);\r\n      high = getBinaryStringFromNumber(chunk[i]);\r\n      // create the pixel definition from the low and high bits\r\n      // this would be a row of 8 pixels. the loop will do \r\n      // this 8 times to form a 8x8 tile\r\n      const pixelRow = [];\r\n      for(let i = 0; i < 8; i++){\r\n        const pixel = getColorDefinitionFromHighLow(low[i], high[i]);\r\n        pixelRow.push(pixel);  \r\n      }\r\n      tile.push(pixelRow);\r\n    }\r\n    tiles.push(tile);\r\n  }\r\n  // split the tiles array by 16. \r\n  // 16 8x8 tiles per each row\r\n  tiles = array.chunk(tiles, 16);\r\n  // split the CHR data in parts of size(16 for the nes) for giving 16x16 per page\r\n  return array.chunk(tiles, 16);\r\n}\r\n\r\nconst colorMap = (pixel) => {\r\n  const rgb = Math.floor((pixel[0] + pixel[1] + pixel[2]) / 3);\r\n  return [0x00, 0x55, 0xAA, 0xFF].reduce((prev, curr) => {\r\n    return (Math.abs(curr - rgb) < Math.abs(prev - rgb) ? curr : prev);\r\n  });\r\n}\r\n\r\n/*\r\n  generate chr export\r\n  from the pixel definition we can get the corresponding low and high bits. this could be done manually or \r\n  by doing a bitwise AND and right shift the high bits by 1 to get the opposite values implemented below.\r\n\r\n  n: 0\r\n  0x00 & 0x01 = 0\r\n  00000000\r\n  00000001\r\n\r\n  n: 1\r\n  0x55 & 0x01 = 1\r\n  ‭01010101‬\r\n  00000001\r\n\r\n  n: 2\r\n  0xAA & 0x01 = 0\r\n  ‭10101010\r\n  00000001\r\n  ‬\r\n  n: 3\r\n  0xFF & 0x01 = 1\r\n  ‭11111111\r\n  00000001\r\n\r\n*/\r\nexport const generateExport = (data) => {\r\n  // mappings of 4 parts of hex value up to 255. \r\n  // this to be able to implement colors later \r\n  const map = [0x00, 0x55, 0xAA, 0xFF];\r\n  // 4kb buffer\r\n  const buff = new ArrayBuffer(4096);\r\n  const output = new Uint8Array(buff);\r\n  // store the binary string\r\n  let bin = '';\r\n  // loop through the nested 2d arrays\r\n  for(let h of data){\r\n    for(let w of h){\r\n      // store low and high bits\r\n      let low = '', high = '';\r\n      for(let x of w){\r\n        for(let n of x){\r\n          // map current value for numbers 0-4\r\n          const v = map[n];\r\n          low += v & 0x01;\r\n          high += (v >> 1) & 0x01;\r\n        }\r\n      }\r\n      // add the low and high values to binary\r\n      bin += low + high;\r\n    }\r\n  }\r\n  // split binary string in 8's and append each 8 bits to the buffer\r\n  bin.match(/.{8}/g).map((_, i) => output[i] = parseInt(_, 2));\r\n  return output;\r\n}","import { writable } from '~/utils/store';\r\n\r\nimport NESPalette from '~/application/palettes/nespalette';\r\nimport Config from '~/nesbit.config';\r\n\r\n// get the default color\r\n// weird but wtf is it a reference or not? i'm just making sure we doesn't mutate the nespalette so we seralize and unserialize it here.\r\nconst findNESPalette = (hex) => JSON.parse(JSON.stringify(NESPalette.find(o => o.hex == hex)));\r\nconst colorPlaceholder = findNESPalette('0F');\r\n\r\n// store global id count\r\nlet id = 1;\r\n// colorpalette \r\nclass ColorPaletteGroup{\r\n  constructor(label, colors){\r\n    this.label = label || '';\r\n    this.colors = [];\r\n    this.uuid = ++id;\r\n    if(Array.isArray(colors) && colors.length == 4){\r\n      for(const color of colors){\r\n        this.addColor(color.hex);\r\n      }\r\n    }else{\r\n      this.colors = [...Array(4).fill('').map(item => ({ ...colorPlaceholder }))];\r\n    }\r\n  }\r\n  addColor(hex){\r\n    if(!(this.colors.length < 4)){\r\n      throw new Error(`Max 4 colors per 'ColorPaletteGroup'`);\r\n    }\r\n    const palette = findNESPalette(hex);\r\n    if(palette){\r\n      this.colors.push({...palette});\r\n    }\r\n  }\r\n}\r\n\r\n// selected color store\r\nconst selectedColor = writable(0, ({ store, get }) => {\r\n  return {\r\n    // set the active color index\r\n    setActiveColorIndex(n){\r\n      if(!Number.isInteger(n)){\r\n        throw new Error(`Invalid 'setActiveColorIndex' value. Expecting 'Integer'`);\r\n      }\r\n      if(!(n >= 0 && n <= 4)){\r\n        throw new Error(`Invalid 'setActiveColorIndex' number range. Expecting number between '0-4'`);\r\n      }\r\n      store.set(n);\r\n    },\r\n    // get active color value\r\n    getActiveColorValue(n){\r\n      const activeLayer = Palettes.stores.activeLayer.get();\r\n      if(!activeLayer){\r\n        throw new Error(`No 'activeLayer' selected`);\r\n      }\r\n      if(!Number.isInteger(n)){\r\n        n = get();\r\n      }\r\n      return activeLayer.colors[n];\r\n    }\r\n  }\r\n});\r\n\r\n// layers store\r\nconst layers = writable([], ({ store, value, get, update }) => {\r\n  return {\r\n    // clear all layers\r\n    clear(){\r\n      Palettes.stores.activeLayer.set(undefined);\r\n      store.set([]);\r\n    },\r\n    // swap layers\r\n    swapLayers(i, j){\r\n      store.update(_store => {\r\n        const arr = [..._store];\r\n        [arr[i], arr[j]] = [arr[j], arr[i]]; \r\n        _store = [...arr]; \r\n        Palettes.stores.activeLayer.set(_store[j]);\r\n        return _store;  \r\n      });\r\n    },\r\n    // replace color\r\n    replaceColor(data){\r\n      store.update((_store) => {\r\n        const layer = _store[data.layerIndex];\r\n        // not really required but might be easier to manage in the future\r\n        const colorFromPalette = findNESPalette(data.hex);\r\n\r\n        // add the new color values\r\n        layer.colors[data.colorIndex] = {\r\n          hex: colorFromPalette.hex,\r\n          rgb: colorFromPalette.rgb\r\n        }\r\n\r\n        // make the layer active. This updates the activeLayer so we don't have to \r\n        // force a manual update to make main artboard palette react to the changes\r\n        // and also it's nice to automatically change the active palette\r\n        Palettes.makeLayerActive(_store[data.layerIndex]);\r\n        return _store;\r\n      });\r\n    },\r\n\r\n    // swap colors\r\n    swapColors(data){\r\n      store.update((_store) => {\r\n        Palettes.update();\r\n        const ref = _store[data.layerIndex].colors;\r\n        const ref2 = _store[data.to.layerIndex].colors;\r\n        // this is all redundant but in place if things change in the future        \r\n        let from = ref[data.colorIndex];\r\n        let to = ref2[data.to.colorIndex];\r\n        \r\n        // swap the colors\r\n        ref[data.colorIndex] = { ...findNESPalette(to.hex) };\r\n        ref2[data.to.colorIndex] = { ...findNESPalette(from.hex) };\r\n\r\n        // make active just to force a reactive update and also if swapped \r\n        // between layers we use the new layer\r\n        Palettes.makeLayerActive(_store[data.to.layerIndex]);\r\n\r\n        return _store;\r\n      });\r\n    },\r\n  }\r\n})\r\n\r\nexport const Palettes = writable({ selectedColor, activeLayer: writable(), layers }, ({ store, value, get }) => {\r\n  return {\r\n    lastChanged: writable(), \r\n    stores: value,\r\n    // update\r\n    update(){\r\n      Palettes.lastChanged.set(Math.random() + Date.now()); \r\n    },\r\n    // create new color palette\r\n    createLayer({ label, colors } = {}, push = false){\r\n      value.layers.update(_store => {\r\n        label = label || 'palette_' + (_store.length+1);\r\n        const paletteGroup = new ColorPaletteGroup(label, colors);\r\n        // if we need to add the new layer to the end of the layer stack\r\n        // for instance on imports, else imports would become reversed\r\n        if(push){\r\n          _store = [..._store, paletteGroup];\r\n        }else{\r\n          _store = [paletteGroup, ..._store];\r\n        }\r\n        // make active \r\n        Palettes.makeLayerActive(paletteGroup);\r\n        return _store;\r\n      });\r\n    },\r\n\r\n    // remove layer\r\n    removeLayer(ColorPaletteGroupInstance){\r\n      value.layers.update((_store) => {\r\n        const index = _store.indexOf(ColorPaletteGroupInstance);\r\n        if(ColorPaletteGroupInstance == value.activeLayer.get()){\r\n          // if there is a palette/layer after the currently removed, make that one the active one \r\n          if(_store[index+1]){\r\n            Palettes.makeLayerActive(_store[index+1]);\r\n          }else if(_store[index-1]){\r\n            Palettes.makeLayerActive(_store[index-1]);\r\n          }else{\r\n            value.activeLayer.set(undefined);\r\n          }\r\n        }\r\n        // remove object\r\n        _store.splice(index, 1);\r\n        return _store;\r\n      });\r\n    },\r\n\r\n    // clone layer \r\n    cloneLayer(ColorPaletteGroupInstance){\r\n      // TODO: make so the index position is right above the clones layer. currently\r\n      // it gets added to the top of the stack as the first array element, which is not ideal.\r\n      value.layers.update((_store) => {\r\n        let { label, colors } = ColorPaletteGroupInstance;\r\n        // NOTE: probably have to serialize the data so it doesn't act as a reference \r\n        // data = JSON.stringify(JSON.parse(data));\r\n        label = label + ' copy';\r\n        const newLayer = new ColorPaletteGroup(label, colors);\r\n        _store = [ newLayer, ..._store];\r\n        Palettes.makeLayerActive(newLayer);\r\n        return _store;  \r\n      });\r\n    },\r\n    \r\n    // clone active layer \r\n    cloneActiveLayer(){\r\n      const active = value.activeLayer.get();\r\n      if(active){\r\n        Palettes.cloneLayer(active);\r\n      }else{\r\n        Palettes.createLayer();\r\n      }\r\n    },\r\n\r\n    // make a layer active\r\n    makeLayerActive(ColorPaletteGroupInstance){\r\n      if(!(ColorPaletteGroupInstance instanceof ColorPaletteGroup)){\r\n        throw new Error(`Invalid 'ColorPaletteGroupInstance' while setting 'activeLayer'`);\r\n      }\r\n      value.activeLayer.set(ColorPaletteGroupInstance);\r\n    },\r\n\r\n    // layer index from source\r\n    layerIndexFromSource(ColorPaletteGroupInstance){\r\n      if(!(ColorPaletteGroupInstance instanceof ColorPaletteGroup)){\r\n        throw new Error(`Invalid 'ColorPaletteGroupInstance' in 'layerIndexFromSource'`);\r\n      }\r\n      return value.layers.get().indexOf(ColorPaletteGroupInstance);\r\n    },\r\n    \r\n    // update label\r\n    updateLayerLabel(ColorPaletteGroupInstance, label){\r\n      value.layers.update((_store) => {\r\n        ColorPaletteGroupInstance.label = label;\r\n        Palettes.makeLayerActive(ColorPaletteGroupInstance);\r\n        return _store;\r\n      });\r\n    },\r\n\r\n    // import \r\n    import(serializedData){\r\n      const shouldMakeActive = Palettes.stores.layers.get().length <= 0;\r\n      const unserializedData = JSON.parse(serializedData);\r\n      if(unserializedData.version == Config.filetypes.palettes.save.version){\r\n        for(const palette of unserializedData.data){\r\n          Palettes.createLayer({ ...palette }, true);\r\n        }\r\n      }\r\n      if(shouldMakeActive && Palettes.stores.layers.length){\r\n        Palettes.makeLayerActive(Palettes.stores.layers.get()[0]);\r\n      }\r\n    },\r\n\r\n    // export\r\n    export(serialize){\r\n      const layers = Palettes.stores.layers.get();\r\n      let data = { version: Config.filetypes.palettes.save.version, data: [...layers] };\r\n      if(serialize){\r\n        data = JSON.stringify(data);\r\n      }\r\n      return data;\r\n    },\r\n\r\n  }\r\n});\r\n\r\n// NOTE: temp import during development \r\nconst json = `{\"version\":2,\"data\":[{\"label\":\"fire\",\"colors\":[{\"hex\":\"0F\",\"rgb\":[0,0,0]},{\"hex\":\"27\",\"rgb\":[252,160,68]},{\"hex\":\"06\",\"rgb\":[168,16,0]},{\"hex\":\"07\",\"rgb\":[136,20,0]}]},{\"label\":\"purple\",\"colors\":[{\"hex\":\"0F\",\"rgb\":[0,0,0]},{\"hex\":\"16\",\"rgb\":[248,56,0]},{\"hex\":\"13\",\"rgb\":[104,68,252]},{\"hex\":\"03\",\"rgb\":[68,40,188]}]},{\"label\":\"teal\",\"colors\":[{\"hex\":\"0F\",\"rgb\":[0,0,0]},{\"hex\":\"31\",\"rgb\":[164,228,252]},{\"hex\":\"1C\",\"rgb\":[0,136,136]},{\"hex\":\"0C\",\"rgb\":[0,64,88]}]},{\"label\":\"blue steele\",\"colors\":[{\"hex\":\"0F\",\"rgb\":[0,0,0]},{\"hex\":\"12\",\"rgb\":[0,88,248]},{\"hex\":\"01\",\"rgb\":[0,0,252]},{\"hex\":\"02\",\"rgb\":[0,0,188]}]}]}`;\r\nPalettes.import(json);","import { Palettes } from '~/stores/palettes.store.js';\r\n\r\nexport default class CanvasLayer{\r\n  constructor({ label, width, height, data } = {}){\r\n    this._isInitialized = false;\r\n    this.uuid = Math.random() + Date.now();\r\n    this.width = width || 128;\r\n    this.height = height || 128;\r\n    this.label = label || ''\r\n    this.element = document.createElement('canvas');\r\n    this.element.width = this.width;\r\n    this.element.height = this.height;\r\n    this.context = this.element.getContext('2d');\r\n    this.data = data;\r\n    // generate a double nested array list. 16x16 column then inside each tile they are 8x8 pixels wide\r\n    if(!this.data){\r\n      this.data = new Array(16).fill().map(_ => new Array(16).fill().map(_ => new Array(8).fill().map(_ => new Array(8).fill().map(_ => 0))));\r\n    }else{\r\n      if(!this._isInitialized){\r\n        // draw it on first instantiation else imports wont reveal themselves unless becoming active layers\r\n        this.drawFromSource(Palettes.stores.activeLayer.get());\r\n      }\r\n    }\r\n  }\r\n  async toDataURL(mimetype = 'image/png', quality){\r\n    const blob = await fetch(this.element.toDataURL(mimetype, quality)).then(res => res.blob());\r\n    return blob;\r\n  }\r\n  // get palette info from x y \r\n  colorIndexAtPosition(x, y){\r\n    const data = this.data;\r\n    const rc = {x: Math.floor(x / 8), y: Math.floor(y / 8)};\r\n    const tile = {x: x % 8, y: y % 8};\r\n    const colorIndex = data[rc.y][rc.x][tile.y][tile.x];\r\n    return colorIndex;\r\n  }\r\n  setColorIndexAtPosition(x, y, colorIndex){\r\n    const data = this.data;\r\n    const rc = {x: Math.floor(x / 8), y: Math.floor(y / 8)};\r\n    const tile = {x: x % 8, y: y % 8};\r\n    data[rc.y][rc.x][tile.y][tile.x] = colorIndex;\r\n  }\r\n  drawFromSource(palette){\r\n    if(!palette) return;\r\n    if(!this._isInitialized){\r\n      this._isInitialized = true;\r\n    }\r\n\r\n    // TODO: whenever a drawFromSource happends store a history \r\n    // of it so it's possible to revert changes and mistakes\r\n    // this.history.push(this.data); \r\n\r\n    // one line list of tiles... split on % 16 for new row\r\n    this.data.map((trow, tr) => {\r\n      trow.map((tcol, tc) => {\r\n        this.context.save();\r\n        this.context.translate(tc*8, tr*8)\r\n\r\n          tcol.map((col, c) => {\r\n            this.context.save()\r\n            this.context.translate(0, c)\r\n\r\n              col.map((row, r) => {\r\n                this.context.save();\r\n                this.context.translate(r, 0);\r\n\r\n                let color = palette.colors[row];\r\n                if(!color){\r\n                  return;\r\n                }\r\n                this.context.fillStyle = `rgb(${color.rgb})`;\r\n                this.context.fillRect(0,0,1,1);\r\n                this.context.restore();\r\n\r\n              });\r\n              \r\n            this.context.restore();\r\n          });\r\n\r\n        this.context.restore();      \r\n      });\r\n    });\r\n    \r\n  }\r\n  clear(){\r\n    this.context.clearRect(0, 0, this.element.width, this.element.height);\r\n  }\r\n}","import { writable } from '~/utils/store.js';\r\nimport * as chr from '~/utils/chr.js';\r\nimport CanvasLayer from '~/modules/spritesheet_editor/CanvasLayer.js';\r\n\r\nimport Config from '~/nesbit.config.js';\r\n\r\nconst layers = writable([], ({ store, value, get }) => {\r\n  return {\r\n    // swap layers\r\n    swapLayers(i, j){\r\n      store.update(_store => {\r\n        const arr = [..._store];\r\n        [arr[i], arr[j]] = [arr[j], arr[i]]; \r\n        _store = [...arr]; \r\n        Spritesheets.stores.activeLayer.set(_store[i]);\r\n        return _store;  \r\n      });\r\n    },\r\n  }\r\n})\r\n\r\nconst activeLayer = writable(undefined);\r\n\r\nexport const Spritesheets = writable({ activeLayer, layers }, ({ store, value, get }) => {\r\n  const findLayerFromIndex = (index) => {\r\n    const layers = Spritesheets.stores.layers.get();\r\n    if(!layers[index]){\r\n      throw new Error(`Could not find layer by index : [${index}]`);\r\n    }\r\n    return layers[index];\r\n  };\r\n\r\n  const findLayerIndexFromInstance = (CanvasLayerInstance) => {\r\n    const index = Spritesheets.stores.layers.get().indexOf(CanvasLayerInstance)\r\n    if(!index){\r\n      throw new Error(`Could not find layer by index : [${index}]`);\r\n    }\r\n    return index;\r\n  };\r\n\r\n  return {\r\n    data: {\r\n      width: 128,\r\n      height: 128,\r\n    },\r\n    stores: value,\r\n    // create a new spritesheet layer\r\n    createLayer({ label, data } = {}){\r\n      Spritesheets.stores.layers.update(_store => {\r\n        label = label || 'spritesheet_' + (_store.length+1);\r\n        const CanvasLayerInstance = new CanvasLayer({ label, data });\r\n        const _store_copy = [CanvasLayerInstance, ..._store];\r\n        // _store = [..._store, CanvasLayerInstance];\r\n        // do we always want to make the new layer active?\r\n        // if(_store.length <= 1){\r\n        //   Spritesheets.makeLayerActive(CanvasLayerInstance);\r\n        // }\r\n        // make new layer active\r\n        Spritesheets.makeLayerActive(CanvasLayerInstance);\r\n        return _store_copy;\r\n      });\r\n    },\r\n\r\n    // remove layer\r\n    // NOTE: memory leak if all layers is removed. adding layer after all is remove\r\n    // leas to more and more memory leaks for each time the whole array gets empty. \r\n    removeLayer(CanvasLayerInstance){\r\n      Spritesheets.stores.layers.update((_store) => {\r\n        let _store_copy = [..._store];\r\n        const index = _store_copy.indexOf(CanvasLayerInstance);\r\n        if(CanvasLayerInstance == Spritesheets.stores.activeLayer.get()){\r\n          // if there is a palette/layer after the currently removed, make that one the active one \r\n          if(_store_copy[index+1]){\r\n            Spritesheets.makeLayerActive(_store_copy[index+1]);\r\n          }else if(_store_copy[index-1]){\r\n            Spritesheets.makeLayerActive(_store_copy[index-1]);\r\n          }else{\r\n            Spritesheets.stores.activeLayer.set(undefined);\r\n          }\r\n        }\r\n        // remove object\r\n        _store_copy = _store_copy.filter(instance => instance != CanvasLayerInstance);\r\n        return _store_copy;\r\n      });\r\n    },\r\n\r\n    // clone layer \r\n    cloneLayer(CanvasLayerInstance){\r\n      // TODO: make so the index position is right above the clones layer. currently\r\n      // it gets added to the top of the stack as the first array element, which is not ideal.\r\n      Spritesheets.stores.layers.update((_store) => {\r\n        let { width, height, label, data } = CanvasLayerInstance;\r\n        // we need to serialize the data else it will reference the same data\r\n        if(Array.isArray(data)){\r\n          data = JSON.parse(JSON.stringify(data));\r\n        }\r\n        label = label + ' copy';\r\n        const newLayer = new CanvasLayer({ width, height, label, data });\r\n        _store = [ newLayer, ..._store];\r\n        Spritesheets.makeLayerActive(newLayer);\r\n        return _store;  \r\n      });\r\n    },\r\n    \r\n    // clone active layer \r\n    cloneActiveLayer(){\r\n      const active = Spritesheets.stores.activeLayer.get();\r\n      if(active){\r\n        Spritesheets.cloneLayer(active);\r\n      }else{\r\n        Spritesheets.createLayer();\r\n      }\r\n    },\r\n    // make a layer active\r\n    makeLayerActive(CanvasLayerInstance){\r\n      if(!(CanvasLayerInstance instanceof CanvasLayer)){\r\n        throw new Error(`Invalid 'CanvasLayerInstance' while setting 'activeLayer'`);\r\n      }\r\n      Spritesheets.stores.activeLayer.set(CanvasLayerInstance);\r\n    },\r\n\r\n    // update label\r\n    updateLayerLabel(CanvasLayerInstance, label){\r\n      Spritesheets.stores.layers.update((_store) => {\r\n        CanvasLayerInstance.label = label;\r\n        return _store;\r\n      });\r\n    },\r\n\r\n    // import \r\n    import(serializedData){\r\n      const unserializedData = JSON.parse(serializedData);\r\n      if(unserializedData.version == Config.filetypes.spritesheets.save.version){\r\n        for(const spritesheet of unserializedData.data){\r\n          Spritesheets.createLayer({ ...spritesheet })\r\n        }\r\n      }\r\n    },\r\n\r\n    // export \r\n    export(serialize){\r\n      let data = { version: Config.filetypes.spritesheets.save.version, data: [ ...Spritesheets.stores.layers.get() ] };\r\n      if(serialize){\r\n        data = JSON.stringify(data);\r\n      }\r\n      return data;\r\n    },\r\n\r\n    // import chr\r\n    importCHR(filedata){\r\n      const result = chr.parse(filedata);\r\n      result.forEach(page => Spritesheets.createLayer({ data: page }));\r\n    },\r\n\r\n    // export chr\r\n    exportCHR(){\r\n      const activeLayer = Spritesheets.stores.activeLayer.get();\r\n      if(!activeLayer || !activeLayer.data){\r\n        throw new Error(`Unable to export CHR. No 'activeLayer'`);  \r\n      }\r\n      const bytearray = chr.generateExport(activeLayer.data);\r\n      return { label: activeLayer.label, data: bytearray };\r\n    },\r\n    \r\n    // export image\r\n    exportAsImage(callback, mimetype = 'image/png', quality = 1){\r\n      const activeLayer = Spritesheets.stores.activeLayer.get();\r\n      if(!(activeLayer instanceof CanvasLayer)){\r\n        throw new Error(`Unable to export Image. No 'activeLayer'`);\r\n      }\r\n      const fn = (blob) => {\r\n        callback.call(null, { blob, label: activeLayer.label, options: { mimetype, quality } });\r\n      };\r\n      return { label: activeLayer.label, image: activeLayer.element.toBlob(fn, mimetype, quality), options: { type: mimetype } };\r\n    }\r\n  }\r\n});\r\n\r\n// temp\r\nSpritesheets.createLayer();\r\n","import { EnumerableList, Enum } from 'enums-manager';\r\n\r\n// tools \r\nexport const ToolTypes = new EnumerableList(\r\n  'pointer', \r\n  'pen', \r\n  'paintbucket', \r\n  'eyedropper', \r\n  'colorswap', \r\n  'transform', \r\n  'marquee', \r\n  'zoom', \r\n  'preview', \r\n  'tileswap', \r\n  'preview_region',\r\n  'tilecolor'\r\n);\r\n\r\nexport const icons = {\r\n  stop: 'M14 14.655l-5.799.908 3.393 6.917-3.112 1.52-3.412-6.982-4.07 3.651v-15.857l13 9.843zm3-14.655c-3.313 0-6 2.687-6 6s2.687 6 6 6 6-2.687 6-6-2.686-6-6-6zm-4 6c0-.739.215-1.424.567-2.019l5.453 5.453c-.595.351-1.28.566-2.02.566-2.206 0-4-1.794-4-4zm7.434 2.02l-5.453-5.453c.595-.352 1.28-.567 2.019-.567 2.206 0 4 1.794 4 4 0 .74-.215 1.424-.566 2.02z',\r\n}\r\n\r\nexport class Cursor{\r\n  constructor(props){\r\n    this.icon = '';\r\n    this.offset = {x: 0, y: 0};\r\n    this.size = {width: 11, height: 11};\r\n    this.scale = {x: 1, y: 1};\r\n    Object.assign(this, props);\r\n  }\r\n}\r\n\r\nexport default class Tool{\r\n  constructor(props){\r\n    this.visible_in_toolbar = true;\r\n    this.pixelIndicator = false;\r\n    this.singleAction = false;\r\n  }\r\n  get optionsPanelComponent(){\r\n    return undefined;\r\n  }\r\n  onMount(){}\r\n  onDestroy(){}\r\n  primary(){}\r\n  secondary(){}\r\n  move(){}\r\n  mouseup(){}\r\n  reset(){}\r\n}","export default class Layer{\r\n  constructor(){\r\n    this.canvas = document.createElement('canvas');\r\n    this.canvas.width = 128;\r\n    this.canvas.height = 128;\r\n    this.context = this.canvas.getContext('2d');\r\n  }\r\n  render(){\r\n    console.log('Render not implemented');\r\n  }\r\n}","import { AnimationLoop } from '~/application/spritesheets/animationloop';\r\nimport { Spritesheets } from '~/stores/spritesheets.store.js';\r\nimport { Palettes } from '~/stores/palettes.store.js';\r\n\r\n// layers\r\nimport Grid from './layers/grid.layer.js';\r\nimport Cursor from './layers/cursor.layer.js';\r\n\r\nexport const Type = Object.freeze({ primary: 1, secondary: 2, move: 3, mouseup: 4 });\r\n\r\nconst overlayCanvas = () => {\r\n  const canvas = document.createElement('canvas');\r\n  canvas.width = 128;\r\n  canvas.height = 128;\r\n  const context = canvas.getContext('2d');\r\n  return { canvas, context };\r\n}\r\n\r\nexport const grid = new Grid();\r\nexport const cursor = new Cursor();\r\n\r\nconst overlays = [\r\n  grid,\r\n  cursor\r\n];\r\n\r\nexport default class SpritesheetEditor{\r\n  defineCanvas(canvas){\r\n    this.canvas = canvas;\r\n    this.context = this.canvas.getContext('2d');\r\n    this.canvas.addEventListener('mousedown', this.eventHandler.mousedown);\r\n  }\r\n\r\n  constructor({ canvas, context, width, height }){\r\n    this.activeLayer = undefined;\r\n    this.activePaletteLayer = undefined;\r\n    this.lastChanged = undefined;\r\n\r\n    this.canvas;\r\n    this.context;\r\n\r\n    this.width = width;\r\n    this.height = height;\r\n\r\n    const fps = 0;\r\n    this.animationLoop = AnimationLoop(this.render.bind(this), fps);\r\n    \r\n    this.events = {};\r\n    this.eventHandler = {};\r\n\r\n    const callActionType = (type, e) => {\r\n      e.mouseIsDown = mouseIsDown;\r\n      switch(type){\r\n        case Type.primary:\r\n          callEvent('primary', e);\r\n        break;\r\n        case Type.secondary:\r\n          callEvent('secondary', e);\r\n        break;\r\n        case Type.move:\r\n          callEvent('move', e); \r\n        break;\r\n        case Type.mouseup:\r\n          callEvent('mouseup', e); \r\n        break;\r\n        default:\r\n          console.log('hmm...')\r\n      }\r\n    }\r\n\r\n    // temp to see if mouse pos handles the transform css scale\r\n    function  getMousePos(canvas, evt) {\r\n      if(!canvas) return {x: 0, y: 0};\r\n      const rect = canvas.getBoundingClientRect(), // abs. size of element\r\n        scaleX = canvas.width / rect.width,    // relationship bitmap vs. element for X\r\n        scaleY = canvas.height / rect.height;  // relationship bitmap vs. element for Y\r\n    \r\n      return {\r\n        x: Math.floor((evt.clientX - rect.left) * scaleX),   // scale mouse coordinates after they have\r\n        y: Math.floor((evt.clientY - rect.top) * scaleY)     // been adjusted to be relative to element\r\n      }\r\n    }\r\n\r\n    const callEvent = (type, e) => {\r\n      if(this.events[type]){\r\n        e.realMousePosition = getMousePos(this.canvas, e); \r\n        this.events[type].call(null, e);\r\n      }\r\n    }\r\n    // handle event actions\r\n    let mouseIsDown = false;\r\n    this.eventHandler.mousemove = (e) => {\r\n      callActionType(Type.move, e);\r\n    }\r\n    this.eventHandler.mouseup = e => {\r\n      mouseIsDown = false;\r\n      callActionType(Type.mouseup, e);\r\n    };\r\n    this.eventHandler.mousedown = (e) => {\r\n      mouseIsDown = true;\r\n      let type;\r\n      if(e.which == 1){\r\n        type = Type.primary;\r\n      }else if(e.which == 3){\r\n        type = Type.secondary;\r\n      }else{\r\n        return;\r\n      }\r\n      callActionType(type, e);\r\n    }\r\n\r\n    // bind events\r\n    document.addEventListener('mousemove', this.eventHandler.mousemove);\r\n    document.addEventListener('mouseup', this.eventHandler.mouseup);\r\n  }\r\n  on(event, fn){\r\n    if(typeof event != 'string' && typeof fn !== 'function'){\r\n      throw new Error(`Invalid eventlistener`);\r\n    }\r\n    if(this.events[event]){\r\n      throw new Error(`Event already exists : ${event}`);\r\n    }\r\n    this.events[event] = fn;\r\n  }\r\n\r\n  // render\r\n  render({ cancel, delta, frame, time }){\r\n    if(!this.canvas) return;\r\n\r\n    this.context.clearRect(0,0, 128, 128);\r\n    const activeLayer = Spritesheets.stores.activeLayer.get();\r\n    const activePaletteLayer = Palettes.stores.activeLayer.get();\r\n    if(activeLayer && activePaletteLayer){\r\n      if(this.lastChanged != Palettes.lastChanged.get() || (this.activeLayer != activeLayer || this.activePaletteLayer != activePaletteLayer)){\r\n        // set the current active layers\r\n        this.activeLayer = activeLayer;\r\n        this.activePaletteLayer = activePaletteLayer;\r\n        // draw from source\r\n        activeLayer.drawFromSource(activePaletteLayer);\r\n        // store last change to palettes so we can force an update\r\n        this.lastChanged = Palettes.lastChanged.get();\r\n      }\r\n      // draw active layer on the canvas context\r\n      this.context.drawImage(activeLayer.element, 0,0);\r\n      // draw overlay layers\r\n      overlays.forEach((layer) => {\r\n        layer.render();\r\n        this.context.drawImage(layer.canvas, 0, 0);\r\n      });\r\n\r\n    }\r\n  }\r\n  // clean up\r\n  destroy(){\r\n    // stop animationframe\r\n    this.animationLoop.unsubscribe();\r\n    // clean up events\r\n    if(this.canvas){\r\n      this.canvas.removeEventListener('mousedown', this.eventHandler.mousedown);\r\n    }\r\n    document.removeEventListener('mousemove', this.eventHandler.mousemove);\r\n    document.removeEventListener('mouseup', this.eventHandler.mouseup);\r\n  }\r\n}","import Layer from './layer.js';\r\n\r\nexport default class Grid extends Layer{\r\n  constructor(...args){\r\n    super(...args);\r\n    this.width = 128;\r\n    this.height = 128; \r\n    this.size = 8; \r\n    this.o1 = .05; \r\n    this.o2 = .005;\r\n  }\r\n  render(){\r\n    this.context.clearRect(0,0,this.width, this.height);\r\n    this.context.globalAlpha = 1;\r\n    for(let ix = 0; ix <= (this.width/this.size); ix++){\r\n      for(let iy = 0; iy <= (this.height/this.size); iy++){\r\n          this.context.save();\r\n          this.context.translate(ix*this.size, iy*this.size);\r\n          if((ix+iy) % 2 == 0){\r\n            this.context.globalAlpha = this.o1;\r\n            this.context.fillStyle = 'white';\r\n          }else{\r\n            this.context.globalAlpha = this.o2;          \r\n            this.context.fillStyle = 'black';\r\n          }\r\n          this.context.fillRect(0, 0, this.size, this.size);\r\n          this.context.restore();\r\n        \r\n        // TODO: fix the gradient that occurs on each 8x8 tile.\r\n        // also at the top, the first 8 rows is gradient shifted.\r\n        // if(ix % this.size == 0){\r\n        //   this.context.save();\r\n        //   this.context.translate(ix, iy);\r\n        //     if(((ix + iy) / this.size) % 2 == 0){\r\n        //       this.context.fillStyle = 'white';\r\n        //       this.context.globalAlpha = this.o1;              \r\n        //     }else{\r\n        //       this.context.fillStyle = 'black';\r\n        //       // this.context.globalAlpha = this.o2;\r\n        //     }\r\n        //     this.context.fillRect(0,0,8,8);\r\n        //   this.context.restore();\r\n        // }\r\n      }\r\n    }\r\n  }\r\n}","import Layer from './layer.js';\r\n\r\nexport default class Cursor extends Layer{\r\n  constructor(...args){\r\n    super(...args);\r\n    this.width = 128;\r\n    this.height = 128; \r\n    this.size = 1;\r\n    this.x;\r\n    this.y;\r\n  }\r\n  render(){\r\n    if(!this.x || !this.y) return;\r\n    this.context.clearRect(0, 0, this.width, this.height);\r\n    this.context.globalAlpha = .4;\r\n    this.context.fillStyle = 'white';\r\n    this.context.fillRect(this.x, this.y, this.size, this.size);\r\n  }\r\n}","/*\r\n  requestanimationframe loop\r\n  \r\n  @param callback (Function)\r\n  @param fps (Number) (optional)\r\n  \r\n  @return cancel (Function)\r\n\r\n  Usage:\r\n  const stop = AnimationLoop((delta, framecount, stop, time) => {\r\n    console.log(delta, framecount);\r\n    if(framecount > 99){\r\n      stop();\r\n    }\r\n  }, 30);\r\n*/\r\nexport const AnimationLoop = (fn, fps = null) => {\r\n  if(typeof fn !== 'function'){\r\n    throw new Error(`Invalid callback function.`);\r\n  }\r\n  let paused = false;\r\n  let framecount = 0;\r\n  let animation;\r\n  let lastTime = performance.now();\r\n  const cancel = _ => cancelAnimationFrame(animation);\r\n  const pause = _ => paused = true;\r\n  const play = _ => paused = false;\r\n  const toggle = _ => paused = !paused;\r\n  const loop = (time) => {\r\n    animation = requestAnimationFrame(loop);\r\n    if(paused){\r\n      return;\r\n    }\r\n    const delta = time - lastTime;\r\n    const now = performance.now();\r\n    if(!fps || now - lastTime > 1000 / fps){\r\n      fn.call(null,{ delta: delta / 1000, frame: ++framecount, cancel, time, pause, play });\r\n      lastTime = time;\r\n    }\r\n  };\r\n  animation = requestAnimationFrame(loop);\r\n  return {\r\n    unsubscribe: cancel,\r\n    pause,\r\n    play,\r\n    toggle,\r\n  };\r\n};\r\n","import { writable } from '~/utils/store';\r\nimport { Enum } from 'enums-manager';\r\n\r\n// temp \r\nimport { ToolTypes } from './tools/tool.js';\r\nexport { ToolTypes };\r\n\r\n// tools\r\nimport Pointer from './tools/pointer.js';\r\nimport Pen from './tools/pen.js';\r\nimport Eyedropper from './tools/eyedropper.js';\r\nimport Paintbucket from './tools/paintbucket.js';\r\n// import Colorswap from './colorswap.js';\r\n// import Tileswap from './tileswap.js';\r\n// import Transform from './transform.js';\r\n// import Marquee from './tools/marquee.js';\r\n// import Zoom from './zoom.js';\r\n// import Preview from './tools/preview.js';\r\n// import PreviewRegion from './previewregion.js';\r\n// import Tilecolor from './tilecolor.js';\r\n\r\nconst mapped = {\r\n  pointer: new Pointer(),\r\n  pen: new Pen(),\r\n  eyedropper: new Eyedropper(),\r\n  paintbucket: new Paintbucket(),\r\n  // [colorswap]: new Colorswap(),\r\n  // [tileswap]: new Tileswap(),\r\n  // [transform]: new Transform(),\r\n  // marquee: new Marquee(),\r\n  // [zoom]: new Zoom(),\r\n  // preview: new Preview(),\r\n  // [preview_region]: new PreviewRegion(),\r\n  // [tilecolor]: new Tilecolor()\r\n};\r\n\r\nexport const Toolbar = {\r\n  tools: mapped, \r\n  activeTool: writable(undefined, ({ value, store, get }) => {\r\n    return {\r\n      setActive(_enum){\r\n        if(!(_enum instanceof Enum)){\r\n          throw new Error(`Invalid tool`);\r\n        }\r\n        const instance = mapped[_enum.key];\r\n        const { cursor } = instance;\r\n        // fallback cursor\r\n        let type = 'default';\r\n        // overwrite cursor if one is defined on the tool\r\n        if(cursor && cursor.icon){\r\n          type = `url(\"data:image/svg+xml,%3Csvg transform='' xmlns='http://www.w3.org/2000/svg' width='${cursor.size.width}' height='${cursor.size.height}' viewBox='0 0 100 100' xml:space='preserve'%3E %3Cpath fill='white' d='${cursor.icon}'/%3E %3C/svg%3E\") ${cursor.offset.x} ${cursor.offset.y}, auto`\r\n        }\r\n        // set new icon to css variable\r\n        document.documentElement.style.setProperty('--canvas-cursor', type);\r\n        store.set(instance);\r\n      }\r\n    }\r\n  })\r\n};\r\n\r\nToolbar.activeTool.setActive(ToolTypes.get('pen'));\r\n\r\n// tool actions\r\nconst execute = (t, ...args) => {\r\n  if(t){\r\n    t.call(Toolbar.activeTool.get(), ...args);\r\n  }\r\n}\r\n\r\nexport const primary = (...args) => execute(Toolbar.activeTool.get()?.primary, ...args);\r\nexport const secondary = (...args) => execute(Toolbar.activeTool.get()?.secondary, ...args);\r\nexport const move = (...args) => execute(Toolbar.activeTool.get()?.move, ...args);\r\nexport const mouseup = (...args) => execute(Toolbar.activeTool.get()?.mouseup, ...args);","import Tool, { ToolTypes, Cursor } from './tool.js';\r\n\r\nexport default class Pointer extends Tool{\r\n  constructor(){\r\n    super();\r\n    this.name = 'pointer';\r\n    this.enum = ToolTypes.get('pointer');\r\n    this.weight = 100;\r\n    this.icon = 'M4 0l16 12.279-6.78 1.138 4.256 8.676-3.902 1.907-4.281-8.758-5.293 4.581z';\r\n    this.cursor = new Cursor({});\r\n  }\r\n  primary({x, y, context}){}\r\n  secondary({x, y, context}){}\r\n  move({x, y, context}){}\r\n}","import Tool, { ToolTypes, Cursor } from './tool.js';\r\n\r\nimport { Palettes } from '~/stores/palettes.store.js';\r\nimport { Spritesheets } from '~/stores/spritesheets.store.js';\r\n\r\nimport { cursor } from '~/modules/spritesheet_editor/SpritesheetEditor.js';\r\n\r\n// sub options\r\n// import PenOptions from '~/ui/sections/graphics/spritesheets/tooloptions/Pen.svelte';\r\n\r\nexport default class Pen extends Tool{\r\n  constructor(){\r\n    super();\r\n    this.pixelIndicator = true;\r\n    this.name = 'pen';\r\n    this.enum = ToolTypes.get('pen');\r\n    this.weight = 90;\r\n    this.icon = 'M19.769 9.923l-12.642 12.639-7.127 1.438 1.438-7.128 12.641-12.64 5.69 5.691zm1.414-1.414l2.817-2.82-5.691-5.689-2.816 2.817 5.69 5.692z';\r\n    this.cursor = new Cursor({\r\n      icon: 'M19.769 9.923l-12.642 12.639-7.127 1.438 1.438-7.128 12.641-12.64 5.69 5.691zm1.414-1.414l2.817-2.82-5.691-5.689-2.816 2.817 5.69 5.692z',\r\n      size: {\r\n        width: 46,\r\n        height: 46,\r\n      },\r\n      offset: {\r\n        x: 0, \r\n        y: 11\r\n      }\r\n    });\r\n\r\n    this.properties = {\r\n      size: 1,\r\n      drawStack: [],\r\n      lastDraw: undefined,\r\n      start: undefined,\r\n    }\r\n    // store modified pixels\r\n    this.modifiedPixels = [];\r\n  }\r\n  \r\n  // return suboptions\r\n  get optionsPanelComponent(){\r\n    return PenOptions;\r\n  }\r\n\r\n  paint(e){\r\n    const colorData = Palettes.stores.selectedColor.getActiveColorValue(e.colorIndex);\r\n    const { rgb, hex } = colorData; \r\n    if(!colorData){\r\n      return;\r\n    }\r\n    const context = Spritesheets.stores.activeLayer.get()?.context;\r\n    if(!context){\r\n      console.log('Error loading context');\r\n      return;\r\n    }\r\n    // loop over the stack\r\n    this.properties.drawStack.map(item => {\r\n      const { x, y } = item.realMousePosition;\r\n      context.save();\r\n        context.translate(x, y);\r\n        context.fillStyle = `rgb(${rgb.join(',')})`;\r\n        context.fillRect(0, 0, this.properties.size, this.properties.size);\r\n        // store the modified pixels\r\n        // NOTE: this will not work with anything other than 1 px size pen\r\n        this.modifiedPixels.push({ x, y, colorIndex: Number.isInteger(e.colorIndex) ? e.colorIndex : Palettes.stores.selectedColor.get() });\r\n      context.restore();\r\n    });\r\n    this.properties.lastDraw = this.properties.drawStack.pop();\r\n    this.properties.drawStack = [];\r\n  }\r\n\r\n  primary(props){\r\n    if(props.shiftKey){\r\n      this.drawLineFromPoint(props, { ...props.realMousePosition });\r\n    }else{\r\n      this.properties.drawStack.push(props);\r\n    }\r\n    this.paint.call(this, props);\r\n  }\r\n\r\n  secondary(props){\r\n    props = { ...props, colorIndex: 0};\r\n    // if(props.shiftKey){\r\n    //   this.drawLineFromPoint(props, { ...props.realMousePosition });\r\n    // }else{\r\n    //   this.properties.drawStack.push(props);\r\n    // }\r\n    this.properties.drawStack.push(props);\r\n    this.paint.call(this, props);\r\n  }\r\n\r\n  drawLineFromPoint(props, end){\r\n    if(!this.properties.start){\r\n      return;\r\n    }\r\n\r\n    let { x, y } = this.properties.start;\r\n    if(Math.abs(end.x - x) > Math.abs(end.y - y)){\r\n      while(x != end.x){\r\n        if(x < end.x) x++;\r\n        if(x > end.x) x--;\r\n        this.properties.drawStack.push({ ...props, realMousePosition: { x, y } });\r\n      }\r\n    }else{\r\n      while(y != end.y){\r\n        if(y < end.y) y++;\r\n        if(y > end.y) y--;\r\n        this.properties.drawStack.push({ ...props, realMousePosition: { x, y } });\r\n      }\r\n    }\r\n\r\n  }\r\n  move(props){\r\n    // update cursor position\r\n    cursor.x = props.realMousePosition.x;\r\n    cursor.y = props.realMousePosition.y;\r\n\r\n    if(props.shiftKey || !props.mouseIsDown) return;\r\n\r\n    const fillStack = (props) => {\r\n      if(this.properties.lastDraw){\r\n        let { x, y } = { ...this.properties.lastDraw.realMousePosition };\r\n        while(x != props.realMousePosition.x || y != props.realMousePosition.y){\r\n          if(x < props.realMousePosition.x) x++;\r\n          if(x > props.realMousePosition.x) x--;\r\n          if(y < props.realMousePosition.y) y++;\r\n          if(y > props.realMousePosition.y) y--;\r\n          this.properties.drawStack.push({...props, realMousePosition: { x, y } });\r\n        }\r\n      }else{\r\n        this.properties.drawStack.push(props);\r\n      }\r\n    }\r\n    \r\n    if(props.which == 1){\r\n      // call the primary action\r\n      fillStack(props);\r\n      this.primary.call(this, props);\r\n    }else if(props.which == 3){\r\n      fillStack(props);\r\n      this.secondary.call(this, props);\r\n    }\r\n    \r\n  }\r\n  mouseup(){\r\n    const dataRef = Spritesheets.stores.activeLayer.get()?.data;\r\n    if(!dataRef){\r\n      return;\r\n    }\r\n    for(const pixel of this.modifiedPixels){\r\n      let {x, y, colorIndex } = pixel;\r\n      const rc = {x: Math.floor(x / 8), y: Math.floor(y / 8)};\r\n      const tile = {x: x % 8, y: y % 8};\r\n      // wtf is this??? well whatever.. \r\n      if(dataRef[rc.y] && dataRef[rc.y][rc.x] && dataRef[rc.y][rc.x][tile.y] && Number.isInteger(dataRef[rc.y][rc.x][tile.y][tile.x])){\r\n        dataRef[rc.y][rc.x][tile.y][tile.x] = colorIndex;\r\n      }\r\n    };\r\n\r\n    // same last pixel which will be the start for the next draw. if drawing line for instance\r\n    const lastPixel = this.modifiedPixels[this.modifiedPixels.length-1];\r\n    if(lastPixel){\r\n      this.properties.start = { ...lastPixel };\r\n    }\r\n    this.modifiedPixels = [];\r\n  }\r\n}\r\n","import Tool, { ToolTypes, Cursor } from './tool.js';\r\n\r\nimport { cursor } from '~/modules/spritesheet_editor/SpritesheetEditor.js';\r\n\r\nimport { Spritesheets } from '~/stores/spritesheets.store.js';\r\nimport { Palettes } from '~/stores/palettes.store.js';\r\n\r\nexport default class Eyedropper extends Tool{\r\n  constructor(){\r\n    super();\r\n    this.singleAction = true;\r\n    this.name = 'eyedropper';\r\n    this.enum = ToolTypes.get('eyedropper');\r\n    this.weight = 70;\r\n    this.icon = 'M12.142 13.178l1.506 1.318-6.83 7.6c-1.31 1.464-2.22.315-3.953 1.647-.232.178-.483.257-.724.257-.601 0-1.141-.49-1.141-1.151 0-.218.062-.455.196-.698.978-1.791-.129-2.629 1.148-4.052l6.787-7.555 1.505 1.317-3.727 4.139h2.691l2.542-2.822zm5.764-13.178c-2.434 0-4.871 1.707-4.797 5.831.021 1.167-.356 1.698-.884 1.698-.298 0-.597-.169-.877-.386-.407-.315-.99-.26-1.331.129-.374.426-.329 1.076.096 1.448l5.253 4.598c.423.371 1.067.328 1.438-.096.343-.392.32-.979-.049-1.345-.277-.275-.501-.581-.501-.913 0-.479.486-.876 1.572-1.002 3.69-.428 5.174-2.656 5.174-4.88 0-2.799-2.149-5.082-5.094-5.082z';\r\n    this.cursor = new Cursor({\r\n      icon: 'M12.142 13.178l1.506 1.318-6.83 7.6c-1.31 1.464-2.22.315-3.953 1.647-.232.178-.483.257-.724.257-.601 0-1.141-.49-1.141-1.151 0-.218.062-.455.196-.698.978-1.791-.129-2.629 1.148-4.052l6.787-7.555 1.505 1.317-3.727 4.139h2.691l2.542-2.822zm5.764-13.178c-2.434 0-4.871 1.707-4.797 5.831.021 1.167-.356 1.698-.884 1.698-.298 0-.597-.169-.877-.386-.407-.315-.99-.26-1.331.129-.374.426-.329 1.076.096 1.448l5.253 4.598c.423.371 1.067.328 1.438-.096.343-.392.32-.979-.049-1.345-.277-.275-.501-.581-.501-.913 0-.479.486-.876 1.572-1.002 3.69-.428 5.174-2.656 5.174-4.88 0-2.799-2.149-5.082-5.094-5.082z',\r\n      size: {\r\n        width: 46,\r\n        height: 46,\r\n      },\r\n      offset: {\r\n        x: 0, \r\n        y: 10\r\n      }  \r\n    });\r\n  }\r\n  primary(props){\r\n    const { x, y } = props.realMousePosition;\r\n    // set active color index\r\n    const colorIndex = Spritesheets.stores.activeLayer.get().colorIndexAtPosition(x, y);\r\n    if(Number.isInteger(colorIndex)){\r\n      Palettes.stores.selectedColor.set(colorIndex);\r\n    }\r\n  }\r\n  secondary(props){}\r\n  move(props){\r\n    // update cursor position\r\n    cursor.x = props.realMousePosition.x;\r\n    cursor.y = props.realMousePosition.y;\r\n    \r\n  }\r\n}","import Tool, { ToolTypes, Cursor } from './tool.js';\r\n\r\nimport { cursor } from '~/modules/spritesheet_editor/SpritesheetEditor.js';\r\n\r\nimport { Spritesheets } from '~/stores/spritesheets.store.js';\r\nimport { Palettes } from '~/stores/palettes.store.js';\r\n\r\nexport default class Paintbucket extends Tool{\r\n  constructor(){\r\n    super();\r\n    this.pixelIndicator = true;\r\n    this.singleAction = true;\r\n    this.name = 'paintbucket';\r\n    this.enum = ToolTypes.get('paintbucket');\r\n    this.weight = 80;\r\n    this.icon = 'M24 19.007c0-3.167-1.409-6.771-2.835-9.301l-.006-.01-.014-.026c-.732-1.392-1.914-3.052-3.619-4.757-2.976-2.976-5.476-3.912-6.785-3.913-.413 0-.708.094-.859.245l-.654.654c-1.898-.236-3.42.105-4.294.982-.876.875-1.164 2.159-.792 3.524.242.893.807 1.891 1.752 2.836.867.867 2.062 1.684 3.615 2.327.488-.839 1.654-1.019 2.359-.315.586.586.584 1.533-.002 2.119s-1.533.589-2.121 0c-.229-.229-.366-.515-.416-.812-1.646-.657-3.066-1.534-4.144-2.612-.728-.728-1.289-1.528-1.664-2.349l-2.835 2.832c-.445.447-.685 1.064-.686 1.82.001 1.635 1.122 3.915 3.714 6.506 2.764 2.764 5.58 4.243 7.431 4.243.649 0 1.181-.195 1.548-.562l8.086-8.079c.911.875-.777 3.541-.777 4.65 0 1.104.896 1.999 2 1.998 1.104 0 1.998-.895 1.998-2zm-18.912-12.974c-.236-.978-.05-1.845.554-2.444.526-.53 1.471-.791 2.656-.761l-3.21 3.205zm9.138 2.341l-.03-.029c-1.29-1.291-3.802-4.354-3.095-5.062.715-.715 3.488 1.521 5.062 3.095.862.863 2.088 2.248 2.938 3.459-1.718-1.073-3.493-1.469-4.875-1.463zm-3.875 12.348c-.547-.082-1.5-.547-1.9-.928l7.086-7.086c.351.37 1.264.931 1.753 1.075l-6.939 6.939z';\r\n    this.cursor = new Cursor({\r\n      icon: 'M24 19.007c0-3.167-1.409-6.771-2.835-9.301l-.006-.01-.014-.026c-.732-1.392-1.914-3.052-3.619-4.757-2.976-2.976-5.476-3.912-6.785-3.913-.413 0-.708.094-.859.245l-.654.654c-1.898-.236-3.42.105-4.294.982-.876.875-1.164 2.159-.792 3.524.242.893.807 1.891 1.752 2.836.867.867 2.062 1.684 3.615 2.327.488-.839 1.654-1.019 2.359-.315.586.586.584 1.533-.002 2.119s-1.533.589-2.121 0c-.229-.229-.366-.515-.416-.812-1.646-.657-3.066-1.534-4.144-2.612-.728-.728-1.289-1.528-1.664-2.349l-2.835 2.832c-.445.447-.685 1.064-.686 1.82.001 1.635 1.122 3.915 3.714 6.506 2.764 2.764 5.58 4.243 7.431 4.243.649 0 1.181-.195 1.548-.562l8.086-8.079c.911.875-.777 3.541-.777 4.65 0 1.104.896 1.999 2 1.998 1.104 0 1.998-.895 1.998-2zm-18.912-12.974c-.236-.978-.05-1.845.554-2.444.526-.53 1.471-.791 2.656-.761l-3.21 3.205zm9.138 2.341l-.03-.029c-1.29-1.291-3.802-4.354-3.095-5.062.715-.715 3.488 1.521 5.062 3.095.862.863 2.088 2.248 2.938 3.459-1.718-1.073-3.493-1.469-4.875-1.463zm-3.875 12.348c-.547-.082-1.5-.547-1.9-.928l7.086-7.086c.351.37 1.264.931 1.753 1.075l-6.939 6.939z',\r\n      offset: {\r\n        x: 3.5, \r\n        y: 11\r\n      },\r\n      size: {\r\n        width: 46,\r\n        height: 46,\r\n      },\r\n    });\r\n\r\n    // properties \r\n    this.properties = {\r\n      diagonals: false,\r\n    }\r\n  }\r\n  fillAllPixelsOfSameColor(x, y){\r\n    throw new Error('Not implemented: fills all pixels')\r\n  }\r\n  fill(x, y){\r\n    // fill value \r\n    const fillValue = Palettes.stores.selectedColor.get();\r\n    // starting color\r\n    const pixelValue = Spritesheets.stores.activeLayer.get().colorIndexAtPosition(x, y); \r\n    // store pixels in an array\r\n    const pixels = [{ x, y }];\r\n   \r\n    while(pixels.length > 0){\r\n      const { x: _x, y: _y} = pixels.shift();\r\n      if(_y < 0 || _y > 127){\r\n        continue;\r\n      }\r\n      if(_x < 0 || _x > 127){\r\n        continue;\r\n      }\r\n      const colorIndex = Spritesheets.stores.activeLayer.get().colorIndexAtPosition(_x, _y);\r\n      // make sure it's the same colorIndex\r\n      if(colorIndex == fillValue){\r\n        continue;\r\n      }\r\n      if(colorIndex != pixelValue){\r\n        continue;\r\n      }\r\n      \r\n      // upate color index\r\n      Spritesheets.stores.activeLayer.get().setColorIndexAtPosition(_x, _y, fillValue);\r\n\r\n      // check top, down, left, right directions\r\n      pixels.push({ x: _x, y: _y + 1 });\r\n      pixels.push({ x: _x, y: _y - 1 });\r\n      pixels.push({ x: _x - 1, y: _y });\r\n      pixels.push({ x: _x + 1, y: _y });\r\n\r\n      // if we also want diagonals\r\n      // TODO: implement this in the sub toolbar as options where the user\r\n      // am able to toggle this preference\r\n      if(this.properties.diagonals){\r\n        pixels.push({ x: _x + 1, y: _y + 1 });\r\n        pixels.push({ x: _x - 1, y: _y - 1 });\r\n        pixels.push({ x: _x + 1, y: _y - 1 });\r\n        pixels.push({ x: _x - 1, y: _y + 1 });\r\n      }\r\n    }\r\n\r\n    // force a spritesheet update\r\n    Spritesheets.stores.activeLayer.get().drawFromSource(Palettes.stores.activeLayer.get());\r\n  }\r\n\r\n  primary(props){\r\n    const { x, y } = props.realMousePosition;\r\n    if(!props.ctrlKey){\r\n      this.fill(x, y);\r\n    }else{\r\n      this.fillAllPixelsOfSameColor(x, y);\r\n    }\r\n  }\r\n\r\n  secondary(props){}\r\n\r\n  move(props){\r\n    // update cursor position\r\n    cursor.x = props.realMousePosition.x;\r\n    cursor.y = props.realMousePosition.y;\r\n  }\r\n}","import { get } from 'svelte/store';\nimport ActionsManager from '~/application/ActionsManager.js';\n\nimport { fileDialog, saveDialog, filename } from '~/utils/file.js';\n\n// stores\nimport { palettesStore } from '~/application/palettes/palettes';\n\nimport { Spritesheets } from '~/stores/spritesheets.store.js';\nimport { Palettes } from '~/stores/palettes.store.js';\n\n// sub stores\nconst { selectedColor } = Palettes.stores;\n\nimport Config from '~/nesbit.config';\nimport { Toolbar } from '~/modules/spritesheet_editor/tools';\n\n\n// electron only actions \nif(globalThis.electron){\n  ActionsManager.register('window_close', _ => globalThis.electron.quit());\n  ActionsManager.register('window_minimize', _ => globalThis.electron.minimize());\n  ActionsManager.register('window_maximize', _ => globalThis.electron.maximize());\n  ActionsManager.register('window_toggle_fullscreen', _ => globalThis.electron.toggleFullscreen());\n  // external links\n  ActionsManager.register('external_link', href => globalThis.electron.externalLink(href));\n\n  // palettes\n  ActionsManager.register('palette_export', async _ => {\n    const data = palettesStore.export(true);\n    const { canceled, filePath } = await globalThis.electron.openSaveDialog([Config.filetypes.palettes.save.extension]);\n    if(!canceled && typeof filePath == 'string'){\n      await globalThis.electron.saveAs(filePath, data);\n    }\n  });\n\n  // import from file\n  ActionsManager.register('palette_import', async _ => {\n    const { canceled, filePaths } = await globalThis.electron.openFileDialog([Config.filetypes.palettes.save.extension]);\n    if(!canceled && Array.isArray(filePaths)){\n      for(const path of filePaths){\n        const { filePath, data } = await globalThis.electron.readFileDataFromPath(path, 'utf8');\n        palettesStore.import(data);\n      }\n    }\n  });\n}\n\n// webapp only actions\nif(!globalThis.electron){\n  ActionsManager.register('window_close', _ => _);\n  ActionsManager.register('window_minimize', _ => _);\n  ActionsManager.register('window_maximize', _ => ActionsManager.execute('window_toggle_fullscreen'));\n  \n  ActionsManager.register('window_toggle_fullscreen', () => {\n    if(!document.fullscreenElement){\n      document.documentElement.requestFullscreen();\n    }else{\n      document.exitFullscreen();\n    }\n  });\n\n  // palettes\n  // import file programmatically in the webversion\n  ActionsManager.register('palette_import', (e) => {\n    fileDialog([Config.filetypes.palettes.save.extension], (data) => {\n      Palettes.import(data);\n    });\n  });\n  // export\n  ActionsManager.register('palette_export', (e) => {\n    saveDialog(filename('palette', Config.filetypes.palettes.save.extension), Palettes.export(true));\n  });\n\n\n  // spritesheets\n  ActionsManager.register('spritesheet_import', (e) => {\n    fileDialog([Config.filetypes.spritesheets.save.extension], (data) => {\n      Spritesheets.import(data);\n    });\n  });\n\n  ActionsManager.register('spritesheet_export', (e) => {\n    saveDialog(filename('spritesheet', Config.filetypes.spritesheets.save.extension), Spritesheets.export(true));\n  });\n\n  ActionsManager.register('spritesheet_import_chr', (e) => {\n    fileDialog(['chr'], (data) => {\n      Spritesheets.importCHR(data);\n    }, { readAs: 'arraybuffer' });\n  });\n\n  ActionsManager.register('spritesheet_export_chr', (e) => {  \n    const { label, data } = Spritesheets.exportCHR();\n    saveDialog(filename(label, 'chr'), data);\n  });\n\n  ActionsManager.register('spritesheet_export_png', (e) => {  \n    Spritesheets.exportAsImage(({ blob, label, options }) => {\n      saveDialog(filename(label, 'png'), blob, { mimetype: blob.type });\n    });\n  });\n\n}\n\n/*\n\n  actions for both applications\n\n*/\n// noop\nActionsManager.register('noop', _ => _);\n// themes\nActionsManager.register('toggle_theme', _ => document.documentElement.dataset.theme = document.documentElement.dataset.theme == 'dark' ? 'light' : 'dark');\nActionsManager.register('light_theme', _ => document.documentElement.dataset.theme = 'light');\nActionsManager.register('dark_theme', _ => document.documentElement.dataset.theme = 'dark');\n\n// palettes\nActionsManager.register('palette_clear', _ => Palettes.stores.layers.clear());\nActionsManager.register('palette_create', _ => Palettes.createLayer());\nActionsManager.register('palette_remove', source => Palettes.removeLayer(source));\nActionsManager.register('palette_clone_layer', source => Palettes.cloneLayer(source));\nActionsManager.register('palette_clone_active_layer', _ => Palettes.cloneActiveLayer());\nActionsManager.register('palette_make_layer_active', source => Palettes.makeLayerActive(source));\nActionsManager.register('palette_swap_layers', ({ to, from }) => Palettes.stores.layers.swapLayers(to, from));\nActionsManager.register('palette_update_layer_label', ({ source, label }) => Palettes.updateLayerLabel(source, label));\nActionsManager.register('palette_active_color', n => selectedColor.setActiveColorIndex(n));\n\n// spritesheets\nActionsManager.register('spritesheet_create', _ => Spritesheets.createLayer());\nActionsManager.register('spritesheet_remove', index => Spritesheets.removeLayer(index));\nActionsManager.register('spritesheet_clone_layer', source => Spritesheets.cloneLayer(source));\nActionsManager.register('spritesheet_clone_active_layer', _ => Spritesheets.cloneActiveLayer());\nActionsManager.register('spritesheet_make_layer_active', source => Spritesheets.makeLayerActive(source));\nActionsManager.register('spritesheet_swap_layers', ({ to, from }) => Spritesheets.swapLayers(to, from));\nActionsManager.register('spritesheet_update_layer_label', ({ source, label }) => Spritesheets.updateLayerLabel(source, label));\nActionsManager.register('spritesheet_zoom', level => view.zoom(level));\nActionsManager.register('spritesheet_zoom_in', _ => view.zoom(get(spritesheetsStore).zoom+1));\nActionsManager.register('spritesheet_zoom_out', _ => view.zoom(get(spritesheetsStore).zoom-1));\nActionsManager.register('spritesheet_zoom_reset', _ => view.zoom());\nActionsManager.register('spritesheet_set_active_tool', _enum => Toolbar.activeTool.setActive(_enum));","const prepare = (base, route) => {\r\n  // prefix the base to always start with a '/' and remove trailing slash\r\n  base = '/'+base.replace(/^[\\/]+|[\\/]+$/g, '');\r\n  // strip multiple occurences of '/'\r\n  route = (`${base}/${route}`).replace(/[\\/]+/g, '/');\r\n  // remove leading and trailing slashes\r\n  route = route.replace(/^[\\/]+|[\\/]+$/g, '');\r\n  // get if it's explicit or not. could be a factor when determining route based on it's size/weight \r\n  // in terms of what has presedent when two routes would've matched the same url\r\n  const explicit = /\\*$/.test(route);\r\n  // if it's implicit or explicit\r\n  const lazy = explicit ? (route = route.replace(/[\\*]+$/g, ''), ''): '/?$';\r\n  // store parameters\r\n  const parameters = [];\r\n  let index = 0;\r\n  let regexpRoute = route.replace(/(:)?([^\\\\/]+)/g, (parameter, colonParameter, identifier) => {\r\n    const [ param, boundValue ] = identifier.split('->');\r\n    if(colonParameter){\r\n      // check for duplicates\r\n      const duplicates = parameters.filter(old => old.identifier == boundValue); \r\n      if(duplicates.length > 0){\r\n        throw new Error(`Duplicated parameter. [${duplicates.map(_=>_.identifier)}]`);\r\n      }\r\n      // store parameter reference\r\n      parameters.push({\r\n        index: index++,\r\n        parameter,\r\n        identifier: param,\r\n      });\r\n      // bound parameter\r\n      return boundValue ? `(${boundValue})` : `([^\\/]+)`;\r\n    }\r\n    return `${parameter}`;\r\n  });\r\n  regexpRoute = `^/${regexpRoute}${lazy}`;\r\n  return {\r\n    base,\r\n    route,\r\n    regexpRoute,\r\n    parameters,\r\n  }\r\n}\r\n\r\nexport default class Route{\r\n  constructor(base, route, fn, middlewares = []){\r\n    Object.assign(this, prepare(base, route));\r\n    this.callback = fn;\r\n    this.middlewares = middlewares;\r\n  }\r\n}","export class Middleware{\r\n  constructor(...props){\r\n    this.props = props;\r\n  }\r\n  use(fn){\r\n    if(typeof fn != 'function'){\r\n      throw new Error(`Invalid Middleware use argument. Expecting 'function' got : '${typeof fn}'`); \r\n    }\r\n    const f = (stack) => next => stack(fn.bind(this, ...this.props, next));\r\n    this.execute = f(this.execute);\r\n    return this;\r\n  }\r\n  execute(fn){\r\n    return fn.call(null);\r\n  }\r\n}\r\n\r\nexport class Request{\r\n  constructor(props){\r\n    Object.assign(this, {\r\n      base: '',\r\n      path: '',\r\n      route: '',\r\n      query: {},\r\n      params: {},\r\n      state: {}\r\n    }, props);\r\n  }\r\n}\r\n\r\nexport class Response{\r\n  constructor(callbacks){\r\n    Object.assign(this, callbacks);\r\n  }\r\n}\r\n","import StandaloneRouter from 'standalone-router';\r\nexport class SvelteStandaloneRouterError extends Error{}\r\nexport default class SvelteRouter extends StandaloneRouter{}\r\n\r\n// setting a singleton class with properties for 'global' access\r\nexport let Router = new class RouterProperties{\r\n  constructor(){\r\n    this.__linkBase = '';\r\n    this.__scrollReset = true;\r\n    this.__scrollOffset = 0;\r\n  }\r\n  setLinkBase(value){\r\n    if(typeof value != 'string'){\r\n      throw new SvelteStandaloneRouterError(`Invalid 'linkBase'. Expecting value of type 'string'`);\r\n    }\r\n    return this.__linkBase = value.endsWith('/') ? value : value + '/';\r\n  }\r\n  set linkBase(value){\r\n    return this.setLinkBase(value);\r\n  }\r\n  get linkBase(){\r\n    return this.__linkBase;\r\n  }\r\n  \r\n  // handle scroll reset\r\n  setScrollReset(value){\r\n    if(typeof value != 'boolean'){\r\n      throw new SvelteStandaloneRouterError(`Invalid 'scrollReset'. Expecting value of type 'boolean'`);\r\n    }\r\n    return this.__scrollReset = value;\r\n  }\r\n  set scrollReset(value){\r\n    return this.setScrollReset(value);\r\n  }\r\n  get scrollReset(){\r\n    return this.__scrollReset;\r\n  }\r\n\r\n  // handle scroll reset\r\n  setScrollOffset(value){\r\n    if(typeof value != 'number'){\r\n      throw new SvelteStandaloneRouterError(`Invalid 'scrollOffset'. Expecting value of type 'number'`);\r\n    }\r\n    return this.__scrollOffset = value;\r\n  }\r\n  set scrollOffset(value){\r\n    return this.setScrollOffset(value);\r\n  }\r\n  get scrollOffset(){\r\n    return this.__scrollOffset;\r\n  }\r\n} ","import Route from './route.js';\r\nimport { Middleware, Request, Response } from './utils.js';\r\n\r\n// router\r\nclass Router{\r\n  constructor(props){\r\n    // store properties and freeze them so not to be able to get modified\r\n    Object.freeze(this.__properties = {\r\n      initial: undefined,\r\n      base: '',\r\n      state: {},\r\n      ...props\r\n    });\r\n    // are we subscribing?\r\n    this.__subscribing = false;\r\n    // store\r\n    this.__get = new Map();\r\n    this.__catch = new Map();\r\n    this.__use = new Set();\r\n  }\r\n  _register(routes, fn, middlewares, list){\r\n    routes.map(route => {\r\n      const r = new Route(this.__properties.base, route, fn, middlewares);\r\n      if(list.has(r.regexpRoute)){\r\n        throw new Error(`Route with same endpoint already exist. [${route}, /${list.get(r.regexpRoute).route}](${r.regexpRoute})`);\r\n      }\r\n      list.set(r.regexpRoute, r);\r\n    });\r\n    return routes;\r\n  }\r\n  _props(...args){\r\n    let routes, fn, middlewares = [];\r\n    if(args.length == 1){\r\n      [ fn ] = args;\r\n      routes = '*';\r\n    }else if(args.length == 2){\r\n      [ routes, fn ] = args;\r\n    }else if(args.length > 2){\r\n      routes = args.shift();\r\n      fn = args.pop();\r\n      middlewares = args;      \r\n    }else{\r\n      throw new Error(`Invalid number prop arguments.`);\r\n    }\r\n    routes = Array.isArray(routes) ? routes : [routes];\r\n    return { routes, fn, middlewares };\r\n  }\r\n  _storeInList(fnName, list, ...args){\r\n    const { routes, fn, middlewares } = this._props(...args);\r\n    const parentRoutes = this._register(routes, fn, middlewares, list);\r\n    // enable chaining to group sub routes to a main route\r\n    // not needed since the routes are store as unique strings in the end \r\n    // but might be a nicer way to organize the implementation\r\n    const ret = {\r\n      [fnName]: (...innerArgs) => {\r\n        const { routes: innerRoutes, fn: innerFn, middlewares: innerMiddlewares } = this._props(...innerArgs);\r\n        parentRoutes.map(route => innerRoutes.map(_ => route + _).map(_ => this[fnName](_, ...[...innerMiddlewares, innerFn])));\r\n        return ret;\r\n      }\r\n    }\r\n    return ret;\r\n  }\r\n  get(...args){\r\n    return this._storeInList('get', this.__get, ...args);\r\n  }\r\n  use(...args){\r\n    const { routes, fn } = this._props(args);\r\n    routes.map(url => this.__use.add(new Route(this.__properties.base, url, ...fn)));\r\n  }\r\n  catch(...args){\r\n    return this._storeInList('catch', this.__catch, ...args);\r\n  }\r\n  _findRoute(url, list, data){\r\n    for(let [ regexpRoute, RouteInstance ] of list){\r\n      const parameters = url.match(new RegExp(regexpRoute, 'i'));\r\n      if(parameters){\r\n        const uri = parameters.shift();\r\n        // update Route with new parameters\r\n        let params = {};\r\n        if(parameters.length > 0){\r\n          // create a parameters object\r\n          params = RouteInstance.parameters.reduce((obj, value, index) => {\r\n            obj[value.identifier] = parameters[index];\r\n            return obj;\r\n          }, params);\r\n        }\r\n        // query parameters\r\n        const urlParams = new URLSearchParams(window.location.search);\r\n        const queryParameters = {};\r\n        for(const [key, value] of urlParams.entries()){ \r\n          if(queryParameters[key]){\r\n            if(Array.isArray(queryParameters[key])){\r\n              queryParameters[key].push(value);\r\n            }else{\r\n              queryParameters[key] = [queryParameters[key], value];\r\n            }\r\n          }else{\r\n            queryParameters[key] = value;\r\n          }\r\n        }\r\n        // update request object\r\n        const returnObject = { \r\n          RouteInstance,\r\n          Request: new Request({\r\n            path: url,\r\n            route: '/' + RouteInstance.route,\r\n            base: RouteInstance.base,\r\n            query: queryParameters,\r\n            params: params,\r\n            state: { ...data },\r\n          })\r\n        };\r\n        return returnObject;\r\n      }\r\n    }\r\n  }\r\n  execute(url, data = {}){\r\n    if(typeof url != 'string'){\r\n      throw new Error(`Invalid 'execute' argument. Expecting 'string'`);\r\n    }\r\n    if(!this.__subscribing){\r\n      return;\r\n    }\r\n    const response = new Response({\r\n      send: (...props) => this.__router_callback.call(null, ...props),\r\n      error: (props) => {\r\n        const errorsFound = this._findRoute(url, this.__catch, data);\r\n        if(!errorsFound){\r\n          console.warn(`No route or catch fallbacks found for [${url}]`);\r\n          return;\r\n        }\r\n        errorsFound.RouteInstance.callback.call(null, errorsFound.Request, response, props);\r\n      }\r\n    });\r\n    let matchFound = this._findRoute(url, this.__get, data);\r\n    if(!matchFound){\r\n      response.error();\r\n      return;\r\n    }\r\n    let middlewares = [];\r\n    const middleware = new Middleware(matchFound.Request, response);\r\n    this.__use.forEach(middlewareRoute => {\r\n      const RouteInstance = url.match(new RegExp(middlewareRoute.regexpRoute, 'i'));\r\n      if(RouteInstance){\r\n        middlewares.push(middlewareRoute.callback);\r\n      }\r\n    });\r\n    middlewares = [...middlewares, ...matchFound.RouteInstance.middlewares, matchFound.RouteInstance.callback];\r\n    middlewares.map(fn => middleware.use(fn));\r\n    // execute middleware\r\n    middleware.execute();\r\n  }\r\n  subscribe(fn){\r\n    this.__subscribing = true;\r\n    if(typeof fn == 'function'){\r\n      this.__router_callback = fn;\r\n    }\r\n    if(this.__properties.initial){\r\n      this.execute(this.__properties.initial, this.__properties.state);\r\n    }\r\n    return () => {\r\n      this.__subscribing = false;\r\n    }\r\n  }\r\n}\r\n\r\nexport default Router;","import { Router } from './SvelteStandaloneRouter.js';\r\n\r\n// handle the linkBase in pathname\r\nexport const getPathname = (path) => {\r\n  const re = new RegExp(`^${Router.linkBase}`, 'i');\r\n  path = `/${path}/`.replace(/[\\/]+/g, '/').replace(re, '').replace(/^\\/|\\/$/g, '');\r\n  return '/' + path;\r\n}\r\n\r\n// dispatch custom event\r\nconst dispatch = ({ state }) => {\r\n  dispatchEvent(new CustomEvent('popstate', { \r\n    detail: {\r\n      ...state\r\n    } \r\n  }));\r\n}\r\n\r\n// navigate to a new page and pushing it to the History object\r\nexport const navigate = (url, state = {}) => {\r\n  url = cleanURL(url);\r\n  history.pushState(state, '', url);\r\n  dispatch({ url, state }); \r\n}\r\n\r\n// redirect to a new page and replacing it on the History object\r\nexport const redirect = (url, state = {}) => {\r\n  url = cleanURL(url);\r\n  history.replaceState(state, '', url);\r\n  dispatch({ url, state });\r\n}\r\n\r\n// change url without route change and add it to the History\r\nexport const replace = (url, state = {}) => {\r\n  history.pushState(state, '', cleanURL(url));\r\n}\r\n\r\n// change url without route change and DON'T add it to the History\r\nexport const alter = (url, state = {}) => {\r\n  history.replaceState(state, '', cleanURL(url));\r\n}\r\n\r\n// replace all duplicate '/' that might be going on\r\nexport const cleanURL = (url) => `/${Router.linkBase}/${url}`.replace(/[\\/]+/g, '/');\r\n\r\n// internal goto helper \r\nexport const internalGoTo = (path, e) => {\r\n  replace(getPathname(path));\r\n  const hash = window.location.hash.slice(1);\r\n  if(hash){\r\n    if(e){\r\n      e.preventDefault();\r\n    }\r\n    const element = document.querySelector(`a[name=\"${hash}\"], #${hash}`);\r\n    if(element){\r\n      const topPos = element.getBoundingClientRect().top + window.pageYOffset - Router.scrollOffset;\r\n      window.scrollTo({ top: topPos });\r\n    }\r\n  }\r\n}","import RouterContext from './SvelteStandaloneRouter.js';\r\nimport { internalGoTo, getPathname, cleanURL } from './helpers.js';\r\nimport { writable } from 'svelte/store';\r\n\r\nexport let prev = { location: { ...window.location }, firstLoad: false };\r\nexport let contexts = new Map();\r\nexport let location = writable();\r\n\r\nlet initialized = false;\r\nlet firstLoad = false;\r\n\r\n// handle internal # links\r\nconst internalLinksHandler = (e) => {\r\n  const target = e.target;\r\n  if(target.tagName == 'A'){\r\n    const href = target.getAttribute('href');\r\n    const isHashLink = href.indexOf('#') > -1;\r\n    if(!(/^[a-zA-Z]+\\:\\/\\/(.*)/.test(href)) && isHashLink){\r\n      // go to position\r\n      internalGoTo(href.startsWith('#') ? window.location.pathname + href : href, e);\r\n      // update the prev data\r\n      prev.location = { ...window.location };\r\n    }\r\n  }\r\n}\r\n\r\n// the popstate callback handler\r\nconst popstateHandler = async e => {\r\n  let endEarly = false;\r\n  const sameURL = cleanURL(window.location.pathname + '/') == cleanURL(prev.location.pathname + '/') && prev.location.search == window.location.search;\r\n  // don't continue if we are doing internal hash linking\r\n  if(window.location.hash != '' && sameURL && prev.firstLoad){\r\n    endEarly = true;\r\n  }\r\n\r\n  // if the hash is empty and not the same as the previous and it's on the same url we \r\n  // don't want to load a new page, then we simply end early and scroll to the top.\r\n  if(window.location.hash == '' && window.location.hash != prev.location.hash && sameURL){\r\n    endEarly = true;\r\n    window.scrollTo({ top: 0 });\r\n  }\r\n\r\n  // if we don't end early we want to update the router contexts\r\n  if(!endEarly){\r\n    // update location and execute the router contexts\r\n    location.set(getPathname(window.location.pathname));\r\n    contexts.forEach(context => context.router.execute(window.location.pathname, e.detail));\r\n  }\r\n\r\n  // update the prev data\r\n  prev.location = { ...window.location };\r\n};\r\n\r\n// if the popstate listener has been destroy 'mount' re-adds the listener \r\nexport const mount = async () => {\r\n  if(!initialized){\r\n    // mark it initialized and update the location store with the current pathname\r\n    initialized = true;\r\n    if(!firstLoad){\r\n      firstLoad = true;\r\n      location.set(getPathname(window.location.pathname));\r\n    }\r\n    window.addEventListener('popstate', popstateHandler);\r\n    window.addEventListener('click', internalLinksHandler);\r\n  }\r\n}\r\n\r\n// destroy a current listener\r\nexport const destroy = () => {\r\n  initialized = false;\r\n  window.removeEventListener('popstate', popstateHandler);\r\n  window.removeEventListener('click', internalLinksHandler);\r\n}\r\n\r\n// export the context creator \"wrapper\"\r\nexport default (options) => {\r\n  // mount on the first load to avoid having \r\n  // the user doing it manually\r\n  mount();\r\n  // creates a new context\r\n  const router = new RouterContext(options);\r\n  contexts.set(router, {\r\n    component: writable(),\r\n    router\r\n  });\r\n  return router;\r\n};","<script>\r\n  import { tick } from 'svelte';\r\n  import RouterContext, { Router, SvelteStandaloneRouterError } from './SvelteStandaloneRouter.js';\r\n  import { contexts, prev } from './router.js';\r\n  import { internalGoTo } from './helpers.js';\r\n\r\n  // as default get the first value from the contexts since a Map remembers the insertion \r\n  // order. this works as a way to fallback to the first context if none is provided\r\n  export let context = contexts.keys().next().value;\r\n  \r\n  if(!context || !(context instanceof RouterContext)){\r\n    throw new Error(`Invalid Router context. Did you initialize the component with a valid context?`);\r\n  }\r\n  const { component } = contexts.get(context);\r\n\r\n  context.subscribe(async (callback, props = {}, decorator = {}) => {\r\n    // a dirty check to see it is a \"component\". Since there is not way to check if it is a svelte component\r\n    // this would atleast force it to be a function and will catch most errors where a svelte component isn't passed\r\n    if(typeof callback != 'function'){\r\n      throw new SvelteStandaloneRouterError(`Unable to load component. Did you pass a valid svelte component to the 'send' response?`);\r\n    }\r\n    \r\n    // reset the scroll position depending on the static scrollReset value\r\n    if(Router.scrollReset){\r\n      // always start from the top of the page\r\n      window.scrollTo({ top: 0 });\r\n    }\r\n    \r\n    // update the writable store\r\n    component.set({\r\n      context: decorator ? callback : class extends callback{},\r\n      decorator: !decorator.component ? undefined : class extends decorator.component{},\r\n      decoratorProps: decorator.props || undefined,\r\n      props\r\n    });\r\n\r\n    // if we have visited a a url with a hash in it\r\n    // we need to await a tick so the component is loaded\r\n    // before we can scroll to that place in the dom\r\n    if(window.location.hash){\r\n      await tick();\r\n      // but we also have this weird behaviour where the location pathname is\r\n      // not accessible so we need to pass it manually.\r\n      setTimeout(() => {internalGoTo(window.location.pathname + window.location.hash)}, 0); \r\n    }\r\n\r\n    // flag that we have a first load\r\n    if(!prev.firstLoad){\r\n      prev.firstLoad = true;\r\n    }\r\n  });\r\n</script>\r\n\r\n{#if $component}\r\n  <slot component={$component.context} props={$component.props} decorator={$component.decorator} decoratorProps={$component.decoratorProps}>\r\n    {#if $component.decorator}\r\n      <svelte:component this={$component.decorator} {...($component.decoratorProps ? $component.decoratorProps : {})}>\r\n        <svelte:component this={$component.context} {...$component.props} />\r\n      </svelte:component>\r\n    {:else}\r\n      <svelte:component this={$component.context} {...$component.props} />\r\n    {/if}\r\n  </slot>\r\n{/if}","import { Router } from './SvelteStandaloneRouter';\r\nimport { navigate, redirect, replace, alter, getPathname, cleanURL } from './helpers.js';\r\n\r\nexport default (element, props) => {\r\n  props = {\r\n    type: 'navigate',\r\n    state: {},\r\n    title: '',\r\n    ...props\r\n  };\r\n\r\n  if(Router.linkBase){\r\n    // first we need to clean the url and add the linkbase. Thats so one can right click and\r\n    // open the page in a new tab or window and go to the right url\r\n    const clean = cleanURL(element.getAttribute('href') || '');\r\n    element.setAttribute('href', clean);\r\n  }\r\n  \r\n  const clickHandler = (e) => {\r\n    // make the check before preventing default behaviour since we should not block \r\n    // the default behaviour if we don't supply the required url string\r\n    let url = props.to || props.href || e.currentTarget.getAttribute('href') || e.currentTarget.getAttribute('data-href');\r\n    if(!url){\r\n      return;\r\n    }\r\n    // here we need to only get the pathname without any linkbase\r\n    // because that is handled in the navigational helpers\r\n    url = getPathname(url);\r\n    e.preventDefault();\r\n    if(props.type == 'navigate'){\r\n      navigate(url, props.state, props.title);\r\n    }else if(props.type == 'redirect'){\r\n      redirect(url, props.state, props.title);\r\n    }else if(props.type == 'replace'){\r\n      replace(url, props.state, props.title);\r\n    }else if(props.type == 'alter'){\r\n      alter(url, props.state, props.title);\r\n    }else{\r\n      console.warn(`Invalid 'use:link' type. Expecting 'navigate'(default), 'redirect', 'replace' or 'alter'`);\r\n      return;\r\n    }\r\n  }\r\n  element.addEventListener('click', clickHandler);\r\n  return {\r\n    update(parameters){\r\n      props = {\r\n        ...props,\r\n        ...parameters\r\n      }\r\n    },\r\n    destroy(){element.removeEventListener('click', clickHandler);}\r\n  }\r\n}","import { contexts } from './router.js';\r\nimport SvelteStandaloneRouter from './SvelteStandaloneRouter.js';\r\n\r\nexport default (context, ...middleware) => {\r\n  let decorator;\r\n  // if no context is provided\r\n  if(!(context instanceof SvelteStandaloneRouter)){\r\n    // then the context is actually the decorator\r\n    decorator = context;\r\n    // and so we get the first context from the context Map\r\n    context = contexts.keys().next().value;\r\n  }else{\r\n    // but if we have a context the decorator is located at the first position\r\n    // of the middlewares so we need to remove it and define it as the decorator\r\n    decorator = middleware.shift();\r\n  }\r\n  if(!context){\r\n    throw new Error(`Invalid Router context. Did you initialize the decorator with a valid context? or made sure to call it after one has been created?`);\r\n  }\r\n  // we need to keep track of the root url else \r\n  // everything would become nested one level deeper\r\n  let root = '';\r\n  const wrappedCall = (url, ...fns) => {\r\n    // define the root of the chaining\r\n    if(!root) root = url;\r\n    let decoratorProps;\r\n    let decoratorPropsCallback = (props) => {\r\n      decoratorProps = { ...props };\r\n    };\r\n    const callback = fns.pop();\r\n    context.get(url, ...[...middleware, ...fns], (req, res) => {\r\n      callback(req, {\r\n        send: (component, props) => {\r\n          res.send(component, props, { component: decorator, props: decoratorProps });\r\n        },\r\n        error: res.error\r\n      }, decoratorPropsCallback);\r\n    });\r\n    return {\r\n      get: (_url, ...args) => wrappedCall(`${root}/${_url}`, ...args)\r\n    };\r\n  }\r\n  return wrappedCall;\r\n}","import { Router, context } from 'svelte-standalone-router';\r\n\r\nimport GeneralError from '~/_views/GeneralError.svelte';\r\n\r\n// no sub dir for localhost\r\nif(!globalThis.electron && window.location.hostname !== 'localhost'){\r\n  Router.linkBase = '/NESBitStudio-web';\r\n}\r\n// router context\r\nconst app = context({ initial: window.location.pathname, base: Router.linkBase });\r\n\r\n// general fallback\r\napp.catch((req, res) => {\r\n  res.send(GeneralError);\r\n});\r\n\r\n\r\nexport { app as context };","class Hotkey{\r\n  constructor({keys, data, groups, options}){\r\n    if(!Array.isArray(keys)){\r\n      throw new Error(`Invalid keys. Expecting array of string representation values.`);\r\n    }\r\n    this.options = {\r\n      ...options\r\n    }\r\n    this.groups = groups || [];\r\n    this.signature = keys.toString();\r\n    this.keys = keys;\r\n    this.data = data;\r\n    // callbacks\r\n    this.__on;\r\n    this.__off;\r\n  }\r\n  get callbacks(){\r\n    return {\r\n      on: this.__on,\r\n      off: this.__off\r\n    };\r\n  }\r\n  on(fn){\r\n    if(typeof fn != 'function'){\r\n      throw new Error(`Invalid 'off' function`);\r\n    }\r\n    this.__on = fn;\r\n    return this;\r\n  }\r\n  off(fn){\r\n    if(typeof fn != 'function'){\r\n      throw new Error(`Invalid 'off' function`);\r\n    }\r\n    this.__off = fn;\r\n    return this;\r\n  }\r\n}\r\n\r\nexport default class HotkeysManager{\r\n  constructor(target, options){\r\n    this.__options = {\r\n      once: true,\r\n      preventDefault: true,\r\n      ...options\r\n    };\r\n    this.__registeredGroups = new Set();\r\n    this.__enabledGroups = '__all__';\r\n    this.__commands = new Map();\r\n    this.__target = target;\r\n  }\r\n  get target(){\r\n    return this.__target;\r\n  }\r\n  _prepare(arr){\r\n    if(!Array.isArray(arr)){\r\n      throw new Error(`Invalid '_prepare' argument. Expecting array, got : [${typeof arr}]`);\r\n    }\r\n    // sort the keys so they always end up in the same order\r\n    return [...arr].map(key => key.toLowerCase()).sort((a, b) => {\r\n      return a.toLowerCase().localeCompare(b.toLowerCase());\r\n    });\r\n  }\r\n  enableAllGroups(){\r\n    this.__enabledGroups = '__all__';\r\n  }\r\n  enableGroups(...groups){\r\n    return [...this.__enabledGroups = [...groups]];\r\n  }\r\n  _find(command){\r\n    // get all command values\r\n    const commands = Array.from(this.__commands.values());\r\n    // sort after priority\r\n    commands.sort((a, b) => b.options.priority - a.options.priority);\r\n\r\n    // filter all commands that includes any route\r\n    let found;\r\n    if(Array.isArray(this.__enabledGroups)){\r\n      found = commands.find(KeyboardShortcut => {\r\n        return KeyboardShortcut.groups.some(g => {\r\n          // find a match which matches groups and signature\r\n          if(!this.__enabledGroups || this.__enabledGroups.includes(g)){\r\n            if(KeyboardShortcut.signature == command.toString()){\r\n              return true;\r\n            }\r\n          }\r\n        });\r\n      });\r\n    // check if we have the __all__ wildcard and to simply look through every single command\r\n    }else if(this.__enabledGroups == '__all__'){\r\n      found = commands.find(KeyboardShortcut => KeyboardShortcut.signature == command.toString());\r\n    }\r\n\r\n    return found;\r\n  }\r\n  set(keySequence, { data, groups, ...props }){\r\n    // check to see if groups is an array and has a size of at least 1\r\n    // else return an array with one item which is the '*' wildcard\r\n    // this will register one global entry\r\n    groups = Array.isArray(groups) && groups.length > 0 ? groups : ['*'];\r\n    // track all registered groups\r\n    groups.map(group => this.__registeredGroups.add(group));\r\n    const keys = this._prepare(keySequence);\r\n    const shortcut = new Hotkey({\r\n      keys, \r\n      data, \r\n      groups,\r\n      options: { \r\n        priority: props.priority || 0,\r\n        once: props.once || this.__options.once, \r\n        preventDefault: props.preventDefault || this.__options.preventDefault,\r\n      }\r\n    });\r\n\r\n    // iterate over all groups and store a reference \r\n    groups.map(group => {\r\n      if(this.__commands.get(`${group},${shortcut.signature}`)){\r\n        throw new Error(`Shortcut already defined : [${group},${shortcut.signature}]`);\r\n      }\r\n      this.__commands.set(`${group},${shortcut.signature}`, shortcut);\r\n    });\r\n\r\n    return shortcut;\r\n  }\r\n  execute(command, state){\r\n    // loop through command sequence and dispatch the events\r\n    // which will execute the command like one pressed the keyboard\r\n    // handle on state\r\n    if(state == 'on' || state == undefined){\r\n      const keys = {};\r\n      command.map(key => keys[key.toLowerCase()] = true);\r\n      const e = new Event(\"keydown\");\r\n      e.customExecuteEvent = keys;\r\n      this.__target.dispatchEvent(e);\r\n    }\r\n\r\n    // handle off state\r\n    if(state == 'off' || state == undefined){\r\n      // release them\r\n      command.map(key => {\r\n        const e = new Event(\"keyup\");\r\n        e.code = key;\r\n        this.__target.dispatchEvent(e);\r\n      });\r\n    }\r\n  }\r\n  subscribe(callback){\r\n    let keys = {};\r\n    let prevCommand = {};\r\n    const keyDownHandler = (e) => {\r\n      if(e.customExecuteEvent){\r\n        keys = e.customExecuteEvent;\r\n      }else{\r\n        keys[e.code.toLowerCase()] = true;\r\n      }\r\n      // get all active keys\r\n      const currentCommand = this._prepare(Object.entries(keys).filter(([k, v]) => v).map(([k, v]) => k.toLowerCase()));\r\n      // store the previous command\r\n      const match = this._find(currentCommand);\r\n      // if we have a match go ahead and trigger the callback\r\n      if(match){\r\n        if(match.options.preventDefault){\r\n          e.preventDefault();\r\n        }\r\n        // prevent command from executing over and over again if the option 'once' is defined\r\n        if(match.options.once && currentCommand.toString() == prevCommand.signature){\r\n          return;\r\n        }\r\n        \r\n        // and store the command signature\r\n        prevCommand = {\r\n          instance: match,\r\n          signature: currentCommand.toString()\r\n        };\r\n        // if the shortcut has on callback, execute that as well\r\n        if(typeof match.callbacks.on == 'function'){\r\n          match.callbacks.on.call(null, { e, Hotkey: match, on: true });\r\n        }else{\r\n          // call the callback\r\n          if(typeof callback == 'function'){\r\n            callback.call(null, { e, Hotkey: match, on: true });\r\n          }\r\n        }\r\n\r\n      }\r\n    }\r\n    const keyUpHandler = e => {\r\n      keys[e.code.toLowerCase()] = false; \r\n      if(prevCommand.instance && typeof prevCommand.instance.callbacks.off == 'function'){\r\n        prevCommand.instance.callbacks.off.call(null, { e, Hotkey: prevCommand.instance, on: false });\r\n      }else{\r\n        // call the callback\r\n        if(prevCommand.instance && typeof callback == 'function'){\r\n          callback.call(null, { e, Hotkey: prevCommand.instance, on: false });\r\n        }\r\n      }\r\n\r\n\r\n      prevCommand = {};\r\n    };\r\n    // 'keydown' since we want to trigger, shift, control, alt etc. 'keypress' does not\r\n    this.__target.addEventListener('keydown', keyDownHandler);\r\n    this.__target.addEventListener('keyup', keyUpHandler);\r\n\r\n    // return unsubscribe method which in turn returns another subscribe method\r\n    // to resubscribe with the same options if need be. \r\n    return () => {\r\n      this.__target.removeEventListener('keyup', keyUpHandler);\r\n      this.__target.removeEventListener('keydown', keyDownHandler);\r\n      return _ => this.subscribe(this.__target, callback);\r\n    }\r\n  }\r\n}","\nimport ShortcutsManager from 'hotkeys-manager';\nimport ActionsManager from \"~/application/ActionsManager\";\n\n// shortcuts manager \nexport const manager = new ShortcutsManager(window, {\n  // once: false,\n});\n\n\nmanager.set(['ControlLeft', 'KeyO'], { data: { action: ActionsManager.action('noop') } });\n\n// subscribe to events\nexport const unsubscribe = manager.subscribe(({ e, Hotkey, on }) => {\n  e.preventDefault();\n  if(on && Hotkey.data && ActionsManager.exist(Hotkey.data.action)){\n    ActionsManager.execute(Hotkey.data.action, Hotkey.data.props);\n  }\n});\n\n// const execute command\nexport const executeCommand = ({ e, Hotkey, on }) => {\n  e.preventDefault();\n  if(on && Hotkey.data && ActionsManager.exist(Hotkey.data.action)){\n    ActionsManager.execute(Hotkey.data.action);\n  }\n  // programmatically call keys up state\n  manager.execute(Hotkey.keys, 'off');\n};\n\nexport default manager;","<script>\r\n  import { link, location } from 'svelte-standalone-router';\r\n  import Tabmenu from '~/_components/Tabmenu.svelte';\r\n  const list = [\r\n    {href: '/graphics/palettes', label: 'Palettes'},\r\n    {href: '/graphics/spritesheets', label: 'Spritesheets'},\r\n    {href: '/graphics/animations', label: 'Animations'},\r\n    {href: '/graphics/metatiles', label: 'Metatiles'},\r\n    {href: '/graphics/tilemaps', label: 'Tilemaps'},\r\n  ];\r\n</script>\r\n\r\n<Tabmenu>\r\n  {#each list as prop}\r\n    <li class=\"no-drag\" class:active={prop.href == $location}>\r\n      <button href={prop.href} label={prop.label} use:link>\r\n        {prop.label}\r\n      </button>\r\n    </li>\r\n  {/each}\r\n</Tabmenu>\r\n\r\n<style>\r\n  button{\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    border: none;\r\n    padding: 0 20px;\r\n    background-color: transparent;\r\n    cursor: pointer;\r\n  }\r\n</style>\r\n\r\n","<script context=\"module\">\r\n  let scroll, wrapper, artboard, mouseScroll = false;\r\n  export const centerScrollAndCanvas = () => {\r\n    scroll.scrollTo((wrapper.offsetWidth / 2) - scroll.offsetWidth / 2, (wrapper.offsetHeight / 2) - scroll.offsetHeight / 2);\r\n  };\r\n</script>\r\n<script>\r\n  import { createEventDispatcher } from 'svelte';  \r\n  import { onDestroy, onMount } from 'svelte';\r\n\r\n  const dispatch = createEventDispatcher();\r\n  // any number other than 2 will displace the content on resize\r\n  let gutter = 2;\r\n\r\n  // lets use the resize handler as our way of knowing when the dom has \r\n  // finished rendered because else we have to use the setTimeout hack \r\n  // to push the centerScrollAndCanvas to the end of the queuestack\r\n  let firstLoad = false;\r\n  let active = false;\r\n  \r\n  const resizeHandler = (entries) => {\r\n    for(const entry of entries){\r\n      if(entry.contentRect){\r\n        const { width, height } = entry.contentRect;\r\n        const w = 4000;\r\n        const h = 4000;\r\n        const calc = {\r\n          x: w * gutter,\r\n          y: h * gutter\r\n        };\r\n        wrapper.style.height = (calc.y) + 'px';\r\n        wrapper.style.width = (calc.x) + 'px';\r\n        // \r\n        if(!firstLoad){\r\n          firstLoad = true;\r\n          centerScrollAndCanvas();\r\n        }\r\n      }\r\n    }\r\n  };\r\n  const resizeObserver = new ResizeObserver(entries => resizeHandler(entries));\r\n\r\n  const scrollEvent = (e) => {\r\n    dispatch('artboardScrollEvent', e);\r\n  }\r\n\r\n  let startX, startY;\r\n  let scrollLeft, scrollTop; \r\n  \r\n  let keyDowns = {};\r\n  const keyDown = (e) => {\r\n    e.preventDefault();\r\n    keyDowns [e.code] = true;\r\n  }\r\n  const keyUp = (e) => {\r\n    keyDowns[e.code] = false;\r\n  }\r\n  \r\n\r\n  const downHandler = (e) => {\r\n    if(!(e.ctrlKey || keyDowns.Space)){\r\n      if(e.which != 2){\r\n        return;\r\n      }\r\n    }\r\n    e.stopImmediatePropagation();\r\n    // if we get this far prevent default behaviour\r\n    e.preventDefault();\r\n    active = true;\r\n    startX = e.pageX - scroll.offsetLeft;\r\n    scrollLeft = scroll.scrollLeft;\r\n    startY = e.pageY - scroll.offsetTop;\r\n    scrollTop = scroll.scrollTop;\r\n  };\r\n\r\n  const upHandler = () => {\r\n    active = false;\r\n  }\r\n\r\n  const moveHandler = (e) => {\r\n    if(!active) return;\r\n    e.preventDefault();\r\n    const x = e.pageX - scroll.offsetLeft;\r\n    const walk = (x - startX) * 1; //scroll-fast\r\n    scroll.scrollLeft = scrollLeft - walk;\r\n    \r\n    const y = e.pageY - scroll.offsetTop;\r\n    const walky = (y - startY) * 1; //scroll-fast\r\n    scroll.scrollTop = scrollTop - walky;\r\n  };\r\n  \r\n  onMount(() => {\r\n    document.addEventListener('keydown', keyDown);\r\n    document.addEventListener('keyup', keyUp);\r\n    resizeObserver.observe(artboard);\r\n    // centerScrollAndCanvas();\r\n\r\n    // add events \r\n    // on:mousemove={moveHandler}\r\n    document.addEventListener('mousemove', moveHandler);\r\n    document.addEventListener('mouseup', upHandler);\r\n  });\r\n  \r\n  onDestroy(() => {\r\n    document.removeEventListener('keydown', keyDown);\r\n    document.removeEventListener('keyup', keyUp);\r\n    // unsubscribe to all elements\r\n    resizeObserver.disconnect();\r\n    document.removeEventListener('mousemove', moveHandler);\r\n    document.removeEventListener('mouseup', upHandler);\r\n  });\r\n</script>\r\n\r\n<div class:active class=\"artboard\" bind:this={artboard} on:wheel={scrollEvent}>\r\n  <div class=\"outer\" bind:this={scroll} on:mousedown={downHandler} on:wheel={e => !mouseScroll ? e.preventDefault() : '' }>\r\n    <div class=\"wrapper\" bind:this={wrapper}>\r\n      <div class=\"content\">\r\n        <slot></slot>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<style>\r\n  .outer{\r\n    width: 100%;\r\n    height: 100%;\r\n    overflow: scroll;\r\n  }\r\n  .artboard{\r\n    --size: 40;\r\n    --opacity: .08;\r\n    position: relative;\r\n    overflow: hidden;\r\n    width: 100%;\r\n    height: 100%;\r\n\r\n    background-position: 0 0, calc(var(--size)/2 * 1px) calc(var(--size)/2 * 1px);\r\n    background-size: calc(var(--size) * 1px) calc(var(--size) * 1px);\r\n    background-image: linear-gradient(45deg, rgba(0,0,0,var(--opacity)) 25%, transparent 25%, transparent 75%, rgba(0,0,0,var(--opacity)) 75%, rgba(0,0,0,var(--opacity)) 100%),linear-gradient(45deg, rgba(0,0,0,var(--opacity)) 25%, rgba(0,0,0,0) 25%, rgba(0,0,0,0) 75%, rgba(0,0,0,var(--opacity)) 75%, rgba(0,0,0,var(--opacity)) 100%);\r\n  }\r\n  .artboard .wrapper{\r\n    overflow: hidden;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n  }\r\n  .content{\r\n    position: relative;\r\n  }\r\n</style>","<script>\r\n  export let color; \r\n  export let selected = undefined;\r\n</script>\r\n\r\n<button class=\"color-selector\" on:click class:selected>\r\n  <div style=\"--color: {color}\">&nbsp;</div>\r\n</button>\r\n\r\n<style>\r\n  button{\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    width: 28px;\r\n    height: 28px;\r\n    border-radius: 50%;\r\n    border: none;\r\n    cursor: pointer;\r\n    background-color: transparent;\r\n    box-shadow: inset 0 0px 1px rgba(230, 195, 227, 0.03), 0 2px 10px rgba(0, 0, 0, 0.5);\r\n  }\r\n  button.selected{\r\n    background-color: rgba(255, 255, 255, 0.1);\r\n  }\r\n  button:hover{\r\n    background-color: rgba(255, 255, 255, 0.2);\r\n  }\r\n  button > div{\r\n    background-color: rgb(var(--color));\r\n    position: relative;\r\n    width: 14px;\r\n    height: 14px;\r\n    border-radius: 50%;\r\n    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.7);  \r\n    overflow: hidden;\r\n  }\r\n</style>","<script>\r\n  import ActionsManager from '~/application/ActionsManager.js';\r\n  import ColorSelectButton from '~/_singles/buttons/ColorSelectButton.svelte';\r\n  import { Palettes } from '~/stores/palettes.store.js';\r\n  const { activeLayer, selectedColor } = Palettes.stores;\r\n</script>\r\n  \r\n{#if $activeLayer}\r\n  <ul>\r\n    {#each $activeLayer.colors as color, i}\r\n      <li>\r\n        <ColorSelectButton color={color.rgb} on:click={_ => ActionsManager.execute('palette_active_color', i)} selected={$selectedColor === i} />\r\n      </li>\r\n    {/each}\r\n  </ul>\r\n{/if}","<script>\r\n  export let selected;\r\n</script>\r\n\r\n<button on:dblclick on:click class:selected><slot></slot></button>\r\n\r\n<style>\r\n  button{\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    width: 100%;\r\n    height: 100%;\r\n    padding: 5px;\r\n    height: 100%;\r\n    border: none;\r\n    border-top: 1px solid rgba(255, 83, 241, 0);\r\n    border-bottom: 1px solid rgba(255, 83, 241, 0);\r\n    background-color: rgba(255, 255, 255, .8);\r\n    box-shadow: inset 0 0px 14px rgba(0, 0, 0, .41), 0 2px 10px rgba(0, 0, 0, 0.5);\r\n    border-radius: 4px;\r\n    background-position: center;\r\n    background-repeat: no-repeat;\r\n    background-size: 55%;\r\n    opacity: 1;\r\n    cursor: pointer;\r\n    transition: background.2s, opacity .2s;\r\n  }\r\n\r\n  button:hover{\r\n    border-top: 1px solid rgba(255, 83, 241, 0);\r\n    background-color: rgba(218, 218, 218, 0.8);\r\n  }\r\n\r\n  button.selected{\r\n    border-top: 1px solid rgba(83, 147, 255, 0.95);\r\n    background-color: rgb(44, 96, 252);\r\n  }\r\n\r\n  button :global(svg){\r\n    fill: rgb(20, 20, 20);\r\n    width: 14px;\r\n    image-rendering: pixelated;\r\n  }\r\n  \r\n  button.selected :global(svg){\r\n    fill: #fff;\r\n  }\r\n\r\n</style>","<script>\r\n  import ActionsManager from '~/application/ActionsManager.js';\r\n  import ToolButton from '~/_singles/buttons/ToolButton.svelte';\r\n  \r\n  import { Toolbar } from '~/modules/spritesheet_editor/tools.js';\r\n  const { tools, activeTool } = Toolbar;\r\n  \r\n  // get the values and sort after weight \r\n  const toolsList = Object.values(tools);\r\n  toolsList.sort((a,b) => b.weight - a.weight);\r\n</script>\r\n\r\n<ul>\r\n  {#each toolsList as tool}\r\n    {#if tool.visible_in_toolbar}\r\n      <li>\r\n        <ToolButton on:dblclick={_ => ActionsManager.execute('noop')} on:click={_ => ActionsManager.execute('spritesheet_set_active_tool', tool.enum)} selected={$activeTool === tool}>\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\"><path d=\"{tool.icon}\" /></svg>\r\n        </ToolButton>\r\n      </li>\r\n    {/if}\r\n  {/each}\r\n</ul>\r\n\r\n<style>\r\n  li{\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    margin: 2px 0;\r\n    width: 28px;\r\n    height: 28px;\r\n  }\r\n</style>","<script>\r\n  import { createEventDispatcher } from 'svelte';\r\n  const dispatch = createEventDispatcher();\r\n  export let variant = undefined;\r\n  const click = (e) => {\r\n    if(variant == 'danger' && !(e.ctrlKey || e.altKey)){\r\n      return;\r\n    }\r\n    dispatch('click');\r\n  };\r\n</script>\r\n\r\n<button class:danger={variant == 'danger'} role=\"button\" {...$$props} on:click={click}><slot>placeholder</slot></button>\r\n\r\n<style>\r\n  \r\n  button{\r\n    margin: 0;\r\n    padding: 0;\r\n    border: none;\r\n    background: transparent;\r\n    cursor: pointer;\r\n    font-size: 11rem;\r\n    white-space: nowrap;\r\n  }\r\n\r\n  [role=\"button\"]{\r\n    display: flex;\r\n    padding: 0 10px;\r\n    min-height: 25px;\r\n    border: none;\r\n    cursor: pointer;\r\n    border-radius: 3px;\r\n    background: rgb(44, 96, 252);\r\n    color: rgba(255, 255, 255, 0.95);\r\n    border: 1px solid rgba(255, 255, 255, 0);\r\n    transition: background .13s;\r\n    justify-content: center;\r\n    align-items: center;\r\n  }\r\n\r\n  [role=\"button\"]:hover{\r\n    background: rgb(29, 77, 221);\r\n    color: rgba(255, 255, 255, 0.95);\r\n    border: 1px solid rgba(255, 255, 255, 0.095);\r\n  }\r\n\r\n  button.danger{\r\n    background-color: rgb(192, 24, 69);\r\n  }\r\n  button.danger:hover{\r\n    background-color: rgb(162, 23, 60);\r\n  }\r\n</style>","  /*\r\n    Shorten string to max amount of characters at nearest space\r\n\r\n    @param String\r\n    @param Number\r\n    @param String\r\n    @param Function\r\n\r\n    @return String\r\n\r\n    // Usage: \r\n    // const string = \"Lorem ipsum dolor sit amet consectetur adipisicing elit.\";\r\n    // const paragraph = slim(string, 40, ' ', _ => _ + '...');\r\n    // console.log(paragraph);\r\n  */\r\n export const slim = (s, n, char, fn) => {\r\n  const o = s;\r\n  if(n < o.length){\r\n    const max = s.slice(0, n);\r\n    s = max.slice(0, max.lastIndexOf(char));\r\n  }\r\n  if(typeof fn === 'function'){\r\n    s = fn.call(null, s, o, char);\r\n  }\r\n  return s;\r\n}","<script>\r\n  import { createEventDispatcher } from 'svelte';\r\n\r\n  import { slim } from '~/utils/strings';\r\n  \r\n  export let active;\r\n  export let label;\r\n  export let iconIndicator;\r\n\r\n  const dispatch = createEventDispatcher();\r\n  \r\n  // local properties\r\n  let element;\r\n  let previous = null;\r\n  \r\n  // on click\r\n  export const edit = (e) => {\r\n    e.preventDefault();\r\n    let once = false;\r\n    // handle single and doubleclicks. if detail is undefined assume it's called programatically\r\n    if(e.detail == 1 && e.target == element){\r\n      dispatch('makeActive');\r\n      if(!once){\r\n        once = true;\r\n        setTimeout(_ => once = false, 60);\r\n      }\r\n    }else{\r\n      iconIndicator = false;\r\n      element.contentEditable = true;\r\n      element.focus();\r\n    }\r\n  };\r\n\r\n  // on focusing label heading\r\n  const focus = _ => {\r\n    _.target.textContent = label;\r\n    const range = document.createRange();\r\n    const selection = window.getSelection();\r\n    range.selectNodeContents(_.target);\r\n    selection.removeAllRanges();\r\n    selection.addRange(range);\r\n  }\r\n\r\n  // on key down validate input\r\n  const validateInput = (e) => {\r\n    if(!previous){\r\n      previous = e.currentTarget.textContent;\r\n    }\r\n    e.stopPropagation();\r\n    e.stopImmediatePropagation();\r\n\r\n    // escape\r\n    if(e.which == 27){\r\n      e.currentTarget.textContent = previous;\r\n      e.preventDefault();\r\n      element.blur();\r\n      return;\r\n    }\r\n    \r\n    // enter\r\n    if(e.which == 13){\r\n      e.preventDefault();\r\n      element.blur();\r\n    }\r\n\r\n    // backspace, delete, left arrow, right arrow\r\n    if(e.which == 8 || e.which == 46 || e.which == 37 || e.which == 39){\r\n      return;\r\n    }\r\n\r\n    // check valid character\r\n    const isValidCharacter = /^[a-z\\s]$/i.test(e.key);\r\n    if(!isValidCharacter && e.key !== 'Backspace'){\r\n      e.preventDefault();\r\n      return;\r\n    }\r\n\r\n    // prevent to long labels\r\n    if(e.currentTarget.textContent.length > 20){\r\n      e.preventDefault();\r\n    }\r\n  };\r\n\r\n  // on blurring\r\n  const blur = _ => {\r\n    previous = null;\r\n    iconIndicator = true;\r\n    const v = _.target.textContent;\r\n    _.target.textContent = slim(v, 15, '', (n, o) => n != o ? n + '...' : n);\r\n    window.getSelection().removeAllRanges();\r\n    _.target.contentEditable = false;\r\n    // update the store entry with the new heading\r\n    dispatch('change', v);\r\n  };\r\n</script>\r\n\r\n<div class=\"heading\" spellcheck=\"false\" on:click={edit} on:focus={focus} on:blur={blur} on:keydown={validateInput} class:active bind:this={element}>\r\n  <slot>Label</slot>\r\n</div>\r\n\r\n<style>\r\n  .heading{\r\n    display: flex;\r\n    cursor: pointer;\r\n    align-items: center;\r\n    line-height: 33px;\r\n    padding: 0 5px;\r\n    height: 100%;\r\n    width: 100%;\r\n    font-weight: normal;\r\n  }\r\n\r\n  .heading.active{\r\n    font-style: italic;\r\n  }\r\n  .heading{\r\n    position: relative;\r\n    display: flex;\r\n    align-items: center;\r\n    cursor: pointer;\r\n    width: 100%;\r\n  }\r\n  .heading::selection{\r\n    padding: 0 5px;\r\n    background: white;\r\n    color: black;\r\n  }\r\n</style>","<script>\r\n  export let variant = undefined;\r\n</script>\r\n\r\n<button on:click class:danger={variant == 'danger'}>\r\n  <slot></slot>\r\n</button>\r\n\r\n<style>\r\n  button:hover :global(svg){\r\n    fill: rgba(255, 255, 255, 1);\r\n  }\r\n  button{\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    margin-right: 1px;\r\n    width: 24px;\r\n    padding: 5px;\r\n    height: 100%;\r\n    border: none;\r\n    border-radius: 4px;\r\n    background-position: center;\r\n    background-repeat: no-repeat;\r\n    background-size: 55%;\r\n    opacity: 1;\r\n    cursor: pointer;\r\n    border-top: 1px solid rgba(83, 147, 255, 0.95);\r\n    background-color: rgb(44, 96, 252);\r\n    box-shadow: inset 0 0px 2px rgba(0, 0, 0, .41), 0 2px 10px rgba(0, 0, 0, 0.5);\r\n  }\r\n\r\n  .danger{\r\n    border-top: 1px solid rgba(255, 83, 83, 0.95);\r\n    background-color: rgb(192, 24, 69);\r\n  }\r\n</style>","// drag directive\r\nexport const drag = (node, props) => {\r\n  if(!props || typeof props.type != 'string'){\r\n    throw new Error(`Invalid 'drag' actions properties. Expecting 'type' of type 'string'`)\r\n  }\r\n\r\n  if(!props.value){\r\n    throw new Error(`Invalid 'drag' actions value.`)\r\n  }\r\n\r\n  // enable the drag and drop api\r\n  node.draggable = true;\r\n  node.classList.add('draggable');\r\n  const dragStart = (e) => {\r\n    // don't let event propagate if we have possible nested drags\r\n    e.stopImmediatePropagation();\r\n    e.dataTransfer.setData(props.type, JSON.stringify(props.value || ''));\r\n    // this is some hacky stuff. since on the canvas we listen for windows mouse events but dragdrop never fires\r\n    // mouseup on release. so force it here if we start dragging something.\r\n    window.dispatchEvent(new Event('mouseup'));\r\n  };\r\n  node.addEventListener('dragstart', dragStart);\r\n  \r\n\treturn {\r\n    destroy() {\r\n      // remove listener\r\n      node.removeEventListener('dragstart', dragStart);\r\n    }\r\n\t};\r\n}\r\n\r\n\r\n// drop directive\r\nexport const drop = (node, props) => {\r\n  if(!props){\r\n    throw new Error(`Invalid 'drop' actions props.`);\r\n  }\r\n  const callback = (key, pass) => {\r\n    if(!props[key] && typeof props[key] != 'function'){\r\n      if(!pass){\r\n        throw new Error(`Invalid 'drop' callback : [${key}]`);\r\n      }\r\n      return;\r\n    }\r\n    return props[key];\r\n  }\r\n  // handle dragover\r\n  const dragOver = (e) => {\r\n    e.preventDefault();\r\n    callback('over', true).call(null, e, node);\r\n  };\r\n  node.addEventListener('dragover', dragOver);\r\n  const dragLeave = (e) => {\r\n    callback('leave', true).call(null, e, node);    \r\n  };\r\n  node.addEventListener('dragleave', dragLeave);\r\n  // handle dropping of items\r\n  const drop = (e) => {\r\n    callback('drop').call(null, { e, node, value: props.value });\r\n  };\r\n  node.addEventListener('drop', drop);\r\n\r\n\treturn {\r\n\t\tdestroy() {\r\n      // remove listener\r\n      node.removeEventListener('dragover', dragOver);\r\n      node.removeEventListener('drop', drop);\r\n    }\r\n\t};\r\n}","<script>\r\n  import { createEventDispatcher } from 'svelte';\r\n  import LabelHeading from '~/_components/LabelHeading.svelte';\r\n  import ActionButton from '~/_singles/buttons/ActionButton.svelte';\r\n  \r\n  import { slim } from '~/utils/strings';\r\n  import { drag, drop } from '~/actions/dragdrop';\r\n  \r\n  export let source = undefined;\r\n  export let activeLayer = undefined;\r\n  export let showEditButtons = true;\r\n  export let layerIndex = undefined;\r\n\r\n  let iconIndicator = true;\r\n  \r\n  // edit heading \r\n  let label, heading;\r\n  const dispatch = createEventDispatcher();\r\n\r\n  // don't allow left-click remove\r\n  const removeLayer = (e) => {\r\n    if(e.ctrlKey || e.altKey){\r\n      dispatch('remove', source);\r\n    }else{\r\n      // send notification modal that one has to use right-click or ctrl + click\r\n      console.warn(`Dispatch tooltip to let user know he has to hold down ctr or alt key`);\r\n    }\r\n  };\r\n\r\n  // dispatch clone event\r\n  const cloneLayer = (e) => dispatch('clone', source);\r\n\r\n  let over;\r\n  const dropDirective = {\r\n    over: _ => over = true,\r\n    leave: _ => over = false,\r\n    drop: ({ e, value }) => {\r\n      over = false;\r\n      const flip = e.dataTransfer.getData('flipPalette');\r\n      if(flip){\r\n        const n = Number(JSON.parse(flip).layerIndex);\r\n        dispatch('swapLayers', { to: n, from: value.layerIndex });\r\n      }\r\n    }\r\n  };\r\n\r\n  // reactive statements\r\n  $: label = slim(source.label, 15, '', (n, o) => n != o ? n + '...' : n);\r\n  $: active = source == $activeLayer;\r\n</script>\r\n\r\n<div class=\"layer-item\" class:over class:active use:drag={{ type: 'flipPalette', value: {layerIndex} }} use:drop={{ ...dropDirective, value: { layerIndex }}}>\r\n  <div class=\"panel-header\">\r\n    <LabelHeading \r\n      {active} \r\n      label={source.label} \r\n      bind:iconIndicator \r\n      bind:this={heading} \r\n      on:makeActive={ e => dispatch('makeActive', source)}\r\n      on:change={e => dispatch('updateLabel', { source, value: e.detail })}>\r\n      {label}\r\n    </LabelHeading>\r\n    {#if iconIndicator}\r\n      <div class=\"icon-indicator\">\r\n        <ActionButton on:click={e => heading.edit(e)}>\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\"><path d=\"M19.769 9.923l-12.642 12.639-7.127 1.438 1.438-7.128 12.641-12.64 5.69 5.691zm1.414-1.414l2.817-2.82-5.691-5.689-2.816 2.817 5.69 5.692z\"/></svg>\r\n        </ActionButton>\r\n          {#if showEditButtons}\r\n            <ActionButton on:click={cloneLayer}>\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\"><path d=\"M18 6v-6h-18v18h6v6h18v-18h-6zm-12 10h-4v-14h14v4h-10v10zm16 6h-14v-14h14v14zm-3-8h-3v-3h-2v3h-3v2h3v3h2v-3h3v-2z\"/></svg>\r\n            </ActionButton>\r\n            <ActionButton on:click={removeLayer} variant=\"danger\">\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\"><path d=\"M3 6v18h18v-18h-18zm5 14c0 .552-.448 1-1 1s-1-.448-1-1v-10c0-.552.448-1 1-1s1 .448 1 1v10zm5 0c0 .552-.448 1-1 1s-1-.448-1-1v-10c0-.552.448-1 1-1s1 .448 1 1v10zm5 0c0 .552-.448 1-1 1s-1-.448-1-1v-10c0-.552.448-1 1-1s1 .448 1 1v10zm4-18v2h-20v-2h5.711c.9 0 1.631-1.099 1.631-2h5.315c0 .901.73 2 1.631 2h5.712z\"/></svg>\r\n            </ActionButton>\r\n          {/if}\r\n        </div>\r\n      {/if}\r\n  </div>\r\n  <slot></slot>\r\n</div>\r\n\r\n<style>\r\n  .layer-item.active *{\r\n    color: var(--active-color);\r\n  }\r\n  .layer-item.active{\r\n    filter: brightness(110%);\r\n  }\r\n  .panel-header{\r\n    position: relative;\r\n    background: linear-gradient(0deg, rgba(69, 28, 78, 1) 40%, transparent);\r\n    height: 33px;\r\n    box-shadow: 0 3px 20px rgba(0, 0, 0, 1);\r\n    border-bottom: 1px solid rgba(89, 53, 98, .81);\r\n    /* font-size: 9rem; */\r\n    text-align: left;\r\n    border-radius: 2px 2px 0 0;\r\n    overflow: hidden;\r\n    /* color: rgb(250, 170, 14); */\r\n  }\r\n\r\n  .panel-header::before{\r\n    content: '';\r\n    position: absolute;\r\n    top: 2px;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 5px;\r\n    background: rgba(234, 187, 250, 0.25);\r\n    filter: blur(3px);\r\n  }\r\n\r\n  .panel-header::after{\r\n    content: '';\r\n    position: absolute;\r\n    top: 5px;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 1px;\r\n    background: rgba(215, 130, 255, 0.25);\r\n    filter: blur(1px);\r\n  }\r\n\r\n  .panel-header :global([contenteditable]:focus){\r\n    background-color: rgb(44, 96, 252);\r\n    color: rgba(255, 255, 255, 0.8);\r\n    outline: none;\r\n  }\r\n\r\n\r\n  .icon-indicator{\r\n    padding: 5px 0;\r\n    display: flex;\r\n    align-items: center;\r\n    position: absolute;\r\n    top: 0;\r\n    right: 5px;\r\n    height: 100%;\r\n    z-index: 10;\r\n    cursor: pointer;\r\n  }\r\n  .icon-indicator > :global(button){\r\n    margin-left: 2px;\r\n  }\r\n  .icon-indicator svg{\r\n    fill: rgba(255, 255, 255, 0.699);\r\n    transition: fill .4s;\r\n  }\r\n\r\n  svg{\r\n    fill: #fff;\r\n  }\r\n\r\n  :global(.selected){\r\n    background-color: var(--accent-blue);\r\n    color: rgb(255, 255, 255);\r\n    font-style: italic;\r\n  }\r\n</style>","<script>\r\n  import ActionsManager from '~/application/ActionsManager.js';\r\n  import { Spritesheets } from '~/stores/spritesheets.store.js';\r\n  import Layer from '~/_components/Layer.svelte';\r\n\r\n  const removeLayer = (e) => ActionsManager.execute('spritesheet_remove', e.detail);\r\n  const updateLabel = e => ActionsManager.execute('spritesheet_update_layer_label', { source: e.detail.source, label: e.detail.value });\r\n  const makeLayerActive = e => ActionsManager.execute('spritesheet_make_layer_active', e.detail);\r\n  const cloneLayer = e => ActionsManager.execute('spritesheet_clone_layer', e.detail);\r\n  const swapLayers = e => ActionsManager.execute('spritesheet_swap_layers', e.detail);\r\n</script>\r\n\r\n<Layer {...$$restProps} on:swapLayers={swapLayers} on:remove={removeLayer} on:updateLabel={updateLabel} on:makeActive={makeLayerActive} on:clone={cloneLayer}>\r\n  <slot></slot>\r\n</Layer>","<script>\r\n  import { onMount } from \"svelte\";\r\n  export let source;\r\n  let wrapper;\r\n  onMount(() => {\r\n    wrapper.appendChild(source.element);\r\n  });\r\n</script>\r\n\r\n<div class=\"canvas-wrapper\" bind:this={wrapper}></div> \r\n\r\n<style>\r\n  .canvas-wrapper{\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    padding: 30rem 10rem;\r\n    width: 100%;\r\n    background: rgba(0, 0, 0, 0.481);\r\n    border: 1px solid rgba(255, 255, 255, 0.097);\r\n  }\r\n  .canvas-wrapper > :global(canvas){\r\n    width: 128px;\r\n    height: 128px;\r\n    background-color: black;\r\n    image-rendering: -moz-crisp-edges;\r\n    image-rendering: -webkit-crisp-edges;\r\n    image-rendering: pixelated;\r\n    image-rendering: crisp-edges;\r\n  }\r\n</style>","<script>\r\n  import Button from '~/_singles/buttons/Button.svelte';\r\n  import Layer from '~/_components/graphics/SpritesheetLayer.svelte';\r\n  import CanvasPreview from '~/_components/graphics/CanvasPreview.svelte';\r\n  \r\n  import ActionsManager from '~/application/ActionsManager';  \r\n  import { Spritesheets } from '~/stores/spritesheets.store.js';\r\n\r\n  const { activeLayer, layers } = Spritesheets.stores;\r\n</script>\r\n\r\n<div class=\"palette-layer\">\r\n\r\n  <div class=\"layers\">\r\n    {#if $layers.length}\r\n      {#each $layers as canvas, layerIndex (canvas.uuid)}\r\n        <Layer source={canvas} activeLayer={activeLayer} {layerIndex}>\r\n          <CanvasPreview source={canvas} />\r\n        </Layer>\r\n      {/each}\r\n    {:else}\r\n      <div class=\"center\">\r\n        No spritesheets\r\n      </div>\r\n    {/if}\r\n  </div>\r\n\r\n  <div class=\"center\">\r\n    <Button on:click={_ => ActionsManager.execute('spritesheet_create')}>Create spritesheet</Button>\r\n  </div>\r\n\r\n</div>\r\n\r\n<style>\r\n  .center{\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    flex-direction: column;\r\n    height: 100%;\r\n    padding: 15rem;\r\n  }\r\n\r\n  .palette-layer{\r\n    position: relative;\r\n    display: grid;\r\n    grid-template-rows: calc(100% - 40px) 40px;\r\n    height: 100%;\r\n  }\r\n  .layers{\r\n    overflow-y: auto;\r\n  }\r\n</style>","<script>\r\n  import ActionsManager from '~/application/ActionsManager.js';\r\n  import Layer from '~/_components/Layer.svelte';\r\n\r\n  const removeLayer = (e) => ActionsManager.execute('palette_remove', e.detail);\r\n  const updateLabel = e => ActionsManager.execute('palette_update_layer_label', { source: e.detail.source, label: e.detail.value });\r\n  const makeLayerActive = e => ActionsManager.execute('palette_make_layer_active', e.detail);\r\n  const cloneLayer = e => ActionsManager.execute('palette_clone_layer', e.detail);\r\n  const swapLayers = e => ActionsManager.execute('palette_swap_layers', e.detail);\r\n</script>\r\n\r\n<Layer {...$$restProps} on:swapLayers={swapLayers} on:remove={removeLayer} on:updateLabel={updateLabel} on:makeActive={makeLayerActive} on:clone={cloneLayer}>\r\n  <slot></slot>\r\n</Layer>","<script>\r\n  import { Palettes } from '~/stores/palettes.store.js';\r\n  import { drag } from '~/actions/dragdrop';\r\n\r\n  export let rgb;\r\n  export let hex;\r\n  export let type;\r\n  export let layerIndex = undefined;\r\n  export let colorIndex = undefined;\r\n\r\n  const { selectedColor, activeLayer } = Palettes.stores;\r\n</script>\r\n\r\n<div \r\n  class=\"color\" \r\n  data-hex={hex} \r\n  style=\"--rgb: rgb({rgb.join(',')});\"  \r\n  on:click \r\n  class:active={$activeLayer && colorIndex == $selectedColor && layerIndex == Palettes.layerIndexFromSource($activeLayer)} \r\n  use:drag={{ type, value: { rgb, hex, type, layerIndex, colorIndex } }}>\r\n  <span style=\"pointer-events: none;\">\r\n    <slot>0x{hex}</slot>\r\n  </span>\r\n</div>\r\n\r\n<style>\r\n  @keyframes bounce{\r\n    from{\r\n      box-shadow: 0 0 6px var(--rgb);\r\n    }\r\n    to{\r\n      box-shadow: 0 0 18px var(--rgb);\r\n    }\r\n  }\r\n  .active::after{\r\n    content: '';\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    animation-name: bounce;\r\n    animation-duration: 1.5s;\r\n    animation-timing-function: linear;\r\n    animation-fill-mode: both;\r\n    animation-iteration-count: infinite;\r\n    animation-direction: alternate;\r\n    filter:brightness(1.5);\r\n    pointer-events: none;\r\n  }\r\n  .color{\r\n    --rgb: red;\r\n    position: relative;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: var(--rgb);\r\n    font-variant-numeric: tabular-nums;\r\n    border-radius: 2px;\r\n    border: 1px solid rgba(0, 0, 0, 0);\r\n    opacity: 1;\r\n    cursor: pointer;\r\n  }\r\n\r\n  .color > span{\r\n    position: absolute;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    opacity: 1;\r\n    padding: 2px 5px;\r\n    top: 2px;\r\n    left: 2px;\r\n    border-radius: 2px;\r\n    background-color: rgba(0, 0, 0, .3);\r\n    color: white;\r\n    min-width: 20px;\r\n    min-height: 20px;\r\n  }\r\n\r\n  .color:hover{\r\n    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5), inset 0 0 10px rgba(255, 255, 255, .4);\r\n    border: 1px solid rgba(255, 255, 255, 0.025);\r\n    filter: brightness(1.1);\r\n  }\r\n</style>","<script>\r\n  import { Palettes } from '~/stores/palettes.store.js';\r\n  import Button from '~/_singles/buttons/Button.svelte';\r\n  import Layer from '~/_components/graphics/PaletteLayer.svelte';\r\n  import Color from '~/_singles/Color.svelte';\r\n\r\n  import ActionsManager from '~/application/ActionsManager';\r\n\r\n  // actions\r\n  import { drop } from '~/actions/dragdrop';\r\n  \r\n  export let showEditButtons = true;\r\n  \r\n  const { activeLayer, layers } = Palettes.stores;\r\n\r\n  let over;\r\n  const colorDirective = {\r\n    over: _ => over = true,\r\n    leave: _ => over = false,\r\n    drop: ({ e, value }) => {\r\n      over = false;\r\n      const swap = e.dataTransfer.getData('swap');\r\n      if(swap){\r\n        layers.swapColors({ ...JSON.parse(swap), to: {...value} });\r\n      }\r\n\r\n      // handle replacement\r\n      const replace = e.dataTransfer.getData('replace');\r\n      if(replace){\r\n        layers.replaceColor({ ...JSON.parse(replace), ...value });\r\n      }\r\n    }\r\n  };\r\n</script>\r\n\r\n<div class=\"palette-layer\">\r\n  <div class=\"layers\">\r\n    {#if $layers && $layers.length}\r\n      {#each $layers as palette, layerIndex}\r\n        <Layer source={palette} {showEditButtons} activeLayer={activeLayer} {layerIndex}>\r\n          <ul>\r\n            {#each palette.colors as color, colorIndex (colorIndex)}\r\n              <li use:drop={{ ...colorDirective, value: { layerIndex, colorIndex }}}>\r\n                <Color hex={color.hex} rgb={color.rgb} {layerIndex} {colorIndex} type=\"swap\">0x{color.hex}</Color>\r\n              </li>\r\n            {/each}\r\n          </ul>\r\n        </Layer>\r\n      {/each}\r\n    {:else}\r\n      <div class=\"center\">\r\n        No palettes\r\n      </div>\r\n    {/if}\r\n  </div>\r\n  <div class=\"center\">\r\n    {#if showEditButtons}\r\n      <Button on:click={_ => ActionsManager.execute('palette_create')}>Create palette</Button>\r\n    {/if}\r\n  </div>\r\n\r\n</div>\r\n\r\n<style>\r\n  .center{\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    flex-direction: column;\r\n    height: 100%;\r\n    padding: 15rem;\r\n  }\r\n\r\n  .palette-layer{\r\n    position: relative;\r\n    display: grid;\r\n    grid-template-rows: calc(100% - 40px) 40px;\r\n    height: 100%;\r\n  }\r\n\r\n  .layers{\r\n    overflow-y: auto;\r\n  }\r\n  ul{\r\n    padding: 2px 0;\r\n    display: grid;\r\n    grid-template-columns: repeat(4, 1fr);\r\n    gap: 2px;\r\n  }\r\n  li{\r\n    --color: #000;\r\n    position: relative;\r\n    display: flex;\r\n    align-items: flex-start;\r\n    justify-content: left;\r\n    background-color: var(--color);\r\n    width: 100%;\r\n    height: 40px;\r\n    cursor: move;\r\n  }\r\n</style>","export default (element, fn) => {\r\n  const handler = (e) => {\r\n    if(!element.contains(e.target)){\r\n      e.preventDefault();\r\n      fn.call(null);\r\n    }\r\n  }\r\n  window.addEventListener('click', handler);\r\n  return {\r\n    destroy(){\r\n      window.removeEventListener('click', handler);\r\n    }\r\n  }\r\n}","<script>\r\n  import clickOutside from '~/actions/clickoutside.js'; \r\n  import CircularPillButton from '~/_singles/buttons/CircularPillButton.svelte';\r\n  let active = false;\r\n</script>\r\n\r\n<div class=\"select-button\" class:active use:clickOutside={_ => active = false}>\r\n  <slot></slot>\r\n  <CircularPillButton on:click={_ => active = !active}>\r\n    <slot name=\"icon\"></slot>\r\n  </CircularPillButton>\r\n  <div class=\"dropdown\">\r\n    <slot name=\"list\"></slot>\r\n  </div>\r\n</div>\r\n\r\n<style>\r\n  .select-button{\r\n    position: relative;\r\n  }\r\n  .active .dropdown{\r\n    opacity: 1 !important;\r\n    pointer-events: all !important;\r\n  }\r\n  .dropdown{\r\n    opacity: 0;\r\n    position: absolute;\r\n    top: 35px;\r\n    left: -5px;\r\n    background-color: rgba(0, 0, 0, 0.09);\r\n    border-radius: 4px;\r\n    padding: 0 5px;\r\n    pointer-events: none;\r\n    transition: opacity .2s;\r\n  }\r\n  .dropdown :global(*){\r\n    display: flex;\r\n    flex-direction: column;\r\n    margin: 5px 0;\r\n  }\r\n  .dropdown :global(* > *){\r\n    margin: 2px 0;\r\n  }\r\n</style>\r\n\r\n\r\n","<script>\r\n  import { createEventDispatcher } from 'svelte';\r\n  const dispatch = createEventDispatcher();\r\n</script>\r\n\r\n<div id=\"buttons\">\r\n  <div class=\"group\">\r\n    <slot></slot>\r\n  </div>  \r\n  <div class=\"group\">\r\n    <button on:click={_ => dispatch('centerArtboard')}><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"13\" height=\"13\" viewBox=\"0 0 24 24\"><path d=\"M10.573 3.021h7.427v-3.021l6 5.39-6 5.61v-3h-7.427c-3.071 0-5.561 2.356-5.561 5.427 0 3.071 2.489 5.573 5.561 5.573h7.427v5h-7.427c-5.84 0-10.573-4.734-10.573-10.573s4.733-10.406 10.573-10.406z\"/></svg></button>\r\n  </div>\r\n</div>\r\n\r\n<style>\r\n  #buttons{\r\n    position: absolute;\r\n    top: 0;\r\n    right: 0;\r\n    padding: 14px 10px;\r\n    width: 100%;\r\n    color: white;\r\n    z-index: 100;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    flex-direction: row;\r\n    pointer-events: none;\r\n  }\r\n  #buttons > .group{\r\n    display: flex;\r\n    flex-direction: row;\r\n  }\r\n  #buttons button{\r\n    margin: 4px;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    fill: white;\r\n    width: 29px;\r\n    height: 29px;\r\n    border-radius: 50%;\r\n    border: 1px solid rgba(0, 0, 0, 0);\r\n    border-top: 1px solid rgba(83, 147, 255, 0.95);\r\n    border-bottom: 1px solid rgba(0, 0, 0, .3);\r\n    background-color: rgb(44, 96, 252);\r\n    box-shadow: inset 0 0px 2px rgba(0, 0, 0, .41), 0 2px 10px rgba(0, 0, 0, 0.5);\r\n    /* opacity: .85; */\r\n    opacity: 1;\r\n    pointer-events: all;\r\n    cursor: pointer;\r\n    transition: opacity .13s;\r\n  }\r\n\r\n  #buttons button:hover{\r\n    opacity: 1;\r\n  }\r\n  /* .flip{\r\n    transform: scaleX(-1);\r\n  } */\r\n  svg{\r\n    display: inline-block;\r\n  }\r\n\r\n\r\n</style>","<script>\r\n  import ActionsManager from '~/application/ActionsManager.js';\r\n  \r\n  import SelectButton from '~/_components/SelectButton.svelte';\r\n  import Button from '~/_singles/buttons/Button.svelte';\r\n  import ArtboardOptions from '~/_components/ArtboardOptions.svelte';\r\n</script>\r\n\r\n<ArtboardOptions on:centerArtboard>\r\n  <SelectButton>\r\n    <slot slot=\"icon\">\r\n      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"13\" height=\"13\" viewBox=\"0 0 24 24\"><path d=\"M24 13.616v-3.232c-1.651-.587-2.694-.752-3.219-2.019v-.001c-.527-1.271.1-2.134.847-3.707l-2.285-2.285c-1.561.742-2.433 1.375-3.707.847h-.001c-1.269-.526-1.435-1.576-2.019-3.219h-3.232c-.582 1.635-.749 2.692-2.019 3.219h-.001c-1.271.528-2.132-.098-3.707-.847l-2.285 2.285c.745 1.568 1.375 2.434.847 3.707-.527 1.271-1.584 1.438-3.219 2.02v3.232c1.632.58 2.692.749 3.219 2.019.53 1.282-.114 2.166-.847 3.707l2.285 2.286c1.562-.743 2.434-1.375 3.707-.847h.001c1.27.526 1.436 1.579 2.019 3.219h3.232c.582-1.636.75-2.69 2.027-3.222h.001c1.262-.524 2.12.101 3.698.851l2.285-2.286c-.744-1.563-1.375-2.433-.848-3.706.527-1.271 1.588-1.44 3.221-2.021zm-12 2.384c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z\"/></svg>\r\n    </slot>\r\n    <slot slot=\"list\">      \r\n      <div>\r\n        <Button on:click={_ => ActionsManager.execute('spritesheet_import')}>Import spritesheet</Button>\r\n        <Button on:click={_ => ActionsManager.execute('spritesheet_import_chr')}>Import CHR</Button>\r\n      </div>\r\n      <div>\r\n        <Button on:click={_ => ActionsManager.execute('spritesheet_export')}>Export spritesheet</Button>\r\n        <Button on:click={_ => ActionsManager.execute('spritesheet_export_chr')}>Export CHR</Button>\r\n        <Button on:click={_ => ActionsManager.execute('spritesheet_export_png')}>Export PNG</Button>\r\n      </div>\r\n      <div>\r\n        <Button variant=\"danger\" on:click={_ => ActionsManager.execute('spritesheet_clear')}>Clear all</Button>\r\n      </div>\r\n    </slot>\r\n  </SelectButton>\r\n</ArtboardOptions>","<script>\r\n  import { onMount } from \"svelte\";\r\n  import { Palettes } from '~/stores/palettes.store.js';\r\n  import { Spritesheets } from '~/stores/spritesheets.store.js';\r\n  import SpritesheetEditor from './SpritesheetEditor';\r\n  import { primary, secondary, move, mouseup } from '~/modules/spritesheet_editor/tools.js';\r\n\r\n  export let zoom;\r\n\r\n  const { activeLayer, layers, width, height } = Spritesheets.stores;\r\n  const activePaletteLayer = Palettes.stores.activeLayer;\r\n\r\n  let canvas;\r\n  \r\n  let editor = new SpritesheetEditor({\r\n    width, \r\n    height \r\n  }); \r\n\r\n  // bind events\r\n  editor.on('primary', (e) => primary(e));\r\n  editor.on('secondary', (e) => secondary(e));\r\n  editor.on('move', (e) => move(e));\r\n  editor.on('mouseup', (e) => mouseup(e));\r\n\r\n\r\n  $: if(canvas){\r\n    // editor\r\n    editor.defineCanvas(canvas);\r\n  }\r\n\r\n  onMount(() => {\r\n    // clean up\r\n    return () => {\r\n      if(editor){\r\n        editor.destroy();\r\n      }\r\n    }\r\n  });\r\n</script>\r\n\r\n{#if $activeLayer && $layers.length && $activePaletteLayer}\r\n  <div style=\"--zoom: {zoom};\">\r\n    <canvas bind:this={canvas} width={128} height={128}>\r\n      <slot></slot>\r\n    </canvas>\r\n  </div>\r\n{:else}\r\n  Please select a spritesheet and palette\r\n{/if}\r\n\r\n<style>\r\n  div{\r\n    --zoom: 3;\r\n    transform: scale(var(--zoom));\r\n    transition-timing-function: linear;\r\n    transition: transform .15s;\r\n    padding: 4px;\r\n    border-radius: 1px;\r\n    background-color: rgba(0, 0, 0, .25);\r\n    transform-origin: center center;\r\n    box-shadow: 0 0 5px rgba(0, 0, 0, .2);\r\n  }\r\n\r\n  canvas{\r\n    display: block;\r\n    cursor: var(--canvas-cursor, none);\r\n    position: relative;\r\n    image-rendering: -moz-crisp-edges;\r\n    image-rendering: -webkit-crisp-edges;\r\n    image-rendering: pixelated;\r\n    image-rendering: crisp-edges;\r\n    \r\n    /* border: 1px solid rgba(255, 255, 255, .02); */\r\n    /* transitions for when the canvas zooms */\r\n    /*\r\n    cursor: url(\"data:image/svg+xml,%3Csvg version='1.1' id='Layer_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='220px' y='200px' width='16px' height='16px' viewBox='0 0 512 512' style='enable-background:new 0 0 512 512;' xml:space='preserve'%3E %3Cpath fill='white' d='M443.6,387.1L312.4,255.4l131.5-130c5.4-5.4,5.4-14.2,0-19.6l-37.4-37.6c-2.6-2.6-6.1-4-9.8-4c-3.7,0-7.2,1.5-9.8,4 L256,197.8L124.9,68.3c-2.6-2.6-6.1-4-9.8-4c-3.7,0-7.2,1.5-9.8,4L68,105.9c-5.4,5.4-5.4,14.2,0,19.6l131.5,130L68.4,387.1 c-2.6,2.6-4.1,6.1-4.1,9.8c0,3.7,1.4,7.2,4.1,9.8l37.4,37.6c2.7,2.7,6.2,4.1,9.8,4.1c3.5,0,7.1-1.3,9.8-4.1L256,313.1l130.7,131.1 c2.7,2.7,6.2,4.1,9.8,4.1c3.5,0,7.1-1.3,9.8-4.1l37.4-37.6c2.6-2.6,4.1-6.1,4.1-9.8C447.7,393.2,446.2,389.7,443.6,387.1z'/%3E %3C/svg%3E\"), pointer;\r\n    */\r\n  }\r\n</style>","<script>\r\n  import Canvas from \"~/modules/spritesheet_editor/Canvas.svelte\";\r\n  export let zoom;\r\n</script>\r\n\r\n<Canvas {zoom} />","<script>\r\n  import Artboard, { centerScrollAndCanvas } from '~/_components/Artboard.svelte';\r\n  import SpritesheetToolbar from '~/_components/graphics/SpritesheetToolbar.svelte';\r\n  import SpritesheetLayers from '~/_components/graphics/SpritesheetLayers.svelte';\r\n  import PaletteLayers from '~/_components/graphics/PaletteLayers.svelte';\r\n  import SpritesheetOptions from '~/_components/graphics/SpritesheetOptions.svelte';\r\n  import SpritesheetEditor from '~/modules/spritesheet_editor/SpritesheetEditor.svelte';\r\n  \r\n  // this should be refactored to be an action \r\n  let zoom = 4;\r\n  const changeZoomLevel = (e) => {\r\n    // TODO: find out the x,y of the cursor position and update the canvas origin\r\n    // so it zooms where the cursor is located. will perhaps give a nicer feel\r\n    // update zoom\r\n    zoom = Math.max(1, zoom + (zoom - e.detail.deltaY > 0 ? 1 : -1));\r\n  };\r\n</script>\r\n\r\n<section class=\"main-artboard\">\r\n  <!-- <ToolOptions>Placeholder</ToolOptions> -->\r\n  <div></div>\r\n  <div class=\"inner-artboard\">\r\n    <SpritesheetOptions on:centerArtboard={centerScrollAndCanvas} />\r\n    <Artboard on:artboardScrollEvent={changeZoomLevel}>\r\n      <SpritesheetEditor {zoom} />\r\n    </Artboard>\r\n  </div>\r\n</section>\r\n\r\n<section class=\"toolbar-layer\">\r\n  <SpritesheetToolbar />\r\n</section>\r\n\r\n<section class=\"spritesheets-layer\">\r\n  <SpritesheetLayers />\r\n</section>\r\n\r\n<section class=\"palettes-layer\">\r\n  <PaletteLayers showEditButtons={false} />\r\n</section>\r\n\r\n<style>\r\n  .main-artboard{\r\n    position: relative;\r\n    display: grid;\r\n    grid-template-rows: 40px auto !important;\r\n  }\r\n  .inner-artboard{\r\n    position: relative;\r\n    overflow: hidden;\r\n  }\r\n  .toolbar-layer{\r\n    background-color: rgba(0, 0, 0, .3);\r\n  }\r\n  .spritesheets-layer{\r\n    background-color: rgba(0, 0, 0, .2);\r\n  }\r\n  .palettes-layer{\r\n    background-color: rgba(0, 0, 0, .3);\r\n  }\r\n  section{\r\n    overflow: hidden;\r\n  }\r\n</style>","<script>\r\n  export let label = undefined;\r\n</script>\r\n\r\n<div class=\"labeled\">\r\n  {#if label}\r\n    <div class=\"label\">{label}</div>\r\n  {/if}\r\n  <slot></slot>\r\n</div>\r\n\r\n\r\n<style>\r\n  .labeled{\r\n    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.13);\r\n  }\r\n  div{\r\n    position: relative;\r\n    padding: 3px;\r\n    border: 1px dashed rgb(44, 96, 252);\r\n    border-radius: 4px;\r\n    line-height: 0;\r\n    background-color: rgba(0, 0, 0, .2);\r\n  }\r\n  div.label{\r\n    position: absolute;\r\n    top: 0;\r\n    left: -1px;\r\n    background: rgb(44, 96, 252);\r\n    transform: translate(0, -100%);\r\n    padding: 12px 8px;\r\n    border-radius: 2px 2px 0 0;\r\n    color: white;\r\n    /* cursor: url('data:image/svg+xml,%3Csvg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" width=\"13\" height=\"13\" viewBox=\"0 0 13 13\"%3E,path d=\"M11.75 3.092v8.538c0 .383.688.391.688 0v-7.17c0-1.357 2.395-1.399 2.395 0v8.125c0 .5.491.573.676.197.176-.361.908-1.974.917-1.991.735-1.541 3.193-.605 2.429 1.209-.19.492-2.544 5.832-3.144 7.179-.629 1.411-1.857 2.821-4.126 2.821h-3.94c-2.388 0-3.645-1.417-3.645-3.895v-10.812c0-1.434 1.976-1.362 1.976-.066v4.741c0 .391.715.389.715 0v-7.618c0-1.475 2.208-1.435 2.208 0v7.192c0 .397.664.378.664-.008v-8.442c0-1.435 2.187-1.477 2.187 0zm-1.081-3.092c-1.055 0-1.972.499-2.53 1.277-1.833-.2-3.391 1.146-3.446 2.972-1.554.143-2.693 1.403-2.693 3.044v10.812c0 3.636 2.163 5.895 5.645 5.895h3.94c2.686 0 4.8-1.423 5.953-4.006.437-.981 2.873-6.496 3.17-7.24.464-1.119.373-2.297-.25-3.236-.761-1.146-2.233-1.75-3.624-1.41v-3.649c0-1.914-1.646-3.203-3.53-3.017-.532-.879-1.492-1.442-2.635-1.442z\"/%3E,/svg%3E'), pointer; */\r\n    /* cursor: url(\"data:image/svg+xml,%3Csvg  id='Layer_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='32px' height='32px' viewBox='0 0 32 32' style='enable-background:new 0 0 32 32;' xml:space='preserve'%3E %3Cpath d='M443.6,387.1L312.4,255.4l131.5-130c5.4-5.4,5.4-14.2,0-19.6l-37.4-37.6c-2.6-2.6-6.1-4-9.8-4c-3.7,0-7.2,1.5-9.8,4 L256,197.8L124.9,68.3c-2.6-2.6-6.1-4-9.8-4c-3.7,0-7.2,1.5-9.8,4L68,105.9c-5.4,5.4-5.4,14.2,0,19.6l131.5,130L68.4,387.1 c-2.6,2.6-4.1,6.1-4.1,9.8c0,3.7,1.4,7.2,4.1,9.8l37.4,37.6c2.7,2.7,6.2,4.1,9.8,4.1c3.5,0,7.1-1.3,9.8-4.1L256,313.1l130.7,131.1 c2.7,2.7,6.2,4.1,9.8,4.1c3.5,0,7.1-1.3,9.8-4.1l37.4-37.6c2.6-2.6,4.1-6.1,4.1-9.8C447.7,393.2,446.2,389.7,443.6,387.1z'/%3E %3C/svg%3E\"), pointer; */\r\n  }\r\n</style>","<script>\r\n  import ActionsManager from '~/application/ActionsManager.js';\r\n  \r\n  import SelectButton from '~/_components/SelectButton.svelte';\r\n  import Button from '~/_singles/buttons/Button.svelte';\r\n  import ArtboardOptions from '~/_components/ArtboardOptions.svelte';\r\n</script>\r\n\r\n<ArtboardOptions on:centerArtboard>\r\n  <SelectButton>\r\n    <slot slot=\"icon\">\r\n      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"13\" height=\"13\" viewBox=\"0 0 24 24\"><path d=\"M24 13.616v-3.232c-1.651-.587-2.694-.752-3.219-2.019v-.001c-.527-1.271.1-2.134.847-3.707l-2.285-2.285c-1.561.742-2.433 1.375-3.707.847h-.001c-1.269-.526-1.435-1.576-2.019-3.219h-3.232c-.582 1.635-.749 2.692-2.019 3.219h-.001c-1.271.528-2.132-.098-3.707-.847l-2.285 2.285c.745 1.568 1.375 2.434.847 3.707-.527 1.271-1.584 1.438-3.219 2.02v3.232c1.632.58 2.692.749 3.219 2.019.53 1.282-.114 2.166-.847 3.707l2.285 2.286c1.562-.743 2.434-1.375 3.707-.847h.001c1.27.526 1.436 1.579 2.019 3.219h3.232c.582-1.636.75-2.69 2.027-3.222h.001c1.262-.524 2.12.101 3.698.851l2.285-2.286c-.744-1.563-1.375-2.433-.848-3.706.527-1.271 1.588-1.44 3.221-2.021zm-12 2.384c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z\"/></svg>\r\n    </slot>\r\n    <slot slot=\"list\">\r\n      <div>\r\n        <Button on:click={_ => ActionsManager.execute('palette_import')}>Import palette</Button>\r\n        <Button on:click={_ => ActionsManager.execute('palette_export')}>Export palette</Button>\r\n      </div>\r\n      <div>\r\n        <Button variant=\"danger\" on:click={_ => ActionsManager.execute('palette_clear')}>Clear all</Button>\r\n      </div>\r\n    </slot>\r\n  </SelectButton>\r\n</ArtboardOptions>","<script>\r\n  import Color from '~/_singles/Color.svelte';\r\n  import { NESPalette } from '~/application/project';\r\n  const click = (e) => {\r\n    console.log(e)\r\n  };\r\n</script>\r\n\r\n<ul>\r\n  {#each NESPalette as color}\r\n    <li><Color on:click={click} rgb={color.rgb} hex={color.hex} type=\"replace\" /></li>\r\n  {/each}\r\n</ul>","<script>\r\n  // components\r\n  import Color from '~/_singles/Color.svelte';\r\n  import Artboard, { centerScrollAndCanvas } from '~/_components/Artboard.svelte';\r\n  import Labeled from '~/components/general/labeledartboarditem.svelte';\r\n  import PaletteLayers from '~/_components/graphics/PaletteLayers.svelte';\r\n  \r\n  import PaletteOptions from '~/_components/graphics/PaletteOptions.svelte';\r\n\r\n  import { Palettes } from '~/stores/palettes.store.js';\r\n  const { activeLayer, layers } = Palettes.stores;\r\n\r\n  // actions\r\n  import { drop } from '~/actions/dragdrop';\r\n  import SwatchList from '~/_components/graphics/SwatchList.svelte';\r\n\r\n  let over;\r\n  const colorDirective = {\r\n    over: _ => over = true,\r\n    leave: _ => over = false,\r\n    drop: ({ e, value }) => {\r\n      over = false;\r\n      const swap = e.dataTransfer.getData('swap');\r\n      if(swap){\r\n        layers.swapColors({ ...JSON.parse(swap), to: {...value} });\r\n      }\r\n\r\n      // handle replacement\r\n      const replace = e.dataTransfer.getData('replace');\r\n      if(replace){\r\n        layers.replaceColor({ ...JSON.parse(replace), ...value });\r\n      }\r\n    }\r\n  };\r\n</script>\r\n        \r\n<section class=\"main-artboard\">\r\n  <!-- <ToolOptions>Placeholder</ToolOptions> -->\r\n  <div></div>\r\n  <div class=\"inner-artboard\">\r\n    <PaletteOptions on:centerArtboard={centerScrollAndCanvas} />\r\n    <Artboard>\r\n      {#if $activeLayer}\r\n        {#key $activeLayer}\r\n          <Labeled label={$activeLayer.label}>\r\n            <ul class=\"active-color-group\">\r\n              {#each $activeLayer.colors as color, colorIndex}\r\n                <li use:drop={{ ...colorDirective, value: { layerIndex: Palettes.layerIndexFromSource($activeLayer), colorIndex} }}>\r\n                  <Color hex={color.hex} rgb={color.rgb} layerIndex={Palettes.layerIndexFromSource($activeLayer)} {colorIndex}  type=\"swap\" />\r\n                </li>\r\n              {/each}\r\n            </ul>\r\n          </Labeled>\r\n        {/key}\r\n      {:else}\r\n        No layer selected\r\n      {/if}\r\n    </Artboard>\r\n  </div>\r\n</section>\r\n\r\n<section class=\"swatchlist\">\r\n  <SwatchList />\r\n</section>\r\n\r\n<section class=\"palettes-layers\">\r\n  <PaletteLayers showEditButtons />\r\n</section>\r\n\r\n<style>\r\n  .main-artboard{\r\n    position: relative;\r\n    display: grid;\r\n    grid-template-rows: 40px auto !important;\r\n  }\r\n  .inner-artboard{\r\n    position: relative;\r\n    overflow: hidden;\r\n  }\r\n  \r\n  section{\r\n    overflow: hidden;\r\n  }\r\n  \r\n  .swatchlist{\r\n    overflow-y: auto;\r\n    height: 100%;\r\n    background-color: rgba(0, 0, 0, .3);\r\n  }\r\n  .palettes-layers{\r\n    position: relative;\r\n    background-color: rgba(0, 0, 0, .2);\r\n  }\r\n  .swatchlist :global(ul){\r\n    display: grid;\r\n    grid-template-columns: repeat(3, auto);\r\n    grid-gap: 2rem;\r\n  }\r\n  .swatchlist :global(li){\r\n    height: 40px;\r\n  }\r\n\r\n  .active-color-group{\r\n    display: grid;\r\n    gap: 2px;\r\n    grid-template-columns: repeat(4, 1fr);\r\n    background-color: rgba(0, 0, 0, 0.741);\r\n  }\r\n\r\n  .active-color-group li{\r\n    width: 90px; \r\n    height: 90px;\r\n  }\r\n</style>","import { navigate, decorator } from 'svelte-standalone-router';\r\nimport KeyboardManager from '~/keyboard_shortcuts/manager';\r\n\r\n// decorator\r\nimport _Spritesheets from '~/_decorators/_Spritesheets.svelte';\r\nimport _Palettes from '~/_decorators/_Palettes.svelte';\r\n\r\n// pages\r\nimport Spritesheets from '~/_views/graphics/Spritesheets.svelte';\r\nimport Palettes from '~/_views/graphics/Palettes.svelte';\r\n\r\n// sections \r\nconst spritesheets = decorator(_Spritesheets);\r\nspritesheets('/graphics', _ => navigate('/graphics/spritesheets'))\r\n  // catch all /gfx/:section subroutes\r\nspritesheets('/graphics/spritesheets', (req, res) => {\r\n  // send the component to the view\r\n  try{\r\n    // enable the right shortcuts group for this page\r\n    KeyboardManager.enableGroups('*', 'spritesheets');\r\n    res.send(Spritesheets);\r\n  }catch(error){\r\n    res.error();\r\n  }\r\n});\r\n\r\n// palettes section\r\nconst palettes = decorator(_Palettes);\r\n  // catch all /gfx/:section subroutes\r\npalettes('/graphics/palettes', (req, res) => {\r\n  // send the component to the view\r\n  try{\r\n    // enable the right shortcuts group for this page\r\n    KeyboardManager.enableGroups('*', 'palettes');\r\n    res.send(Palettes);\r\n  }catch(error){\r\n    res.error();\r\n  }\r\n});","import { context } from '~/router/router';\r\n\r\n// home\r\ncontext.get('/', (req, res) => {\r\n  console.log('home')\r\n});","import manager from './manager';\r\nimport ActionsManager from \"~/application/ActionsManager\";\r\n\r\n// global commands\r\n// toggle fullscreen on f11 and altleft + enter combo. \r\nmanager.set(['f11'], { data: { action: ActionsManager.action('window_toggle_fullscreen') } });\r\nmanager.set(['altleft', 'enter'], { data: { action: ActionsManager.action('window_toggle_fullscreen') } });","import manager, { executeCommand } from './manager';\r\nimport ActionsManager from \"~/application/ActionsManager\";\r\n\r\nconst groups = ['palettes'];\r\n// global commands\r\n// toggle fullscreen on f11 and altleft + enter combo. \r\nmanager.set(['insert'], { data: { action: ActionsManager.action('palette_create') }, groups });\r\nmanager.set(['ControlLeft', 'KeyD'], { data: { action: ActionsManager.action('palette_clone_active_layer') }, groups });\r\n\r\n// update active layers name\r\nmanager.set(['f2'], { data: { action: ActionsManager.action('palette_focus_rename_active_layer') }, groups });\r\n\r\n// special cases since in elctron if a dialog is spawned the keyup event never triggers. so for some events it has to \r\n// be handled manually where the dialog modal gets focus on the screen\r\nconst _import = manager.set(['ControlLeft','KeyI'], { data: { action: ActionsManager.action('palette_import') }, groups });\r\n_import.on((args) => executeCommand(args));\r\nconst _export = manager.set(['ControlLeft', 'KeyE'], { data: { action: ActionsManager.action('palette_export') }, groups });\r\n_export.on((args) => executeCommand(args));\r\n\r\n","import manager, { executeCommand } from './manager';\r\nimport ActionsManager from \"~/application/ActionsManager\";\r\nimport { ToolTypes } from '~/modules/spritesheet_editor/tools';\r\n\r\n// register to groups\r\nconst groups = ['spritesheets'];\r\n\r\n// global commands\r\n// toggle fullscreen on f11 and altleft + enter combo. \r\nmanager.set(['insert'], { data: { action: ActionsManager.action('spritesheet_create')}, groups });\r\nmanager.set(['ControlLeft', 'KeyD'], { data: { action: ActionsManager.action('spritesheet_clone_active_layer') }, groups });\r\n\r\n// update active layers name\r\nmanager.set(['f2'], { data: { action: ActionsManager.action('spritesheet_focus_rename_active_layer')}, groups });\r\n\r\n// special cases since in elctron if a dialog is spawned the keyup event never triggers. so for some events it has to \r\n// be handled manually where the dialog modal gets focus on the screen\r\nconst _import = manager.set(['ControlLeft','KeyI'], { data: {action: ActionsManager.action('spritesheet_import')}, groups });\r\n_import.on((args) => executeCommand(args));\r\nconst _export = manager.set(['ControlLeft', 'KeyE'], { data: {action: ActionsManager.action('spritesheet_export')}, groups });\r\n_export.on((args) => executeCommand(args));\r\n\r\n// set active color\r\nmanager.set(['Digit1'], { data: {action: ActionsManager.action('palette_active_color'), props: 0}, groups });\r\nmanager.set(['Digit2'], { data: {action: ActionsManager.action('palette_active_color'), props: 1}, groups });\r\nmanager.set(['Digit3'], { data: {action: ActionsManager.action('palette_active_color'), props: 2}, groups });\r\nmanager.set(['Digit4'], { data: {action: ActionsManager.action('palette_active_color'), props: 3}, groups });\r\n\r\n// zoom\r\nmanager.set(['NumpadAdd'], { data: {action: ActionsManager.action('spritesheet_zoom_in')}, groups });\r\nmanager.set(['NumpadSubtract'], { data: {action: ActionsManager.action('spritesheet_zoom_out')}, groups });\r\nmanager.set(['Numpad0'], { data: {action: ActionsManager.action('spritesheet_zoom_reset')}, groups });\r\n\r\n// toolbar\r\nmanager.set(['KeyV'], { data: {action: ActionsManager.action('spritesheet_set_active_tool'), props: ToolTypes.get('pointer')}, groups });\r\nmanager.set(['KeyB'], { data: {action: ActionsManager.action('spritesheet_set_active_tool'), props: ToolTypes.get('pen')}, groups });\r\nmanager.set(['KeyG'], { data: {action: ActionsManager.action('spritesheet_set_active_tool'), props: ToolTypes.get('paintbucket')}, groups });\r\nmanager.set(['KeyM'], { data: {action: ActionsManager.action('spritesheet_set_active_tool'), props: ToolTypes.get('marquee')}, groups });\r\nmanager.set(['KeyC'], { data: {action: ActionsManager.action('spritesheet_set_active_tool'), props: ToolTypes.get('preview')}, groups });\r\nmanager.set(['KeyE'], { data: {action: ActionsManager.action('spritesheet_set_active_tool'), props: ToolTypes.get('eyedropper')}, groups });\r\n\r\n\r\n","<script>\n  import ActionsManager from '~/application/ActionsManager.js';\n  const { href } = $$props;\n</script>\n{#if !globalThis.electron}\n  <button {...$$props} on:click={_ => window.open(href)}><slot /></button>\n{:else}\n  <button {...$$props} on:click|preventDefault={_ => ActionsManager.execute('external_link', href)}><slot /></button>\n{/if}","<script>\n  import { onDestroy, onMount } from 'svelte';\n  import { link } from 'svelte-standalone-router';\n\n  import ActionsManager from '~/application/ActionsManager.js';\n  \n  import External from '~/components/external.svelte';\n\n  // Could we clean this up a bit? or simply just not bother?\n  let isActive = false;\n  let topLevelElements = [];\n  const clearActive = (e) => {\n    topLevelElements.forEach(_ => _.classList.remove('show'));\n    isActive = false;\n  }\n  window.addEventListener('click', clearActive);\n\n  // toplevel handlers\n  const toplevelClickHandler = e => {\n    e.stopPropagation();\n    // NOTE: this will toggle active menu and close menu if a sublink is clicked as well\n    isActive = !isActive;\n    e.currentTarget.classList.toggle('show');\n  };\n  const toplevelOverHandler = e => {\n    topLevelElements.forEach(_ => _.classList.remove('show'));\n    if(isActive){\n      e.currentTarget.classList.add('show');\n    }\n  };\n\n  onMount(() => {\n    // top level menu\n    topLevelElements = document.querySelectorAll('nav > ul > li');\n    topLevelElements.forEach(li => li.addEventListener('click', toplevelClickHandler));\n    topLevelElements.forEach(li => li.addEventListener('mouseover', toplevelOverHandler));\n  });\n\n  onDestroy(() => {\n    // clear active \n    window.removeEventListener('click', clearActive);\n    // clear toplevel\n    topLevelElements.forEach(li => li.removeEventListener('click', toplevelClickHandler));\n    topLevelElements.forEach(li => li.removeEventListener('mouseover', toplevelOverHandler));\n  });\n</script>\n\n<nav id=\"main-nav\" class=\"no-drag\">\n  <ul id=\"filemenu\">\n    <li class:show={false}>\n      <span>file</span>\n      <ul>\n        <li><button href=\"/\" on:click|preventDefault={_ => ActionsManager.execute('create_blank_project')}><span>new project</span></button></li>\n        <li><button href=\"/\" on:click|preventDefault={_ => ActionsManager.execute('open_project')}><span>open</span></button></li>\n        <li><button href=\"/\" on:click|preventDefault={_ => ActionsManager.execute('save_project')}><span>save</span></button></li>\n        <li><button href=\"/\" on:click|preventDefault={_ => ActionsManager.execute('save_dialog_project')}><span>save as</span></button></li>\n        {#if globalThis.electron}\n          <li><button href=\"/\" on:click={_ => ActionsManager.execute(`window_close`)}><span>quit</span></button></li>\n        {/if}\n      </ul>\n    </li>\n    <li>\n      <span>edit</span>\n    </li>\n    <li>\n      <span>build</span>\n    </li>\n    <li>\n      <span>window</span>\n      <ul>\n        <li><button href=\"/\" on:click|preventDefault={_ => ActionsManager.execute('window_toggle_fullscreen')}><span>toggle fullscreen</span></button></li>\n      </ul>\n    </li>\n    <li>\n      <span>help</span>\n      <ul>\n        <li>\n          <External href=\"https://github.com/hjalmar/nesbit-studio\">Visit github page</External>\n        </li>\n        <li>\n          <External href=\"https://discord.gg/WM8ZEnwbSd\">Join discord community</External>\n        </li>\n      </ul>\n    </li>\n  </ul>\n</nav>\n\n<style>\n  .show{\n    color: white;\n    background-color: rgba(255, 255, 255, 0.035);\n    box-shadow: inset 0 0 3px rgba(0, 0, 0, 0.15);\n    border-left: 1px solid rgba(255, 255, 255, 0.385);  \n    border-right: 1px solid rgba(255, 255, 255, .385);  \n  }\n  #filemenu{\n    text-transform: capitalize;\n    color: white;\n    font-size: 11rem;\n    font-weight: normal;\n    color: rgba(255, 255, 255, .6);\n  }\n  \n  #filemenu li > ul{\n    box-shadow: 10px 10px 60px rgba(0, 0, 0, 1);\n    background: rgb(31, 21, 30);\n  }\n  #filemenu > li{\n    border-left: 1px solid rgba(255, 255, 255, 0);  \n    border-right: 1px solid rgba(255, 255, 255, 0);  \n  }\n  #filemenu li :global(button){\n    display: flex;\n    align-items: center;\n    align-content: center;\n    justify-content: space-between;\n    padding: 15px 20px;\n    border: none;\n    border-top: 1px solid rgba(255, 255, 255, 0);\n    width: 100%;\n    background: transparent;\n    transition: padding .3s, color .3s, box-shadow .5s;\n    color: rgba(255, 255, 255, .6);\n    text-decoration: none;\n    cursor: pointer;\n  }\n  #filemenu li :global(button > *::first-letter){\n    text-transform: uppercase;\n  }\n  \n  #filemenu li :global(button:hover){\n    border-top: 1px solid rgba(255, 255, 255, 0.055);\n    color: var(--active-color);\n    padding-left: 25px;\n    background: rgba(60, 43, 66, .41);\n    box-shadow: inset 0 0 16px rgba(0, 0, 0, 0.15);\n  }\n</style>","<script>\r\n  import { navigate, location } from 'svelte-standalone-router';\r\n  \r\n  export let area = null;\r\n  let _self;\r\n\r\n  // update active state\r\n  $: active = $location.startsWith(`/${area}`);\r\n  const click = _ => {\r\n    if(area){\r\n      navigate('/' + area);\r\n    }\r\n  };\r\n</script>\r\n\r\n<button class=\"no-drag\" bind:this={_self} on:click={ click } class:active><slot></slot></button>\r\n\r\n<style>\r\n  button{\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    margin-right: 1px;\r\n    width: 26px;\r\n    padding: 5px;\r\n    height: 100%;\r\n    border: none;\r\n    border-top: 1px solid rgba(255, 83, 241, 0);\r\n    background-color: rgba(255, 255, 255, .8);\r\n    box-shadow: inset 0 0px 14px rgba(0, 0, 0, .41), 0 2px 10px rgba(0, 0, 0, 0.5);\r\n    border-radius: 4px;\r\n    background-position: center;\r\n    background-repeat: no-repeat;\r\n    background-size: 55%;\r\n    opacity: 1;\r\n    cursor: pointer;\r\n  }\r\n\r\n  button:hover{\r\n    opacity: 1;\r\n    border-top: 1px solid rgba(255, 83, 241, 0.95);\r\n    background-color: rgba(197, 36, 149, 0.8);\r\n    box-shadow: inset 0 0px 2px rgba(0, 0, 0, .41), 0 2px 10px rgba(0, 0, 0, 0.5);\r\n  }\r\n  /* yea, what can you do with sottet content??? */\r\n  button:hover :global(svg){\r\n    fill: white !important;\r\n  }\r\n  button.active :global(svg){\r\n    fill: white !important;\r\n  }\r\n  button.active{\r\n    border-top: 1px solid rgba(83, 147, 255, 0.95);\r\n    background-color: rgb(44, 96, 252);\r\n    box-shadow: inset 0 0px 2px rgba(0, 0, 0, .41), 0 2px 10px rgba(0, 0, 0, 0.5);\r\n  }\r\n</style>","<script>\r\n  import AreaButton from '~/_singles/buttons/AreaButton.svelte';\r\n  import ActionsManager from '~/application/ActionsManager.js';  \r\n</script>\r\n\r\n<ul class=\"area\">\r\n  <li>\r\n    <AreaButton area=\"game\">\r\n      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path d=\"M6 2l1.171.203c-.355 2.245.791 2.519 2.699 2.874 1.468.273 3.13.622 3.13 3.284v.639h-1.183v-.639c0-1.556-.48-1.809-2.164-2.122-2.583-.48-4.096-1.391-3.653-4.239zm18 14c0 3.312-2.607 6-5.825 6-1.511 0-2.886-.595-3.921-1.565-1.311-1.229-3.278-1.132-4.55.038-1.03.948-2.389 1.527-3.879 1.527-3.217 0-5.825-2.688-5.825-6s2.608-6 5.825-6l12.563.007c3.118.116 5.612 2.755 5.612 5.993zm-15-1h-2v-2h-2v2h-2v2h2v2h2v-2h2v-2zm4 1h-2v1h2v-1zm4-2c0 .552.447 1 1 1s1-.448 1-1-.447-1-1-1-1 .448-1 1zm0 2c0-.552-.447-1-1-1s-1 .448-1 1 .447 1 1 1 1-.448 1-1zm2 2c0-.552-.447-1-1-1s-1 .448-1 1 .447 1 1 1 1-.448 1-1zm2-2c0-.552-.447-1-1-1s-1 .448-1 1 .447 1 1 1 1-.448 1-1z\"/></svg>\r\n    </AreaButton>\r\n  </li>\r\n  <li>\r\n    <AreaButton area=\"graphics\">\r\n      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path d=\"M0 21.398c5.504.456 3.533-5.392 8.626-5.445l2.206 1.841c.549 6.645-7.579 8.127-10.832 3.604zm16.878-8.538c1.713-2.687 7.016-11.698 7.016-11.698.423-.747-.515-1.528-1.17-.976 0 0-7.887 6.857-10.213 9.03-1.838 1.719-1.846 2.504-2.441 5.336l2.016 1.681c2.67-1.098 3.439-1.248 4.792-3.373z\"/></svg>\r\n    </AreaButton>\r\n  </li>\r\n  <li>\r\n    <AreaButton area=\"audio\">\r\n      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path d=\"M13 0h-2v15.676c-3.379-.667-7 1.915-7 4.731 0 2.367 1.881 3.593 3.919 3.593 2.423 0 5.077-1.728 5.081-5.24v-12.76c3.009 2.223 5.623 3.243 5.059 7 1.431-1.727 1.941-2.817 1.941-4.051 0-4.446-7-5.915-7-8.949z\"/></svg>\r\n    </AreaButton>\r\n  </li>\r\n  <li>\r\n    <AreaButton area=\"code\">\r\n      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path d=\"M23 10.826v2.349c-1.562 0-3 1.312-3 2.857 0 2.181 1.281 5.968-6 5.968v-2.002c4.917 0 3.966-1.6 3.966-3.967 0-2.094 1.211-3.5 2.278-4.031-1.067-.531-2.278-1.438-2.278-3.312 0-2.372.94-4.692-3.966-4.686v-2.002c7.285 0 6 4.506 6 6.688 0 1.544 1.438 2.138 3 2.138zm-19-2.138c0-2.182-1.285-6.688 6-6.688v2.002c-4.906-.007-3.966 2.313-3.966 4.686 0 1.875-1.211 2.781-2.278 3.312 1.067.531 2.278 1.938 2.278 4.031 0 2.367-.951 3.967 3.966 3.967v2.002c-7.281 0-6-3.787-6-5.969 0-1.545-1.438-2.857-3-2.857v-2.349c1.562.001 3-.593 3-2.137z\"/></svg>\r\n    </AreaButton>\r\n  </li>\r\n  {#if globalThis.electron}\r\n    <li on:click={_ => ActionsManager.execute('buildandrun_project')} class=\"last\">\r\n      <AreaButton>\r\n        <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"evenodd\" clip-rule=\"evenodd\"><path d=\"M24 19h-1v-2.2c-1.853 4.237-6.083 7.2-11 7.2-6.623 0-12-5.377-12-12h1c0 6.071 4.929 11 11 11 4.66 0 8.647-2.904 10.249-7h-2.249v-1h4v4zm-11.036 0h-1.886c-.34-.957-.437-1.571-1.177-1.878h-.001c-.743-.308-1.251.061-2.162.494l-1.333-1.333c.427-.899.804-1.415.494-2.163-.308-.74-.926-.839-1.878-1.177v-1.886c.954-.339 1.57-.437 1.878-1.178.308-.743-.06-1.248-.494-2.162l1.333-1.333c.918.436 1.421.801 2.162.494l.001-.001c.74-.307.838-.924 1.177-1.877h1.886c.34.958.437 1.57 1.177 1.877l.001.001c.743.308 1.252-.062 2.162-.494l1.333 1.333c-.435.917-.801 1.421-.494 2.161v.001c.307.739.915.835 1.878 1.178v1.886c-.953.338-1.571.437-1.878 1.178-.308.743.06 1.249.494 2.162l-1.333 1.333c-.92-.438-1.42-.802-2.157-.496-.746.31-.844.926-1.183 1.88zm-.943-4.667c-1.289 0-2.333-1.044-2.333-2.333 0-1.289 1.044-2.334 2.333-2.334 1.289 0 2.333 1.045 2.333 2.334 0 1.289-1.044 2.333-2.333 2.333zm-8.021-5.333h-4v-4h1v2.2c1.853-4.237 6.083-7.2 11-7.2 6.623 0 12 5.377 12 12h-1c0-6.071-4.929-11-11-11-4.66 0-8.647 2.904-10.249 7h2.249v1z\"/></svg>\r\n      </AreaButton>\r\n    </li>\r\n  {/if}\r\n</ul>\r\n\r\n<style>\r\n  .area{\r\n    display: flex;\r\n    margin-left: 7px;\r\n    padding-top: 4px;\r\n    height: 35px;\r\n  }\r\n  .area svg{\r\n    display: flex;\r\n    object-fit: contain;\r\n    pointer-events: none;\r\n    /* need to force height here else it wont be centered */\r\n    height: 20px;\r\n    fill: rgb(54, 54, 54);\r\n  }\r\n  li{\r\n    margin-right: 2px;\r\n  }\r\n  .last{\r\n    margin-left: 60px;\r\n  }\r\n</style>","<script>\n  import ActionsManager from '~/application/ActionsManager.js';\n  const windowCommand = (command) => ActionsManager.execute(`window_${command}`);\n</script>\n\n<button class=\"minimize\" on:click={_ => windowCommand('minimize')}></button>\n<button class=\"maximize\" on:click={_ => windowCommand('maximize')}></button>\n<button class=\"close\" on:click={_ => windowCommand('close')}></button>\n\n<style>  \n  button{\n    display: block;\n    width: 12px;\n    height: 12px;\n    border-radius: 50%;\n    cursor: pointer;\n    border: none;\n    /* transition: box-shadow .3s; */\n  }\n\n  .minimize{\n    background-color: rgb(21, 197, 159);\n  }\n  .maximize{\n    background-color: rgb(212, 192, 13);\n  }\n  .close{\n    background-color: hsl(345, 81%, 43%);\n  }\n</style>","<script>\r\n  import Filemenu from '~/_components/header/Navigation.svelte';\r\n  import SectionNavigation from '~/_components/header/SectionNavigation.svelte';\r\n  import WindowButtons from '~/_components/header/WindowButtons.svelte';\r\n  import { projectStore } from '~/application/project';\r\n</script>\r\n\r\n<header id=\"masthead\">\r\n  <div class=\"drag app-region\"></div>\r\n  <div class=\"inner\">\r\n    <div class=\"titlebar\">\r\n      [<span class=\"no-paint\">{$projectStore.name}</span>]{$projectStore.saved ? '' : '*'} \r\n    </div>\r\n    <div id=\"top-navigation\">\r\n      <Filemenu />\r\n      <SectionNavigation />\r\n    </div>\r\n    <!-- {#if globalThis.electron}\r\n    {/if} -->\r\n    <div id=\"window-buttons\">\r\n      <WindowButtons />\r\n    </div>\r\n  </div>\r\n</header>\r\n\r\n<style>\r\n  .inner{\r\n    display: flex;\r\n    justify-content: space-between;\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    padding: 0 13px;\r\n    width: 100%;\r\n    height: 100%;\r\n    z-index: 200;\r\n    -webkit-user-drag: none;\r\n  }\r\n  .drag{\r\n    position: absolute;\r\n    top: 5px;\r\n    left: 5px;\r\n    width: calc(100% - 95px);\r\n    height: calc(100% - 5px);\r\n  }\r\n  #masthead{\r\n    position: relative;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    z-index: 1564;\r\n    padding: 0 25px;\r\n    background: linear-gradient(0deg, rgba(69, 28, 78, 1) 30%, rgb(34, 18, 26));\r\n    height: 100%;\r\n    box-shadow: 0 3px 20px rgba(0, 0, 0, 1);\r\n    border-bottom: 1px solid rgba(89, 53, 98, .81);\r\n    line-height: 44px;\r\n    text-align: center;\r\n  }\r\n\r\n  #masthead::before{\r\n    content: '';\r\n    position: absolute;\r\n    top: 2px;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 5px;\r\n    background: rgba(234, 187, 250, 0.25);\r\n    filter: blur(3px);\r\n    pointer-events: none;\r\n  }\r\n\r\n  #masthead::after{\r\n    content: '';\r\n    position: absolute;\r\n    top: 5px;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 1px;\r\n    background: rgba(215, 130, 255, 0.25);\r\n    filter: blur(1px);\r\n    pointer-events: none;\r\n  }\r\n  \r\n  .titlebar{\r\n    position: absolute !important;\r\n    pointer-events: none;\r\n    z-index: 10;\r\n    top: 0;\r\n    left: 50%;\r\n    font-style: normal;\r\n    color: rgba(255, 255, 255, .6);\r\n  }\r\n\r\n  .titlebar > span{\r\n    font-style: italic;\r\n    color: rgba(255, 255, 255, 0.95);\r\n  }\r\n\r\n  #top-navigation{\r\n    display: flex;\r\n    height: 100%;\r\n  }\r\n  #window-buttons{\r\n    display: grid;\r\n    align-items: center;\r\n    grid-template-columns: repeat(3, auto);\r\n    gap: 10px;\r\n  }\r\n</style>","<script>\r\n  import { onDestroy, tick } from 'svelte';\r\n  import { log } from '~/application/project';\r\n  let element;\r\n  let errors = [];\r\n  const unsubscribe = log.subscribe(async (store) => {\r\n    errors = [...store];\r\n    await tick();\r\n    if(element){\r\n      element.scrollTo({\r\n        top: 1000000000,\r\n        left: 0,\r\n        behavior: 'smooth'\r\n      });\r\n    }\r\n  });\r\n\r\n  onDestroy(() => {\r\n    unsubscribe();\r\n  });\r\n</script>\r\n\r\n<ul bind:this={element}>\r\n  {#each errors as { error, date }}\r\n    {#if error}\r\n      <li>\r\n        [{date}] ( {error.message} )\r\n        <div class=\"details\">\r\n          some extra hidden details\r\n        </div>\r\n      </li>  \r\n    {/if}\r\n  {/each}\r\n</ul>\r\n\r\n<style>\r\n  ul{\r\n    padding: 4rem 10rem;\r\n    width: 100%;\r\n    height: 100%;\r\n    color: var(--color);\r\n    overflow-y: auto;\r\n  }\r\n  li:last-child{\r\n    color: white;\r\n  }\r\n\r\n  .details{\r\n    display: none;\r\n  }\r\n</style>","<script>\n  import { onMount, tick } from 'svelte';\n  import { redirect, location } from 'svelte-standalone-router';\n\n  import { meta as _meta, projectStore } from '~/application/project';\n  import { application } from '~/nesbit.config';\n\n  import App from './App.svelte';  \n\n  // electron specific initializations\n  if(globalThis.electron){\n    // if we are in electron context add a class to the body element\n    // of electron to be able to distinguish between webapp and electron\n    document.body.classList.add('electron');  \n    // we only want to redirect on an electron application\n    // this only if you need to get the correct location of the startup page \n    // since the initial pathname is the filepath to the local file and not '/' as we expect.\n    redirect('/');\n  }\n\n  // force entry at startPage during development\n  onMount(async () => {\n    // wait tick just to be sure things have been properly executed\n    await tick();\n    if(application.startPage !== $location){\n      redirect(application.startPage);\n    }\n  });\n</script>\n\n<svelte:head>\n  <title>[{$projectStore.name}{$projectStore.save ? '' : '*'}]</title>\n  <!-- during development we want to inject liverealod. so we set this csp here so electron doesn't complain -->\n  <!-- could scripts from other source be executed before? maybe, probably, but whatever. Maybe should be removed all together since livereload is not bundled on build? -->\n  <meta http-equiv=\"Content-Security-Policy\" content=\"script-src 'self'\">\n</svelte:head>\n\n<App {...$$props} />","import '~/bootstrap';\nimport '~/application/actions.js';\nimport '~/router/router';\nimport './router/**/*.route.js';\nimport './keyboard_shortcuts/**/*.shortcut.js';\n\n// initialize svelte\nimport Init from './Init.svelte';\nimport AdBlock from './Adblock.svelte';\n\n// shift depending on if adblock or not\nlet component = window.not_adblocked ? Init : AdBlock;\nconst app = new component({\n  target: document.querySelector('body')\n});\n\nexport default app;"],"names":["noop","assign","tar","src","k","run","fn","blank_object","Object","create","run_all","fns","forEach","is_function","thing","safe_not_equal","a","b","subscribe","store","callbacks","unsub","unsubscribe","get_store_value","value","_","component_subscribe","component","callback","$$","on_destroy","push","create_slot","definition","ctx","$$scope","slot_ctx","get_slot_context","slice","update_slot","slot","slot_definition","dirty","get_slot_changes_fn","get_slot_context_fn","slot_changes","lets","undefined","merged","len","Math","max","length","i","get_slot_changes","slot_context","p","exclude_internal_props","props","result","compute_rest_props","keys","rest","Set","has","action_destroyer","action_result","destroy","append","target","node","appendChild","insert","anchor","insertBefore","detach","parentNode","removeChild","destroy_each","iterations","detaching","d","element","name","document","createElement","svg_element","createElementNS","text","data","createTextNode","space","empty","listen","event","handler","options","addEventListener","removeEventListener","prevent_default","preventDefault","call","this","attr","attribute","removeAttribute","getAttribute","setAttribute","set_attributes","attributes","descriptors","getOwnPropertyDescriptors","__proto__","key","style","cssText","set","set_data","wholeText","set_style","important","setProperty","toggle_class","toggle","classList","current_component","set_current_component","get_current_component","Error","onMount","on_mount","onDestroy","createEventDispatcher","type","detail","e","createEvent","initCustomEvent","custom_event","bubble","dirty_components","binding_callbacks","render_callbacks","flush_callbacks","resolved_promise","Promise","resolve","update_scheduled","schedule_update","then","flush","tick","add_render_callback","flushing","seen_callbacks","update","pop","add","clear","fragment","before_update","after_update","outroing","outros","group_outros","r","c","check_outros","transition_in","block","local","delete","transition_out","o","globals","window","globalThis","global","outro_and_destroy_block","lookup","update_keyed_each","old_blocks","get_key","dynamic","list","create_each_block","next","get_context","n","old_indexes","new_blocks","new_lookup","Map","deltas","child_ctx","get","abs","will_move","did_move","m","first","new_block","old_block","new_key","old_key","get_spread_update","levels","updates","to_null_out","accounted_for","get_spread_object","spread_props","create_component","mount_component","new_on_destroy","map","filter","destroy_component","init","instance","create_fragment","not_equal","parent_component","prop_values","bound","context","skip_bound","ready","ret","fill","make_dirty","hydrate","nodes","Array","from","childNodes","children","l","intro","SvelteComponent","[object Object]","$destroy","index","indexOf","splice","$$props","obj","$$set","subscriber_queue","writable","start","stop","subscribers","new_value","run_queue","s","invalidate","subscriber","rgbToHsl","h","g","min","nespalette","hex","rgb","sorted","sort","NESColor","freeze","mappedColorList","color","log","ErrorEvent","Date","date","String","getHours","padStart","getMinutes","getSeconds","projectStore","saved","save","location","console","Enum","Number","super","EnumerableList","EnumerableItem","actions","__actions","define","__binds","args","f","register","action","reject","error","message","autoBom","warn","test","Blob","XMLHttpRequest","open","responseType","onload","response","onerror","send","status","dispatchEvent","MouseEvent","initMouseEvent","self","navigator","userAgent","saveAs","HTMLAnchorElement","prototype","URL","webkitURL","j","download","rel","href","origin","createObjectURL","setTimeout","revokeObjectURL","msSaveOrOpenBlob","title","body","innerText","HTMLElement","safari","FileReader","onloadend","replace","readAsDataURL","module","filename","extension","getFullYear","getMonth","getDay","fileDialog","accept","readAs","isArray","input","ext","startsWith","join","file","files","reader","readAsBinaryString","readAsArrayBuffer","readAsText","encoding","click","saveDialog","blob","application","startPage","project","mimetype","version","palettes","export","spritesheets","settings","findPalette","JSON","parse","stringify","NESPalette","find","colorPlaceholder","id","ColorPaletteGroup","label","colors","uuid","addColor","item","palette","palettesStore","activeLayer","layers","selectedColor","storeFunctions","getActiveLayer","isInteger","paletteGroup","makeActive","layerIndexFromSource","source","getActiveColorIndex","arr","_store","heading","string","ref","layerIndex","ref2","to","colorIndex","layer","serialize","Config","serializedData","unserializedData","import","_writable","chunk","array","size","ceil","resIndex","getBinaryStringFromNumber","toString","substring","getColorDefinitionFromHighLow","low","high","findNESPalette","Palettes","stores","colorFromPalette","makeLayerActive","lastChanged","random","now","ColorPaletteGroupInstance","newLayer","active","cloneLayer","createLayer","shouldMakeActive","CanvasLayer","width","height","_isInitialized","getContext","drawFromSource","quality","fetch","toDataURL","res","x","y","rc","floor","tile","trow","tr","tcol","tc","translate","col","row","fillStyle","fillRect","restore","clearRect","Spritesheets","CanvasLayerInstance","_store_copy","spritesheet","filedata","chunks","array.chunk","Uint8Array","tiles","pixelRow","pixel","chr.parse","page","bytearray","buff","ArrayBuffer","output","bin","w","v","match","parseInt","chr.generateExport","image","toBlob","ToolTypes","Cursor","icon","offset","scale","Tool","visible_in_toolbar","pixelIndicator","singleAction","optionsPanelComponent","Layer","canvas","Type","primary","secondary","move","mouseup","grid","o1","o2","globalAlpha","ix","iy","cursor","overlays","SpritesheetEditor","eventHandler","mousedown","activePaletteLayer","animationLoop","fps","animation","paused","framecount","lastTime","performance","cancel","cancelAnimationFrame","pause","play","loop","time","requestAnimationFrame","delta","frame","AnimationLoop","render","bind","events","callActionType","mouseIsDown","callEvent","realMousePosition","evt","rect","getBoundingClientRect","scaleX","scaleY","clientX","left","clientY","top","getMousePos","mousemove","which","drawImage","mapped","pointer","enum","weight","pen","properties","drawStack","lastDraw","modifiedPixels","PenOptions","colorData","getActiveColorValue","shiftKey","drawLineFromPoint","paint","end","fillStack","dataRef","lastPixel","eyedropper","colorIndexAtPosition","paintbucket","diagonals","fillValue","pixelValue","pixels","_x","_y","shift","setColorIndexAtPosition","ctrlKey","fillAllPixelsOfSameColor","Toolbar","tools","activeTool","_enum","documentElement","setActive","execute","t","electron","ActionsManager","quit","minimize","maximize","toggleFullscreen","externalLink","async","canceled","filePath","openSaveDialog","filePaths","openFileDialog","path","readFileDataFromPath","fullscreenElement","exitFullscreen","requestFullscreen","importCHR","exportCHR","exportAsImage","dataset","theme","removeLayer","cloneActiveLayer","swapLayers","updateLayerLabel","setActiveColorIndex","level","view","zoom","spritesheetsStore","Route","base","route","middlewares","lazy","parameters","regexpRoute","parameter","colonParameter","identifier","param","boundValue","split","duplicates","old","prepare","Middleware","stack","Request","query","params","state","Response","SvelteStandaloneRouterError","SvelteRouter","__properties","initial","__subscribing","__get","__catch","__use","routes","fnName","_props","parentRoutes","_register","innerArgs","innerRoutes","innerFn","innerMiddlewares","_storeInList","url","RouteInstance","RegExp","reduce","urlParams","URLSearchParams","search","queryParameters","entries","__router_callback","errorsFound","_findRoute","matchFound","middleware","middlewareRoute","use","Router","__linkBase","__scrollReset","__scrollOffset","endsWith","linkBase","setLinkBase","scrollReset","setScrollReset","scrollOffset","setScrollOffset","getPathname","re","dispatch","CustomEvent","navigate","cleanURL","history","pushState","redirect","replaceState","internalGoTo","hash","querySelector","topPos","pageYOffset","scrollTo","prev","firstLoad","contexts","initialized","internalLinksHandler","tagName","isHashLink","pathname","popstateHandler","endEarly","sameURL","router","decorator","decoratorProps","RouterContext","clean","clickHandler","currentTarget","alter","SvelteStandaloneRouter","root","wrappedCall","decoratorPropsCallback","req","_url","hostname","app","mount","catch","GeneralError","Hotkey","groups","signature","__on","__off","on","off","manager","__options","once","__registeredGroups","__enabledGroups","__commands","__target","toLowerCase","localeCompare","command","commands","values","found","priority","KeyboardShortcut","some","includes","keySequence","group","_prepare","shortcut","Event","customExecuteEvent","code","prevCommand","keyDownHandler","currentCommand","_find","keyUpHandler","exist","executeCommand","scroll","wrapper","artboard","centerScrollAndCanvas","offsetWidth","offsetHeight","resizeObserver","ResizeObserver","entry","contentRect","calc","resizeHandler","startX","startY","scrollLeft","scrollTop","keyDowns","keyDown","keyUp","upHandler","moveHandler","walk","pageX","offsetLeft","walky","pageY","offsetTop","observe","disconnect","Space","stopImmediatePropagation","selected","toolsList","tool","variant","altKey","slim","char","lastIndexOf","iconIndicator","previous","contentEditable","focus","textContent","range","createRange","selection","getSelection","selectNodeContents","removeAllRanges","addRange","stopPropagation","blur","drag","draggable","dragStart","dataTransfer","setData","drop","pass","dragOver","showEditButtons","over","dropDirective","leave","flip","getData","$activeLayer","edit","colorDirective","swap","swapColors","replaceColor","contains","editor","defineCanvas","deltaY","KeyboardManager","enableGroups","isActive","topLevelElements","clearActive","remove","toplevelClickHandler","toplevelOverHandler","querySelectorAll","li","_self","area","$location","windowCommand","errors","behavior","not_adblocked"],"mappings":"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"}